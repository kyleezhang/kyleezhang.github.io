<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/config/favicon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/config/favicon.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/config/favicon.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"kyleezhang.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"enable":true,"style":"tabs","active":false,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="Vue CLI vue-cli åœ¨ 3.0 ç‰ˆæœ¬è¿›è¡Œäº†å½»åº•çš„é‡æ„ï¼Œä¸ºäº†åŒºåˆ«ä¹Ÿå°†å…¶æ™®éç§°ä¸º Vue CLIï¼Œæ˜¯ç›®å‰ Vue å®˜æ–¹æ¨èçš„ Vue é¡¹ç›®å¿«é€Ÿå¼€å‘çš„å®Œæ•´ç³»ç»Ÿï¼Œå®ƒåŸºäº Webpack å®ç°ï¼Œæä¾›äº†ç»ˆç«¯å‘½ä»¤è¡Œå·¥å…·ã€é›¶é…ç½®è„šæ‰‹æ¶ã€æ’ä»¶ä½“ç³»ã€å›¾å½¢åŒ–ç®¡ç†ç•Œé¢ç­‰è¯¸å¤šåŠŸèƒ½ï¼Œè¿‘ä¹æä¾›äº†å‰ç«¯é¡¹ç›®å·¥ç¨‹åŒ–çš„æ‰€æœ‰æ­¥éª¤çš„å®Œæ•´å·¥å…·é“¾ï¼Œä¹Ÿæ˜¯å½“å‰ Vue é¡¹ç›®æ„å»ºçš„ä¸»æµå·¥å…·ã€‚  ä¸€ã€æ•´ä½“æ¶æ„ vue-cli ä¸ºäº†å°½å¯èƒ½">
<meta property="og:type" content="article">
<meta property="og:title" content="ä»vue-cliåˆ°Vue CLIï¼ˆäºŒï¼‰">
<meta property="og:url" content="http://kyleezhang.com/2021/05/15/vue-cli-02/index.html">
<meta property="og:site_name" content="kyleezhang&#96;s Blog">
<meta property="og:description" content="Vue CLI vue-cli åœ¨ 3.0 ç‰ˆæœ¬è¿›è¡Œäº†å½»åº•çš„é‡æ„ï¼Œä¸ºäº†åŒºåˆ«ä¹Ÿå°†å…¶æ™®éç§°ä¸º Vue CLIï¼Œæ˜¯ç›®å‰ Vue å®˜æ–¹æ¨èçš„ Vue é¡¹ç›®å¿«é€Ÿå¼€å‘çš„å®Œæ•´ç³»ç»Ÿï¼Œå®ƒåŸºäº Webpack å®ç°ï¼Œæä¾›äº†ç»ˆç«¯å‘½ä»¤è¡Œå·¥å…·ã€é›¶é…ç½®è„šæ‰‹æ¶ã€æ’ä»¶ä½“ç³»ã€å›¾å½¢åŒ–ç®¡ç†ç•Œé¢ç­‰è¯¸å¤šåŠŸèƒ½ï¼Œè¿‘ä¹æä¾›äº†å‰ç«¯é¡¹ç›®å·¥ç¨‹åŒ–çš„æ‰€æœ‰æ­¥éª¤çš„å®Œæ•´å·¥å…·é“¾ï¼Œä¹Ÿæ˜¯å½“å‰ Vue é¡¹ç›®æ„å»ºçš„ä¸»æµå·¥å…·ã€‚  ä¸€ã€æ•´ä½“æ¶æ„ vue-cli ä¸ºäº†å°½å¯èƒ½">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://kyleezhang.com/assets/vue-cli/05.png">
<meta property="og:image" content="http://kyleezhang.com/assets/emoji/03.png">
<meta property="og:image" content="http://kyleezhang.com/assets/vue-cli/06.png">
<meta property="og:image" content="http://kyleezhang.com/assets/vue-cli/07.png">
<meta property="og:image" content="http://kyleezhang.com/assets/vue-cli/08.png">
<meta property="og:image" content="http://kyleezhang.com/assets/emoji/04.png">
<meta property="og:image" content="http://kyleezhang.com/assets/emoji/05.jpg">
<meta property="article:published_time" content="2021-05-15T12:00:35.000Z">
<meta property="article:modified_time" content="2022-05-05T01:40:34.646Z">
<meta property="article:author" content="kyleezhang">
<meta property="article:tag" content="cli">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://kyleezhang.com/assets/vue-cli/05.png">

<link rel="canonical" href="http://kyleezhang.com/2021/05/15/vue-cli-02/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>ä»vue-cliåˆ°Vue CLIï¼ˆäºŒï¼‰ | kyleezhang`s Blog</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-2KR3NK700N"></script>
    <script>
      if (CONFIG.hostname === location.hostname) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-2KR3NK700N');
      }
    </script>


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?f1621cb3fb0792bb294fce1b938d5eef";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="kyleezhang`s Blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband">
    <a target="_blank" rel="noopener" href="https://github.com/kyleezhang " class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#fff; color:#151513; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
    </div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ ">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">kyleezhang`s Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>é¦–é¡µ</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>æ ‡ç­¾</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>åˆ†ç±»</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>å½’æ¡£</a>

  </li>
        <li class="menu-item menu-item-sitemap">

    <a href="/sitemap.xml" rel="section"><i class="fa fa-sitemap fa-fw"></i>ç«™ç‚¹åœ°å›¾</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://kyleezhang.com/2021/05/15/vue-cli-02/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/assets/config/avatar.png">
      <meta itemprop="name" content="kyleezhang">
      <meta itemprop="description" content="å­¦æºäºæ€">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="kyleezhang`s Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          ä»vue-cliåˆ°Vue CLIï¼ˆäºŒï¼‰
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2021-05-15 12:00:35" itemprop="dateCreated datePublished" datetime="2021-05-15T12:00:35+00:00">2021-05-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2022-05-05 01:40:34" itemprop="dateModified" datetime="2022-05-05T01:40:34+00:00">2022-05-05</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/" itemprop="url" rel="index"><span itemprop="name">å‰ç«¯å·¥ç¨‹åŒ–</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="é˜…è¯»æ¬¡æ•°" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
              <span id="busuanzi_value_page_pv"></span>
            </span><br>
            <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
              <span>70k</span>
            </span>
            <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
              <span>1:04</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="vue-cli"><a class="markdownIt-Anchor" href="#vue-cli"></a> Vue CLI</h2>
<p>vue-cli åœ¨ 3.0 ç‰ˆæœ¬è¿›è¡Œäº†å½»åº•çš„é‡æ„ï¼Œä¸ºäº†åŒºåˆ«ä¹Ÿå°†å…¶æ™®éç§°ä¸º Vue CLIï¼Œæ˜¯ç›®å‰ Vue å®˜æ–¹æ¨èçš„ Vue é¡¹ç›®å¿«é€Ÿå¼€å‘çš„å®Œæ•´ç³»ç»Ÿï¼Œå®ƒåŸºäº Webpack å®ç°ï¼Œæä¾›äº†ç»ˆç«¯å‘½ä»¤è¡Œå·¥å…·ã€é›¶é…ç½®è„šæ‰‹æ¶ã€æ’ä»¶ä½“ç³»ã€å›¾å½¢åŒ–ç®¡ç†ç•Œé¢ç­‰è¯¸å¤šåŠŸèƒ½ï¼Œè¿‘ä¹æä¾›äº†å‰ç«¯é¡¹ç›®å·¥ç¨‹åŒ–çš„æ‰€æœ‰æ­¥éª¤çš„å®Œæ•´å·¥å…·é“¾ï¼Œä¹Ÿæ˜¯å½“å‰ Vue é¡¹ç›®æ„å»ºçš„ä¸»æµå·¥å…·ã€‚</p>
<h3 id="ä¸€-æ•´ä½“æ¶æ„"><a class="markdownIt-Anchor" href="#ä¸€-æ•´ä½“æ¶æ„"></a> ä¸€ã€æ•´ä½“æ¶æ„</h3>
<p>vue-cli ä¸ºäº†å°½å¯èƒ½è¦†ç›–é¡¹ç›®å·¥ç¨‹åŒ–éœ€æ±‚æ‰€ä»¥æ¨¡ç‰ˆé¡¹ç›®å¾€å¾€å¼•å…¥äº†å¤§é‡ç¬¬ä¸‰æ–¹åº“ï¼Œä½†å®é™…å¼€å‘è¿‡ç¨‹ä¸­å¼€å‘è€…å¯èƒ½å¹¶ä¸éœ€è¦è¿™äº›åŠŸèƒ½æ¨¡å—ï¼Œè™½ç„¶å¯ä»¥é€šè¿‡åœ¨æ¨¡ç‰ˆé¡¹ç›®çš„ meta.js æˆ– meta.json æ–‡ä»¶é…ç½® prompts åœ¨å‘½ä»¤è¡Œäº¤äº’ç„¶ååœ¨ filterFiles å‡½æ•°ä¸­å¯¹ç”Ÿæˆé¡¹ç›®çš„æ–‡ä»¶ç›®å½•ç»“æ„è¿›è¡Œç­›é€‰ï¼Œä½†æ˜¯ä¾ç„¶å¯é…ç½®æ€§ä¸å¼ºï¼Œä¼šå­˜åœ¨è¾ƒå¤šå†—ä½™ä¾èµ–æˆ–åŠŸèƒ½ï¼Œå¹¶ä¸”ä¾èµ–é¡¹çš„å‡çº§æä¸ºç—›è‹¦ï¼Œå› æ­¤ä¸ºäº†ç»™å¼€å‘è€…æä¾›æ›´çµæ´»çš„é…ç½®èƒ½åŠ› Vue CLI å®ç°äº†ä¸€ç§æä¸ºå·§å¦™çš„æ¶æ„è®¾è®¡ï¼š</p>
<a id="more"></a>
<img src="/assets/vue-cli/05.png" width="400" />
<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒVue CLI çš„æœ€æ–°æ¶æ„ä¸»è¦ç”±å¦‚ä¸‹æ¨¡å—æ„æˆï¼š</p>
<p>1ã€@vue/cli: é¦–å…ˆæˆ‘ä»¬ä¼šåœ¨å…¨å±€å®‰è£…ä¸€ä¸ª@vue/cliï¼Œå…¶ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ç³»åˆ— vue å‘½ä»¤ï¼Œä¾‹å¦‚æˆ‘ä»¬æœ€å¸¸ç”¨ vue createã€vue add æŒ‡ä»¤ç­‰ç­‰ã€‚@vue/cli æœ¬è´¨ä¸Šä¾ç„¶æ˜¯è„šæ‰‹æ¶å·¥å…·ï¼Œä¸»è¦é€šè¿‡ CLI äº¤äº’è‡ªåŠ¨åŒ–åˆ›å»ºé¡¹ç›®åŸºç¡€ç»“æ„ï¼Œå…·ä½“æ­¥éª¤ä¸ºï¼š</p>
<ul>
<li>å‡†å¤‡å‘½ä»¤è¡Œäº¤äº’çš„é—®é¢˜</li>
<li>æ ¹æ®ç”¨æˆ·çš„å›ç­”å†³å®šæ˜¯å¦ä½¿ç”¨æŸä¸ªæ’ä»¶ï¼ˆå†…ç½®ï¼‰</li>
<li>è°ƒç”¨ npm/yarn è‡ªåŠ¨åœ¨é¡¹ç›®æœ¬åœ°å®‰è£…è¿™äº›æ’ä»¶</li>
<li>è°ƒç”¨æ¯ä¸ªæ’ä»¶å†…éƒ¨çš„ generator æ–¹æ³•</li>
<li>generator å†…éƒ¨åˆ›å»ºæ‰€æœ‰æ–‡ä»¶</li>
</ul>
<p>2ã€@vue/cli-service: å¦‚æœè¯´ @vue/cli çš„ä¸»è¦ä½œç”¨æ˜¯é¡¹ç›®çš„ç”Ÿæˆï¼Œé‚£ä¹ˆ @vue/cli-service æ‰æ˜¯å¼€å‘è€…æ—¥å¸¸å¼€å‘çš„çœŸæ­£æ ¸å¿ƒï¼Œä¸ºæˆ‘ä»¬æä¾›äº† Vue.js å¼€å‘ç¯å¢ƒçš„ CLI æœåŠ¡ï¼ˆæœ¬åœ°æµ‹è¯•ã€ç”Ÿäº§ç¯å¢ƒæ„å»ºç­‰ç­‰ï¼‰ï¼Œå› æ­¤å®ƒæä¾›çš„ä¸»è¦åŠŸèƒ½ç‚¹å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<ul>
<li>æä¾›äº†ä¸€ä¸ªé€‚ç”¨äºå¤§å¤šæ•° Vue.js é¡¹ç›®çš„ Webpack é…ç½®ï¼Œå¹¶ä¸”å†…éƒ¨åªåšæœ€é€šç”¨çš„é…ç½®ã€‚</li>
<li>æŠŠ Webpack ä¸ Webpack Dev Server å°è£…è¿›å†…éƒ¨ï¼Œæä¾› server &amp; build å‘½ä»¤ã€‚</li>
<li>åŠ è½½å…¶ä»– CLI æ’ä»¶å†…éƒ¨çš„æ ¸å¿ƒæœåŠ¡ã€‚</li>
</ul>
<p>3ã€@vue/cli-plugin-xxx: ä¸ªäººè§‰å¾— Vue CLI è®¾è®¡æœ€å‡ºå½©çš„åœ°æ–¹å°±åœ¨äºæ’ä»¶æœºåˆ¶ï¼Œé¡¹ç›®æœ¬èº«åˆ›å»ºæœ€å¼€å§‹çš„æ—¶å€™åªæ˜¯æ ¹æ®ç”¨æˆ·åœ¨å‘½ä»¤è¡Œçš„äº¤äº’é—®é¢˜ç”Ÿæˆ package.jsonï¼Œç„¶åæ ¹æ®æ‰€æ‹¥æœ‰çš„æ¨¡å—åŠ¨æ€å®Œæˆ Webpack çš„é…ç½®å¹¶ç”Ÿæˆé¡¹ç›®ç»“æ„ï¼Œå› æ­¤ Vue CLI çš„æ’ä»¶æ¨¡å—ä¸»è¦å®Œæˆå¦‚ä¸‹åŠŸèƒ½ï¼š</p>
<ul>
<li>æä¾›äº†ä¸ªæ€§åŒ–çš„ Webpack é…ç½®ï¼Œè®©æ„å»ºè¿‡ç¨‹æ”¯æŒä¸åŒçš„æŠ€æœ¯é€‰å‹</li>
<li>æä¾›äº† Generator ç”¨äºç”Ÿæˆé¡¹ç›®ä¸­æ‰€éœ€çš„æ–‡ä»¶</li>
<li>æä¾›äº†é¢å¤–çš„ Command ç”¨äºå®ç°æ‰©å±•åŠŸèƒ½ï¼Œä¾‹å¦‚ cli-plugin-eslint æ’ä»¶ä¸­æä¾›äº† lint å­å‘½ä»¤</li>
</ul>
<p>ä¸‹é¢æˆ‘ä»¬å¼€å§‹è¯¦ç»†åˆ†ææ¯ä¸€ä¸ªæ¨¡å—æ¥æŸ¥çœ‹å…¶åŠŸèƒ½çš„å…·ä½“å®ç°ï¼š</p>
<img src="/assets/emoji/03.png" width="260" />
<h3 id="äºŒ-vuecli"><a class="markdownIt-Anchor" href="#äºŒ-vuecli"></a> äºŒã€@vue/cli</h3>
<p>@vue/cli ä¸»è¦ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ç³»åˆ— vue å‘½ä»¤ï¼Œå…·ä½“å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<img src="/assets/vue-cli/06.png" width="800" />
<p>è¿™äº›æŒ‡ä»¤éƒ½æ˜¯åœ¨ <code>@vue/cli/bin/vue.js</code> æ–‡ä»¶ä¸­é€šè¿‡ command åº“çš„ command æ–¹æ³•æŒ‡å®šçš„ï¼Œæ­¤å¤„æ¯”è¾ƒæœ‰æ„æ€çš„æ˜¯ @vue/cli æä¾›äº† suggestCommands å‡½æ•°ï¼Œç”¨äºå¯¹ç”¨æˆ·åœ¨å‘½ä»¤è¡Œçš„é”™è¯¯è¾“å…¥åˆ†æå¹¶ç»™å‡ºçŒœæµ‹æŒ‡ä»¤ï¼Œå…·ä½“å®ç°å¦‚ä¸‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// @vue/cli/bin/vue.js</span></span><br><span class="line">...</span><br><span class="line"><span class="comment">// output help information on unknown commands</span></span><br><span class="line"><span class="comment">// å¦‚æœä¸æ˜¯å‰æ–‡å·²æŒ‚è½½çš„å‘½ä»¤å¼€å§‹æ‰§è¡Œå¦‚ä¸‹å‡½æ•°</span></span><br><span class="line">program.on(<span class="string">&#x27;command:*&#x27;</span>, <span class="function">(<span class="params">[cmd]</span>) =&gt;</span> &#123;</span><br><span class="line">  program.outputHelp()</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`  `</span> + chalk.red(<span class="string">`Unknown command <span class="subst">$&#123;chalk.yellow(cmd)&#125;</span>.`</span>))</span><br><span class="line">  <span class="built_in">console</span>.log()</span><br><span class="line">  suggestCommands(cmd)</span><br><span class="line">  process.exitCode = <span class="number">1</span></span><br><span class="line">&#125;)</span><br><span class="line">...</span><br><span class="line"><span class="comment">// çŒœæµ‹ç”¨æˆ·æ„å›¾</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">suggestCommands</span> (<span class="params">unknownCommand</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> availableCommands = program.commands.map(<span class="function"><span class="params">cmd</span> =&gt;</span> cmd._name)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> suggestion</span><br><span class="line"></span><br><span class="line">  availableCommands.forEach(<span class="function"><span class="params">cmd</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> isBestMatch = leven(cmd, unknownCommand) &lt; leven(suggestion || <span class="string">&#x27;&#x27;</span>, unknownCommand)</span><br><span class="line">    <span class="keyword">if</span> (leven(cmd, unknownCommand) &lt; <span class="number">3</span> &amp;&amp; isBestMatch) &#123;</span><br><span class="line">      suggestion = cmd</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (suggestion) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`  `</span> + chalk.red(<span class="string">`Did you mean <span class="subst">$&#123;chalk.yellow(suggestion)&#125;</span>?`</span>))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä»£ç ä¸­ä½¿ç”¨äº† leven äº†è¿™ä¸ªåŒ…ï¼Œè¿™æ˜¯ç”¨äºè®¡ç®—å­—ç¬¦ä¸²ç¼–è¾‘è·ç¦»ç®—æ³•çš„ JS å®ç°ï¼ŒVue CLI è¿™é‡Œä½¿ç”¨äº†è¿™ä¸ªåŒ…ï¼Œæ¥åˆ†åˆ«è®¡ç®—è¾“å…¥çš„å‘½ä»¤å’Œå½“å‰å·²æŒ‚è½½çš„æ‰€æœ‰å‘½ä»¤çš„ç¼–è¾‘ä¸¾ä¾‹ï¼Œä»è€ŒçŒœæµ‹ç”¨æˆ·å®é™…æƒ³è¾“å…¥çš„å‘½ä»¤æ˜¯å“ªä¸ªã€‚ä¸€ä¸ªç®€å•åŠŸèƒ½çš„å®ç°ï¼Œä½†æå¤§ç¨‹åº¦åœ°æå‡äº†ç”¨æˆ·ä½“éªŒğŸ‘ã€‚</p>
<p>é¦–å…ˆæˆ‘ä»¬å¼€å§‹åˆ†æé¡¹ç›®åˆ›å»ºæœ€æ ¸å¿ƒçš„ create å‘½ä»¤ï¼š</p>
<h4 id="1-create-å‘½ä»¤"><a class="markdownIt-Anchor" href="#1-create-å‘½ä»¤"></a> 1ã€create å‘½ä»¤</h4>
<p>æˆ‘ä»¬é¦–å…ˆæŸ¥çœ‹ create å‘½ä»¤çš„å…¥å£ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// packages/@vue/cli/bin/vue.js</span></span><br><span class="line">program</span><br><span class="line">  .command(<span class="string">&#x27;create &lt;app-name&gt;&#x27;</span>)</span><br><span class="line">  .description(<span class="string">&#x27;create a new project powered by vue-cli-service&#x27;</span>)</span><br><span class="line">  .option(<span class="string">&#x27;-p, --preset &lt;presetName&gt;&#x27;</span>, <span class="string">&#x27;Skip prompts and use saved or remote preset&#x27;</span>)</span><br><span class="line">  .option(<span class="string">&#x27;-d, --default&#x27;</span>, <span class="string">&#x27;Skip prompts and use default preset&#x27;</span>)</span><br><span class="line">  .option(<span class="string">&#x27;-i, --inlinePreset &lt;json&gt;&#x27;</span>, <span class="string">&#x27;Skip prompts and use inline JSON string as preset&#x27;</span>)</span><br><span class="line">  .option(<span class="string">&#x27;-m, --packageManager &lt;command&gt;&#x27;</span>, <span class="string">&#x27;Use specified npm client when installing dependencies&#x27;</span>)</span><br><span class="line">  .option(<span class="string">&#x27;-r, --registry &lt;url&gt;&#x27;</span>, <span class="string">&#x27;Use specified npm registry when installing dependencies (only for npm)&#x27;</span>)</span><br><span class="line">  .option(<span class="string">&#x27;-g, --git [message]&#x27;</span>, <span class="string">&#x27;Force git initialization with initial commit message&#x27;</span>)</span><br><span class="line">  .option(<span class="string">&#x27;-n, --no-git&#x27;</span>, <span class="string">&#x27;Skip git initialization&#x27;</span>)</span><br><span class="line">  .option(<span class="string">&#x27;-f, --force&#x27;</span>, <span class="string">&#x27;Overwrite target directory if it exists&#x27;</span>)</span><br><span class="line">  .option(<span class="string">&#x27;-c, --clone&#x27;</span>, <span class="string">&#x27;Use git clone when fetching remote preset&#x27;</span>)</span><br><span class="line">  .option(<span class="string">&#x27;-x, --proxy&#x27;</span>, <span class="string">&#x27;Use specified proxy when creating project&#x27;</span>)</span><br><span class="line">  .option(<span class="string">&#x27;-b, --bare&#x27;</span>, <span class="string">&#x27;Scaffold project without beginner instructions&#x27;</span>)</span><br><span class="line">  .action(<span class="function">(<span class="params">name, options</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (minimist(process.argv.slice(<span class="number">3</span>))._.length &gt; <span class="number">1</span>) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(chalk.yellow(<span class="string">&#x27;\n Info: You provided more than one argument. The first one will be used as the app\&#x27;s name, the rest are ignored.&#x27;</span>))</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// --git makes commander to default git to true</span></span><br><span class="line">    <span class="keyword">if</span> (process.argv.includes(<span class="string">&#x27;-g&#x27;</span>) || process.argv.includes(<span class="string">&#x27;--git&#x27;</span>)) &#123;</span><br><span class="line">      options.forceGit = <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">require</span>(<span class="string">&#x27;../lib/create&#x27;</span>)(name, options)</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>
<p>ä¸Šè¿°å‚æ•°çš„å…·ä½“ä½œç”¨å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">-p, --preset &lt;presetName&gt;       å¿½ç•¥æç¤ºç¬¦å¹¶ä½¿ç”¨å·²ä¿å­˜çš„æˆ–è¿œç¨‹çš„é¢„è®¾é€‰é¡¹</span><br><span class="line">-d, --default                   å¿½ç•¥æç¤ºç¬¦å¹¶ä½¿ç”¨é»˜è®¤é¢„è®¾é€‰é¡¹</span><br><span class="line">-i, --inlinePreset &lt;json&gt;       å¿½ç•¥æç¤ºç¬¦å¹¶ä½¿ç”¨å†…è”çš„ JSON å­—ç¬¦ä¸²é¢„è®¾é€‰é¡¹</span><br><span class="line">-m, --packageManager &lt;<span class="built_in">command</span>&gt;  åœ¨å®‰è£…ä¾èµ–æ—¶ä½¿ç”¨æŒ‡å®šçš„ npm å®¢æˆ·ç«¯</span><br><span class="line">-r, --registry &lt;url&gt;            åœ¨å®‰è£…ä¾èµ–æ—¶ä½¿ç”¨æŒ‡å®šçš„ npm registry</span><br><span class="line">-g, --git [message]             å¼ºåˆ¶ / è·³è¿‡ git åˆå§‹åŒ–ï¼Œå¹¶å¯é€‰çš„æŒ‡å®šåˆå§‹åŒ–æäº¤ä¿¡æ¯</span><br><span class="line">-n, --no-git                    è·³è¿‡ git åˆå§‹åŒ–</span><br><span class="line">-f, --force                     è¦†å†™ç›®æ ‡ç›®å½•å¯èƒ½å­˜åœ¨çš„é…ç½®</span><br><span class="line">-c, --<span class="built_in">clone</span>                     ä½¿ç”¨ git <span class="built_in">clone</span> è·å–è¿œç¨‹é¢„è®¾é€‰é¡¹</span><br><span class="line">-x, --proxy                     ä½¿ç”¨æŒ‡å®šçš„ä»£ç†åˆ›å»ºé¡¹ç›®</span><br><span class="line">-b, --bare                      åˆ›å»ºé¡¹ç›®æ—¶çœç•¥é»˜è®¤ç»„ä»¶ä¸­çš„æ–°æ‰‹æŒ‡å¯¼ä¿¡æ¯</span><br><span class="line">-h, --<span class="built_in">help</span>                      è¾“å‡ºä½¿ç”¨å¸®åŠ©ä¿¡æ¯</span><br></pre></td></tr></table></figure>
<p>å…·ä½“çš„æ‰§è¡Œåˆ™ä¸»è¦æ˜¯è°ƒç”¨äº† <code>../lib/create.js</code> æ–‡ä»¶æš´éœ²å‡ºçš„ create æ–¹æ³•ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">create</span> (<span class="params">projectName, options</span>) </span>&#123;</span><br><span class="line">   <span class="keyword">if</span> (options.proxy) &#123;</span><br><span class="line">    process.env.HTTP_PROXY = options.proxy <span class="comment">// æ ¹æ®ç”¨æˆ·æ˜¯å¦é…ç½® proxy é¡¹åˆ›å»ºç¯å¢ƒå˜é‡ HTTP_PROXY</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> cwd = options.cwd || process.cwd() <span class="comment">// å½“å‰ç›®å½•</span></span><br><span class="line">  <span class="keyword">const</span> inCurrent = projectName === <span class="string">&#x27;.&#x27;</span> <span class="comment">// æ˜¯å¦åœ¨å½“å‰ç›®å½•</span></span><br><span class="line">  <span class="keyword">const</span> name = inCurrent ? path.relative(<span class="string">&#x27;../&#x27;</span>, cwd) : projectName <span class="comment">// é¡¹ç›®åç§°</span></span><br><span class="line">  <span class="keyword">const</span> targetDir = path.resolve(cwd, projectName || <span class="string">&#x27;.&#x27;</span>) <span class="comment">// ç”Ÿæˆé¡¹ç›®çš„ç›®å½•</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> result = validateProjectName(name) <span class="comment">// è°ƒç”¨ validate-npm-package-name åº“æ ¡éªŒé¡¹ç›®åç§°</span></span><br><span class="line">  <span class="keyword">if</span> (!result.validForNewPackages) &#123;</span><br><span class="line">    <span class="built_in">console</span>.error(chalk.red(<span class="string">`Invalid project name: &quot;<span class="subst">$&#123;name&#125;</span>&quot;`</span>))</span><br><span class="line">    result.errors &amp;&amp; result.errors.forEach(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.error(chalk.red.dim(<span class="string">&#x27;Error: &#x27;</span> + err))</span><br><span class="line">    &#125;)</span><br><span class="line">    result.warnings &amp;&amp; result.warnings.forEach(<span class="function"><span class="params">warn</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.error(chalk.red.dim(<span class="string">&#x27;Warning: &#x27;</span> + warn))</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// æ­¤å¤„ä»£ç ä¸»è¦ç”¨äºé¡¹ç›®ç”Ÿæˆè·¯å¾„çš„åˆ¤æ–­ï¼Œä¸»è¦æ˜¯å½“å­˜åœ¨ç›¸åŒé¡¹ç›®ç›®å½•çš„æ—¶å€™è°ƒç”¨ inquirer.prompt æ¥è¯¢é—®æ˜¯å¦è¦ Overwrite || Merge || Cancelï¼Œå½“å¸¦æœ‰ -f || --force çš„æ—¶å€™ä¼šè·³è¿‡è¿™äº›äº¤äº’ï¼Œå³ options force = true</span></span><br><span class="line">  <span class="keyword">if</span> (fs.existsSync(targetDir) &amp;&amp; !options.merge) &#123;</span><br><span class="line">    <span class="keyword">if</span> (options.force) &#123;</span><br><span class="line">      <span class="keyword">await</span> fs.remove(targetDir)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">await</span> clearConsole()</span><br><span class="line">      <span class="keyword">if</span> (inCurrent) &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; ok &#125; = <span class="keyword">await</span> inquirer.prompt([</span><br><span class="line">          &#123;</span><br><span class="line">            name: <span class="string">&#x27;ok&#x27;</span>,</span><br><span class="line">            type: <span class="string">&#x27;confirm&#x27;</span>,</span><br><span class="line">            message: <span class="string">`Generate project in current directory?`</span></span><br><span class="line">          &#125;</span><br><span class="line">        ])</span><br><span class="line">        <span class="keyword">if</span> (!ok) &#123;</span><br><span class="line">          <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; action &#125; = <span class="keyword">await</span> inquirer.prompt([</span><br><span class="line">          &#123;</span><br><span class="line">            name: <span class="string">&#x27;action&#x27;</span>,</span><br><span class="line">            type: <span class="string">&#x27;list&#x27;</span>,</span><br><span class="line">            message: <span class="string">`Target directory <span class="subst">$&#123;chalk.cyan(targetDir)&#125;</span> already exists. Pick an action:`</span>,</span><br><span class="line">            choices: [</span><br><span class="line">              &#123; <span class="attr">name</span>: <span class="string">&#x27;Overwrite&#x27;</span>, <span class="attr">value</span>: <span class="string">&#x27;overwrite&#x27;</span> &#125;,</span><br><span class="line">              &#123; <span class="attr">name</span>: <span class="string">&#x27;Merge&#x27;</span>, <span class="attr">value</span>: <span class="string">&#x27;merge&#x27;</span> &#125;,</span><br><span class="line">              &#123; <span class="attr">name</span>: <span class="string">&#x27;Cancel&#x27;</span>, <span class="attr">value</span>: <span class="literal">false</span> &#125;</span><br><span class="line">            ]</span><br><span class="line">          &#125;</span><br><span class="line">        ])</span><br><span class="line">        <span class="keyword">if</span> (!action) &#123;</span><br><span class="line">          <span class="keyword">return</span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (action === <span class="string">&#x27;overwrite&#x27;</span>) &#123;</span><br><span class="line">          <span class="built_in">console</span>.log(<span class="string">`\nRemoving <span class="subst">$&#123;chalk.cyan(targetDir)&#125;</span>...`</span>)</span><br><span class="line">          <span class="keyword">await</span> fs.remove(targetDir)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> creator = <span class="keyword">new</span> Creator(name, targetDir, getPromptModules())</span><br><span class="line">  <span class="keyword">await</span> creator.create(options)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function">(<span class="params">...args</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> create(...args).catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123; <span class="comment">// æ•è·å†…éƒ¨æ‰€æœ‰æŠ›å‡ºçš„é”™è¯¯ï¼Œå°†å½“å‰çš„ spinner  çŠ¶æ€åœæ­¢ï¼Œé€€å‡ºè¿›ç¨‹ã€‚</span></span><br><span class="line">    stopSpinner(<span class="literal">false</span>) <span class="comment">// do not persist</span></span><br><span class="line">    error(err)</span><br><span class="line">    <span class="keyword">if</span> (!process.env.VUE_CLI_TEST) &#123;</span><br><span class="line">      process.exit(<span class="number">1</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ­¤å¤„ç»è¿‡è®¤çœŸçš„ä»£ç åˆ†ææˆ‘ä»¬æˆåŠŸå‘ç°çœŸæ­£å®ç°çš„æ ¸å¿ƒéƒ½åœ¨ <code>../lib/Creator</code> çš„ Creator ç±»ä¸­ğŸ˜“ï¼Œï¼Œï¼Œä½†æ˜¯è¿™å„¿ getPromptModules æ–¹æ³•çš„ä½œç”¨æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">exports</span>.getPromptModules = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> [</span><br><span class="line">    <span class="string">&#x27;vueVersion&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;babel&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;typescript&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;pwa&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;router&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;vuex&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;cssPreprocessors&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;linter&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;unit&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;e2e&#x27;</span></span><br><span class="line">  ].map(<span class="function"><span class="params">file</span> =&gt;</span> <span class="built_in">require</span>(<span class="string">`../promptModules/<span class="subst">$&#123;file&#125;</span>`</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>getPromptModules å‡½æ•°ä¸»è¦ç”¨äº <code>../promptModules/</code> æ–‡ä»¶å¤¹ä¸‹ä¸åŒé…ç½®æ–‡ä»¶å†…å®¹çš„è¯»å–ï¼Œæˆ‘ä»¬ä»¥ <code>../promptModules/unit.js</code> ä¸ºä¾‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//../promptModules/unit.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="params">cli</span> =&gt;</span> &#123;</span><br><span class="line">  cli.injectFeature(&#123;</span><br><span class="line">    name: <span class="string">&#x27;Unit Testing&#x27;</span>,</span><br><span class="line">    value: <span class="string">&#x27;unit&#x27;</span>,</span><br><span class="line">    short: <span class="string">&#x27;Unit&#x27;</span>,</span><br><span class="line">    description: <span class="string">&#x27;Add a Unit Testing solution like Jest or Mocha&#x27;</span>,</span><br><span class="line">    link: <span class="string">&#x27;https://cli.vuejs.org/config/#unit-testing&#x27;</span>,</span><br><span class="line">    plugins: [<span class="string">&#x27;unit-jest&#x27;</span>, <span class="string">&#x27;unit-mocha&#x27;</span>]</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  cli.injectPrompt(&#123;</span><br><span class="line">    name: <span class="string">&#x27;unit&#x27;</span>,</span><br><span class="line">    when: <span class="function"><span class="params">answers</span> =&gt;</span> answers.features.includes(<span class="string">&#x27;unit&#x27;</span>),</span><br><span class="line">    type: <span class="string">&#x27;list&#x27;</span>,</span><br><span class="line">    message: <span class="string">&#x27;Pick a unit testing solution:&#x27;</span>,</span><br><span class="line">    choices: [</span><br><span class="line">      &#123;</span><br><span class="line">        name: <span class="string">&#x27;Jest&#x27;</span>,</span><br><span class="line">        value: <span class="string">&#x27;jest&#x27;</span>,</span><br><span class="line">        short: <span class="string">&#x27;Jest&#x27;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        name: <span class="string">&#x27;Mocha + Chai (requires webpack 4)&#x27;</span>,</span><br><span class="line">        value: <span class="string">&#x27;mocha&#x27;</span>,</span><br><span class="line">        short: <span class="string">&#x27;Mocha&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  cli.onPromptComplete(<span class="function">(<span class="params">answers, options</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (answers.unit === <span class="string">&#x27;mocha&#x27;</span>) &#123;</span><br><span class="line">      options.plugins[<span class="string">&#x27;@vue/cli-plugin-unit-mocha&#x27;</span>] = &#123;&#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (answers.unit === <span class="string">&#x27;jest&#x27;</span>) &#123;</span><br><span class="line">      options.plugins[<span class="string">&#x27;@vue/cli-plugin-unit-jest&#x27;</span>] = &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>cli.injectFeature</code> æ˜¯æ³¨å…¥ featurePromptï¼Œå³åˆå§‹åŒ–é¡¹ç›®æ—¶é€‰æ‹©çš„å‹¾é€‰é¡¹å¦‚ babelï¼Œtypescriptï¼Œpwa ç­‰ç­‰ï¼Œå¦‚ä¸‹å›¾ï¼š</p>
<img src="/assets/vue-cli/07.png" width="500" />
<p><code>cli.injectPrompt</code> æ˜¯æ ¹æ®é€‰æ‹©çš„ featurePrompt ç„¶åæ³¨å…¥å¯¹åº”çš„ promptï¼Œå½“é€‰æ‹©äº† unitï¼Œæ¥ä¸‹æ¥ä¼šæœ‰ä»¥ä¸‹çš„ promptï¼Œé€‰æ‹© Mocha + Chai è¿˜æ˜¯ Jestï¼š</p>
<img src="/assets/vue-cli/08.png" width="500" />
<p><code>cli.onPromptComplete</code> å°±æ˜¯ä¸€ä¸ªå›è°ƒï¼Œä¼šæ ¹æ®é€‰æ‹©æ¥æ·»åŠ å¯¹åº”çš„æ’ä»¶ï¼Œ å½“é€‰æ‹©äº† mocha ï¼Œé‚£ä¹ˆå°±ä¼šæ·»åŠ  @vue/cli-plugin-unit-mocha æ’ä»¶ã€‚</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬å¼€å§‹æ­£å¼æŸ¥çœ‹ Creator ç±»ï¼Œæ‰“å¼€ä¸€çœ‹ï¼Œå“¦è±ï¼Œ554 è¡Œä»£ç ï¼Œ12 ä¸ªå¼•å…¥æ¨¡å—ï¼Œå‘Šè¾ï¼</p>
<p>è€ƒè™‘åˆ°å¤§å®¶æ—¶é—´æ¯”è¾ƒç´§å¼ ï¼ˆwo bi jiao lanï¼‰è¿™å„¿æ¢³ç†ä¸€ä¸‹ä¸»è¦æµç¨‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="class"><span class="keyword">class</span> <span class="title">Creator</span> <span class="keyword">extends</span> <span class="title">EventEmitter</span> </span>&#123;</span><br><span class="line">  <span class="title">constructor</span> (<span class="params">name, context, promptModules</span>) &#123;</span><br><span class="line">    <span class="built_in">super</span>()</span><br><span class="line"></span><br><span class="line">    <span class="built_in">this</span>.name = name</span><br><span class="line">    <span class="built_in">this</span>.context = process.env.VUE_CLI_CONTEXT = context</span><br><span class="line">    <span class="comment">// è·å–äº† preset å’Œ feature çš„äº¤äº’é€‰æ‹©åˆ—è¡¨ï¼Œåœ¨ vue create å‘½ä»¤åˆå§‹åŒ–é¡¹ç›®çš„æ—¶å€™æä¾›é€‰æ‹©</span></span><br><span class="line">    <span class="keyword">const</span> &#123; presetPrompt, featurePrompt &#125; = <span class="built_in">this</span>.resolveIntroPrompts()</span><br><span class="line"></span><br><span class="line">    <span class="built_in">this</span>.presetPrompt = presetPrompt <span class="comment">// preset åˆ—è¡¨</span></span><br><span class="line">    <span class="built_in">this</span>.featurePrompt = featurePrompt <span class="comment">// pwaã€babelã€e2eç­‰ç­‰</span></span><br><span class="line">    <span class="comment">// å­˜æ”¾é¡¹ç›®é…ç½®çš„æ–‡ä»¶ï¼ˆpackage.json || congfig.jsï¼‰ ä»¥åŠæ˜¯å¦å°† presetPrompts å­˜æ”¾èµ·æ¥</span></span><br><span class="line">    <span class="built_in">this</span>.outroPrompts = <span class="built_in">this</span>.resolveOutroPrompts()</span><br><span class="line">    <span class="built_in">this</span>.outroPrompts = [] <span class="comment">// å¯¹åº” feature çš„ Prompts</span></span><br><span class="line">    <span class="comment">// ä¸åŒé˜¶æ®µå›è°ƒå‡½æ•°åˆ—è¡¨</span></span><br><span class="line">    <span class="built_in">this</span>.promptCompleteCbs = []</span><br><span class="line">    <span class="built_in">this</span>.afterInvokeCbs = []</span><br><span class="line">    <span class="built_in">this</span>.afterAnyInvokeCbs = []</span><br><span class="line"></span><br><span class="line">    <span class="built_in">this</span>.run = <span class="built_in">this</span>.run.bind(<span class="built_in">this</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> promptAPI = <span class="keyword">new</span> PromptModuleAPI(<span class="built_in">this</span>)</span><br><span class="line">    promptModules.forEach(<span class="function"><span class="params">m</span> =&gt;</span> m(promptAPI))</span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™å„¿æˆ‘ä»¬é¦–å…ˆæ³¨æ„åˆ°æ„é€ å‡½æ•°ä¸­åˆ†åˆ«ä¸ºå®ä¾‹å¯¹è±¡æ·»åŠ äº† presetPromptã€featurePromptã€outroPromptsã€outroPrompts ç­‰å„ç§å„æ ·çš„ â€œpromptâ€ å±æ€§ï¼Œé‚£ä¹ˆå®ƒä»¬ä¹‹é—´æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œåˆåˆ†åˆ«ä»£è¡¨äº†ä»€ä¹ˆå‘¢ï¼Ÿ</p>
<ul>
<li>presetPromptï¼š é¢„è®¾é€‰é¡¹ promptï¼ŒåŠ å…¥ä¸Šæ¬¡ä»¥ Manually æ¨¡å¼è¿›è¡Œäº†é¢„è®¾é€‰é¡¹ï¼Œå¹¶ä¸”ä¿å­˜åˆ°äº† ~/.vuerc ä¸­ï¼Œé‚£ä¹ˆåœ¨åˆå§‹åŒ–é¡¹ç›®æ—¶å°±ä¼šåˆ—å‡ºå·²ç»ä¿å­˜çš„ presetï¼Œå¹¶æä¾›é€‰æ‹©ã€‚</li>
<li>featurePromptï¼šé¡¹ç›®çš„ä¸€äº› featureï¼Œå°±æ˜¯é€‰æ‹© babelï¼Œtypescriptï¼Œpwaï¼Œrouterï¼Œvuexï¼ŒcssPreprocessorsï¼Œlinterï¼Œunitï¼Œe2eã€‚</li>
<li>injectedPromptsï¼šå½“é€‰æ‹©äº† feature åï¼Œå°±ä¼šä¸ºå¯¹åº”çš„ feature æ³¨å…¥ promptsï¼Œæ¯”å¦‚ä½ é€‰æ‹©äº† unitï¼Œé‚£ä¹ˆå°±ä¼šè®©ä½ é€‰æ‹©æ¨¡å¼ï¼š Mocha + Chai è¿˜æ˜¯ Jest</li>
<li>outroPromptsï¼š å…¶ä»–çš„ promptï¼ŒåŒ…å«ï¼š
<ul>
<li>å°† Babel, PostCSS, ESLint ç­‰ç­‰çš„é…ç½®æ–‡ä»¶å­˜æ”¾åœ¨ package.json ä¸­è¿˜æ˜¯å­˜æ”¾åœ¨ config æ–‡ä»¶ä¸­ï¼›</li>
<li>æ˜¯å¦éœ€è¦å°†è¿™æ¬¡è®¾ç½®çš„ preset ä¿å­˜åˆ°æœ¬åœ°ï¼Œå¦‚æœéœ€è¦åˆ™ä¼šè¿›ä¸€æ­¥è®©ä½ è¾“å…¥åç§°è¿›è¡Œä¿å­˜ï¼›</li>
<li>å®‰è£…ä¾èµ–æ˜¯é€‰æ‹© npm è¿˜æ˜¯ yarnã€‚</li>
</ul>
</li>
</ul>
<p>å†ææ¸…äº† â€œpromptâ€ ä¹‹é—´çš„åŒºåˆ«åæˆ‘ä»¬æ¥ç€å¾€ä¸‹çœ‹ PromptModuleAPIï¼Œå…¶æºç å¦‚ä¸‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="class"><span class="keyword">class</span> <span class="title">PromptModuleAPI</span> </span>&#123;</span><br><span class="line">  <span class="title">constructor</span> (<span class="params">creator</span>) &#123;</span><br><span class="line">    <span class="built_in">this</span>.creator = creator</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  injectFeature (feature) &#123;</span><br><span class="line">    <span class="built_in">this</span>.creator.featurePrompt.choices.push(feature)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  injectPrompt (prompt) &#123;</span><br><span class="line">    <span class="built_in">this</span>.creator.injectedPrompts.push(prompt)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  injectOptionForPrompt (name, option) &#123;</span><br><span class="line">    <span class="built_in">this</span>.creator.injectedPrompts.find(<span class="function"><span class="params">f</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> f.name === name</span><br><span class="line">    &#125;).choices.push(option)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  onPromptComplete (cb) &#123;</span><br><span class="line">    <span class="built_in">this</span>.creator.promptCompleteCbs.push(cb)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>PromptModuleAPI å®ä¾‹ä¼šè°ƒç”¨å®ƒçš„å®ä¾‹æ–¹æ³•ï¼Œç„¶åå°† injectFeatureï¼ŒinjectPromptï¼ŒinjectOptionForPromptï¼ŒonPromptComplete ä¿å­˜åˆ° Creator å®ä¾‹å¯¹åº”çš„å˜é‡ä¸­ã€‚æœ€åéå†å‰é¢ getPromptModules è·å–çš„ promptModulesï¼Œä¼ å…¥å®ä¾‹ promptAPIï¼Œåˆå§‹åŒ– Creator å®ä¾‹ä¸­ featurePrompt, injectedPrompts, promptCompleteCbs å˜é‡ã€‚</p>
<p>åœ¨ <code>../lib/create.js</code> æ–‡ä»¶ä¸­çš„ create æ–¹æ³•ä¸­æˆ‘ä»¬ç”Ÿæˆ Creator å®ä¾‹åè°ƒç”¨äº†å…¶ create æ–¹æ³•ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> creator.create(options)</span><br></pre></td></tr></table></figure>
<p>å› æ­¤æˆ‘ä»¬æ¥ç€æŸ¥çœ‹ create æ–¹æ³•çš„å…·ä½“å®ç°ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> create (cliOptions = &#123;&#125;, preset = <span class="literal">null</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> isTestOrDebug = process.env.VUE_CLI_TEST || process.env.VUE_CLI_DEBUG</span><br><span class="line">  <span class="keyword">const</span> &#123; run, name, context, afterInvokeCbs, afterAnyInvokeCbs &#125; = <span class="built_in">this</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!preset) &#123;</span><br><span class="line">    <span class="keyword">if</span> (cliOptions.preset) &#123;</span><br><span class="line">      <span class="comment">// vue create foo --preset bar</span></span><br><span class="line">      preset = <span class="keyword">await</span> <span class="built_in">this</span>.resolvePreset(cliOptions.preset, cliOptions.clone)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (cliOptions.default) &#123;</span><br><span class="line">      <span class="comment">// vue create foo --default</span></span><br><span class="line">      preset = defaults.presets.default</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (cliOptions.inlinePreset) &#123;</span><br><span class="line">      <span class="comment">// vue create foo --inlinePreset &#123;...&#125;</span></span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        preset = <span class="built_in">JSON</span>.parse(cliOptions.inlinePreset)</span><br><span class="line">      &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        error(<span class="string">`CLI inline preset is not valid JSON: <span class="subst">$&#123;cliOptions.inlinePreset&#125;</span>`</span>)</span><br><span class="line">        exit(<span class="number">1</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      preset = <span class="keyword">await</span> <span class="built_in">this</span>.promptAndResolvePreset()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// clone before mutating</span></span><br><span class="line">  preset = cloneDeep(preset)</span><br><span class="line">  <span class="comment">// inject core service</span></span><br><span class="line">  preset.plugins[<span class="string">&#x27;@vue/cli-service&#x27;</span>] = <span class="built_in">Object</span>.assign(&#123; <span class="comment">// æ³¨å…¥æ ¸å¿ƒ @vue/cli-service</span></span><br><span class="line">    projectName: name</span><br><span class="line">  &#125;, preset, &#123;</span><br><span class="line">    bare: cliOptions.bare</span><br><span class="line">  &#125;)</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å…ˆåˆ¤æ–­ vue create å‘½ä»¤æ˜¯å¦å¸¦æœ‰ -p é€‰é¡¹ï¼Œå¦‚æœæœ‰çš„è¯ä¼šè°ƒç”¨ resolvePreset å»è§£æ presetã€‚resolvePreset å‡½æ•°ä¼šå…ˆè·å– <code>ï½/.vuerc</code> ä¸­ä¿å­˜çš„ presetï¼Œ ç„¶åè¿›è¡Œéå†ï¼Œå¦‚æœé‡Œé¢åŒ…å«äº† -p ä¸­çš„ <code>&lt;presetName&gt;</code>ï¼Œåˆ™è¿”å› <code>ï½/.vuerc</code> ä¸­çš„ presetã€‚å¦‚æœæ²¡æœ‰åˆ™åˆ¤æ–­æ˜¯å¦æ˜¯é‡‡ç”¨å†…è”çš„ JSON å­—ç¬¦ä¸²é¢„è®¾é€‰é¡¹ï¼Œå¦‚æœæ˜¯å°±ä¼šè§£æ <code>.json</code> æ–‡ä»¶ï¼Œå¹¶è¿”å› presetï¼Œè¿˜æœ‰ä¸€ç§æƒ…å†µå°±æ˜¯ä»è¿œç¨‹è·å– presetï¼ˆåˆ©ç”¨ download-git-repo ä¸‹è½½è¿œç¨‹çš„ preset.json å¹¶è¿”å›ã€‚</p>
<p>å¦‚æœ vue create å‘½ä»¤æ²¡æœ‰å¸¦æœ‰ -p é€‰é¡¹å°±ä¼šè°ƒç”¨ promptAndResolvePreset å‡½æ•°åˆ©ç”¨ inquirer.prompt ä»¥å‘½ä»¤åäº¤äº’çš„å½¢å¼æ¥è·å– presetï¼Œä¸‹é¢çœ‹ä¸‹ promptAndResolvePreset å‡½æ•°çš„æºç ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> promptAndResolvePreset (answers = <span class="literal">null</span>) &#123;</span><br><span class="line">  <span class="comment">// prompt</span></span><br><span class="line">  <span class="keyword">if</span> (!answers) &#123;</span><br><span class="line">    <span class="keyword">await</span> clearConsole(<span class="literal">true</span>)</span><br><span class="line">    answers = <span class="keyword">await</span> inquirer.prompt(<span class="built_in">this</span>.resolveFinalPrompts())</span><br><span class="line">  &#125;</span><br><span class="line">  debug(<span class="string">&#x27;vue-cli:answers&#x27;</span>)(answers)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (answers.packageManager) &#123;</span><br><span class="line">    saveOptions(&#123;</span><br><span class="line">      packageManager: answers.packageManager</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> preset</span><br><span class="line">  <span class="keyword">if</span> (answers.preset &amp;&amp; answers.preset !== <span class="string">&#x27;__manual__&#x27;</span>) &#123;</span><br><span class="line">    preset = <span class="keyword">await</span> <span class="built_in">this</span>.resolvePreset(answers.preset)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// manual</span></span><br><span class="line">    preset = &#123;</span><br><span class="line">      useConfigFiles: answers.useConfigFiles === <span class="string">&#x27;files&#x27;</span>,</span><br><span class="line">      plugins: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    answers.features = answers.features || []</span><br><span class="line">    <span class="comment">// run cb registered by prompt modules to finalize the preset</span></span><br><span class="line">    <span class="built_in">this</span>.promptCompleteCbs.forEach(<span class="function"><span class="params">cb</span> =&gt;</span> cb(answers, preset))</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// validate</span></span><br><span class="line">  validatePreset(preset)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// save preset</span></span><br><span class="line">  <span class="keyword">if</span> (answers.save &amp;&amp; answers.saveName &amp;&amp; savePreset(answers.saveName, preset)) &#123;</span><br><span class="line">    log()</span><br><span class="line">    log(<span class="string">`ğŸ‰  Preset <span class="subst">$&#123;chalk.yellow(answers.saveName)&#125;</span> saved in <span class="subst">$&#123;chalk.yellow(rcPath)&#125;</span>`</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  debug(<span class="string">&#x27;vue-cli:preset&#x27;</span>)(preset)</span><br><span class="line">  <span class="keyword">return</span> preset</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä»£ç é¦–å…ˆåˆ©ç”¨ this.resolveFinalPrompts() è·å–äº†æœ€åçš„ prompts å¹¶é€šè¿‡ inquirer.prompt åœ¨å‘½ä»¤è¡Œä¸ç”¨æˆ·äº¤äº’ï¼Œè¿™å„¿çš„ resolveFinalPrompts çš„å®ç°å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">resolveFinalPrompts () &#123;</span><br><span class="line">  <span class="comment">// patch generator-injected prompts to only show in manual mode</span></span><br><span class="line">  <span class="comment">// å°†æ‰€æœ‰çš„ Prompt åˆå¹¶ï¼ŒåŒ…å« presetï¼Œfeatureï¼Œinjectedï¼Œoutroï¼Œåªæœ‰å½“é€‰æ‹©äº†æ‰‹åŠ¨æ¨¡å¼çš„æ—¶å€™æ‰ä¼šæ˜¾ç¤º injectedPrompts</span></span><br><span class="line">  <span class="built_in">this</span>.injectedPrompts.forEach(<span class="function"><span class="params">prompt</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> originalWhen = prompt.when || (<span class="function">() =&gt;</span> <span class="literal">true</span>)</span><br><span class="line">    prompt.when = <span class="function"><span class="params">answers</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> isManualMode(answers) &amp;&amp; originalWhen(answers)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> prompts = [</span><br><span class="line">    <span class="built_in">this</span>.presetPrompt,</span><br><span class="line">    <span class="built_in">this</span>.featurePrompt,</span><br><span class="line">    ...this.injectedPrompts,</span><br><span class="line">    ...this.outroPrompts</span><br><span class="line">  ]</span><br><span class="line">  debug(<span class="string">&#x27;vue-cli:prompts&#x27;</span>)(prompts)</span><br><span class="line">  <span class="keyword">return</span> prompts</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>inquirer.prompt æ‰§è¡Œå®Œæˆåä¼šè¿”å› answersï¼Œå¦‚æœé€‰æ‹©äº†æœ¬åœ°ä¿å­˜çš„ preset æˆ–è€… defaultï¼Œåˆ™è°ƒç”¨ resolvePreset è¿›è¡Œè§£æ presetï¼Œå¦åˆ™éå† promptCompleteCbs æ‰§è¡Œ injectFeature å’Œ injectPrompt çš„å›è°ƒï¼Œå°†å¯¹åº”çš„æ’ä»¶èµ‹å€¼åˆ° options.plugins ä¸­ï¼Œä»¥ unit ä¸ºä¾‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cli.onPromptComplete(<span class="function">(<span class="params">answers, options</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (answers.unit === <span class="string">&#x27;mocha&#x27;</span>) &#123;</span><br><span class="line">    options.plugins[<span class="string">&#x27;@vue/cli-plugin-unit-mocha&#x27;</span>] = &#123;&#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (answers.unit === <span class="string">&#x27;jest&#x27;</span>) &#123;</span><br><span class="line">    options.plugins[<span class="string">&#x27;@vue/cli-plugin-unit-jest&#x27;</span>] = &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>å¦‚æœ feature é€‰æ‹©äº† unitï¼Œå¹¶ä¸” unit æ¨¡å¼é€‰æ‹©çš„æ˜¯ Mocha + Chaiï¼Œåˆ™æ·»åŠ  @vue/cli-plugin-unit-mocha æ’ä»¶ï¼Œå¦‚æœé€‰æ‹©çš„æ˜¯ Jest åˆ™æ·»åŠ  @vue/cli-plugin-unit-jest æ’ä»¶ã€‚</p>
<p>æˆ‘ä»¬æ¥ç€æŸ¥çœ‹ create æ–¹æ³•åœ¨è·å–åˆ° preset ä¹‹åï¼Œè¿˜ä¼šå‘ preset çš„æ’ä»¶é‡Œé¢æ³¨å…¥æ ¸å¿ƒæ’ä»¶ <code>@vue/cli-service</code>ï¼Œ å®ƒæ˜¯è°ƒç”¨ <code>vue-cli-service &lt;command&gt; [...args]</code> æ—¶åˆ›å»ºçš„ç±»ã€‚ è´Ÿè´£ç®¡ç†å†…éƒ¨çš„ webpack é…ç½®ã€æš´éœ²æœåŠ¡å’Œæ„å»ºé¡¹ç›®çš„å‘½ä»¤ç­‰ã€‚</p>
<p>è‡³æ­¤æˆ‘ä»¬å·²ç»å®Œæˆäº† vue create å‘½ä»¤æ‰§è¡Œè¿‡ç¨‹ä¸­ç¬¬ä¸€ä¸ªè¦ç‚¹ï¼š<strong>è·å–ç”¨æˆ·é…ç½®ä¿¡æ¯</strong>ï¼Œå¹¶ä¸”æ ¹æ®é…ç½®ä¿¡æ¯è·å–äº†æ‰€éœ€çš„æ’ä»¶ï¼Œæ¥ä¸‹æ¥ä¾¿æ˜¯å¦ä¸€ä¸ªæ ¸å¿ƒ<strong>ä¾èµ–çš„å®‰è£…</strong>ï¼Œæˆ‘ä»¬æ¥æ¥ç€çœ‹ create å‡½æ•°ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> create (cliOptions = &#123;&#125;, preset = <span class="literal">null</span>) &#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="keyword">const</span> packageManager = (</span><br><span class="line">    cliOptions.packageManager ||</span><br><span class="line">    loadOptions().packageManager ||</span><br><span class="line">    (hasYarn() ? <span class="string">&#x27;yarn&#x27;</span> : <span class="literal">null</span>) ||</span><br><span class="line">    (hasPnpm3OrLater() ? <span class="string">&#x27;pnpm&#x27;</span> : <span class="string">&#x27;npm&#x27;</span>)</span><br><span class="line">  )</span><br><span class="line"></span><br><span class="line">  <span class="keyword">await</span> clearConsole()</span><br><span class="line">  <span class="keyword">const</span> pm = <span class="keyword">new</span> PackageManager(&#123; context, <span class="attr">forcePackageManager</span>: packageManager &#125;)</span><br><span class="line"></span><br><span class="line">  log(<span class="string">`âœ¨  Creating project in <span class="subst">$&#123;chalk.yellow(context)&#125;</span>.`</span>)</span><br><span class="line">  <span class="built_in">this</span>.emit(<span class="string">&#x27;creation&#x27;</span>, &#123; <span class="attr">event</span>: <span class="string">&#x27;creating&#x27;</span> &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// get latest CLI plugin version</span></span><br><span class="line">  <span class="keyword">const</span> &#123; latestMinor &#125; = <span class="keyword">await</span> getVersions()</span><br><span class="line">  <span class="comment">// generate package.json with plugin dependencies</span></span><br><span class="line">  <span class="keyword">const</span> pkg = &#123;</span><br><span class="line">    name,</span><br><span class="line">    version: <span class="string">&#x27;0.1.0&#x27;</span>,</span><br><span class="line">    private: <span class="literal">true</span>,</span><br><span class="line">    devDependencies: &#123;&#125;,</span><br><span class="line">    ...resolvePkg(context)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> deps = <span class="built_in">Object</span>.keys(preset.plugins)</span><br><span class="line">  deps.forEach(<span class="function"><span class="params">dep</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (preset.plugins[dep]._isPreset) &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> &#123; version &#125; = preset.plugins[dep]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!version) &#123;</span><br><span class="line">      <span class="keyword">if</span> (isOfficialPlugin(dep) || dep === <span class="string">&#x27;@vue/cli-service&#x27;</span> || dep === <span class="string">&#x27;@vue/babel-preset-env&#x27;</span>) &#123;</span><br><span class="line">        version = isTestOrDebug ? <span class="string">`latest`</span> : <span class="string">`~<span class="subst">$&#123;latestMinor&#125;</span>`</span></span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        version = <span class="string">&#x27;latest&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    pkg.devDependencies[dep] = version</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// write package.json</span></span><br><span class="line">  <span class="keyword">await</span> writeFileTree(context, &#123;</span><br><span class="line">    <span class="string">&#x27;package.json&#x27;</span>: <span class="built_in">JSON</span>.stringify(pkg, <span class="literal">null</span>, <span class="number">2</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ­¤å¤„ä»£ç ä¸»è¦æœ‰ä¸¤å¤„ä½œç”¨ï¼š<strong>è·å–æœ€æ–° CLI ï¼ˆåŒ…å«æ’ä»¶ï¼‰çš„ç‰ˆæœ¬</strong> å’Œ <strong>ç”Ÿæˆ package.json</strong>ï¼Œè¿™é‡Œ getVersions æ–¹æ³•ç”¨äºåˆ¤æ–­ @vue/cli æ˜¯å¦éœ€è¦æ›´æ–°ä»¥åŠåˆå§‹åŒ–é¡¹ç›®ä¸­ç›¸å…³æ’ä»¶çš„ç‰ˆæœ¬ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒgetVersions è·å– CLI çš„ç‰ˆæœ¬å¹¶ä¸æ˜¯ç›´æ¥è·å–ï¼Œ è€Œæ˜¯é€šè¿‡ <code>vue-cli-version-marker</code> npm åŒ…è·å–çš„ CLI ç‰ˆæœ¬ï¼Œä¸ºä»€ä¹ˆä¼šè¿™æ ·åšï¼Œä¸»è¦åŸå› æœ‰ä¸¤ç‚¹ï¼š</p>
<ul>
<li>vue-cli ä» 3.0ï¼ˆ@vue/cliï¼‰ å¼€å§‹å°±æ”¾åœ¨äº† @vue ä¸‹é¢ï¼Œå³æ˜¯ä¸€ä¸ª scoped package, è€Œ <strong>scoped package åˆä¸æ”¯æŒé€šè¿‡ npm registry æ¥è·å– latest ç‰ˆæœ¬ä¿¡æ¯</strong>ã€‚æ¯”å¦‚ vue-cli-version-marker/latest å¯ä»¥æ­£å¸¸è®¿é—®ï¼Œè€Œ @vue/cli/latest åˆ™ä¸å¯ä»¥ã€‚</li>
<li>è·å– scoped packages çš„æ•°æ®æ¯”è·å– unscoped package é€šå¸¸è¦æ…¢ 300msã€‚</li>
</ul>
<p>æ­£æ˜¯ç”±äºä¸Šè¿°ä¸¤ä¸ªåŸå› ï¼Œå› æ­¤é€šè¿‡ unscoped package <code>vue-cli-version-marker</code> æ¥è·å– CLI ç‰ˆæœ¬ï¼Œ<code>vue-cli-version-marker</code> çš„å†…å®¹æ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯ä¸€ä¸ª package.jsonï¼Œé€šè¿‡è·å–é‡Œé¢ devDependencies çš„ç‰ˆæœ¬ä¿¡æ¯ï¼Œä»è€Œè·å– @vue/cli ä»¥åŠä¸€äº›æ’ä»¶çš„ç‰ˆæœ¬å·ã€‚</p>
<p>è·å–äº†æ’ä»¶ç‰ˆæœ¬ä¹‹åéå† preset ä¸­æ‰€æœ‰ plugin ä¸ºå…¶åˆå§‹åŒ–ç‰ˆæœ¬å·ã€‚å¹¶è°ƒç”¨ writeFileTree ç”Ÿæˆ package.json ã€‚</p>
<p>åœ¨ç”Ÿæˆ package.json æ–‡ä»¶ä¹‹åä¾¿å¼€å§‹ä¾èµ–çš„æ­£å¼å®‰è£…ï¼Œåœ¨è¿™ä¹‹å‰ä¼šå…ˆè¿›è¡Œåˆ¤æ–­æ˜¯å¦éœ€è¦ git åˆå§‹åŒ–ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> create (cliOptions = &#123;&#125;, preset = <span class="literal">null</span>) &#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="comment">// intilaize git repository before installing deps</span></span><br><span class="line">  <span class="comment">// so that vue-cli-service can setup git hooks.</span></span><br><span class="line">  <span class="keyword">const</span> shouldInitGit = <span class="built_in">this</span>.shouldInitGit(cliOptions)</span><br><span class="line">  <span class="keyword">if</span> (shouldInitGit) &#123;</span><br><span class="line">    log(<span class="string">`ğŸ—ƒ  Initializing git repository...`</span>)</span><br><span class="line">    <span class="built_in">this</span>.emit(<span class="string">&#x27;creation&#x27;</span>, &#123; <span class="attr">event</span>: <span class="string">&#x27;git-init&#x27;</span> &#125;)</span><br><span class="line">    <span class="keyword">await</span> run(<span class="string">&#x27;git init&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// install plugins</span></span><br><span class="line">  log(<span class="string">`âš™\u&#123;fe0f&#125;  Installing CLI plugins. This might take a while...`</span>)</span><br><span class="line">  log()</span><br><span class="line">  <span class="built_in">this</span>.emit(<span class="string">&#x27;creation&#x27;</span>, &#123; <span class="attr">event</span>: <span class="string">&#x27;plugins-install&#x27;</span> &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (isTestOrDebug &amp;&amp; !process.env.VUE_CLI_TEST_DO_INSTALL_PLUGIN) &#123;</span><br><span class="line">    <span class="comment">// in development, avoid installation process</span></span><br><span class="line">    <span class="keyword">await</span> <span class="built_in">require</span>(<span class="string">&#x27;./util/setupDevProject&#x27;</span>)(context)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">await</span> pm.install()</span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™æ®µä»£ç ä¼šå…ˆè°ƒç”¨ shouldInitGit æ¥åˆ¤æ–­æ˜¯å¦éœ€è¦ git åˆå§‹åŒ–ï¼Œåˆ¤æ–­çš„æƒ…å½¢æœ‰ä»¥ä¸‹å‡ ç§ï¼š</p>
<ul>
<li>æ²¡æœ‰å®‰è£… git (!hasGit())ï¼šfalseï¼›</li>
<li>vue create å«æœ‰ --git æˆ–è€… -g é€‰é¡¹ï¼štrueï¼›</li>
<li>vue create å«æœ‰ --no-git æˆ–è€… -n é€‰é¡¹ï¼šfalseï¼›</li>
<li>ç”Ÿæˆé¡¹ç›®çš„ç›®å½•æ˜¯å¦å·²ç»å«æœ‰ git ï¼ˆ!hasProjectGit(this.context)ï¼‰ï¼šå¦‚æœæœ‰ï¼Œåˆ™è¿”å› falseï¼Œå¦åˆ™è¿”å› trueã€‚</li>
</ul>
<p>åœ¨åˆ¤æ–­å®Œæ˜¯å¦éœ€è¦ git åˆå§‹åŒ–é¡¹ç›®åï¼Œæ¥ä¸‹æ¥å°±ä¼šè°ƒç”¨ <code>pm.install</code> å®‰è£…ä¾èµ–ï¼Œè¿˜æ˜¯çœ‹ä¸‹å…¶æºç ï¼š</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> install () &#123;</span><br><span class="line">  <span class="keyword">const</span> args = []</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">this</span>.needsPeerDepsFix) &#123;</span><br><span class="line">    args.push(<span class="string">&#x27;--legacy-peer-deps&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (process.env.VUE_CLI_TEST) &#123;</span><br><span class="line">    args.push(<span class="string">&#x27;--silent&#x27;</span>, <span class="string">&#x27;--no-progress&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">await</span> <span class="built_in">this</span>.runCommand(<span class="string">&#x27;install&#x27;</span>, args)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">async</span> runCommand (command, args) &#123;</span><br><span class="line">  <span class="keyword">const</span> prevNodeEnv = process.env.NODE_ENV</span><br><span class="line">  <span class="comment">// In the use case of Vue CLI, when installing dependencies,</span></span><br><span class="line">  <span class="comment">// the `NODE_ENV` environment variable does no good;</span></span><br><span class="line">  <span class="comment">// it only confuses users by skipping dev deps (when set to `production`).</span></span><br><span class="line">  <span class="keyword">delete</span> process.env.NODE_ENV</span><br><span class="line"></span><br><span class="line">  <span class="keyword">await</span> <span class="built_in">this</span>.setRegistryEnvs()</span><br><span class="line">  <span class="keyword">await</span> executeCommand(</span><br><span class="line">    <span class="built_in">this</span>.bin,</span><br><span class="line">    [</span><br><span class="line">      ...PACKAGE_MANAGER_CONFIG[<span class="built_in">this</span>.bin][command],</span><br><span class="line">      ...(args || [])</span><br><span class="line">    ],</span><br><span class="line">    <span class="built_in">this</span>.context</span><br><span class="line">  )</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (prevNodeEnv) &#123;</span><br><span class="line">    process.env.NODE_ENV = prevNodeEnv</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æºç ä¸­è°ƒç”¨äº† setRegistryEnvs å‡½æ•°ï¼Œå®ƒçš„ä½œç”¨æ˜¯æŒ‡å®šå®‰è£…æºï¼Œå…·ä½“å®ç°å¦‚ä¸‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Any command that implemented registry-related feature should support</span></span><br><span class="line"><span class="comment">// `-r` / `--registry` option</span></span><br><span class="line"><span class="keyword">async</span> getRegistry (scope) &#123;</span><br><span class="line">  <span class="keyword">const</span> cacheKey = scope || <span class="string">&#x27;&#x27;</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">this</span>._registries[cacheKey]) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>._registries[cacheKey]</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> args = minimist(process.argv, &#123;</span><br><span class="line">    alias: &#123;</span><br><span class="line">      r: <span class="string">&#x27;registry&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> registry</span><br><span class="line">  <span class="keyword">if</span> (args.registry) &#123;</span><br><span class="line">    registry = args.registry</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!process.env.VUE_CLI_TEST &amp;&amp; <span class="keyword">await</span> shouldUseTaobao(<span class="built_in">this</span>.bin)) &#123;</span><br><span class="line">    registry = registries.taobao</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (scope) &#123;</span><br><span class="line">        registry = (<span class="keyword">await</span> execa(<span class="built_in">this</span>.bin, [<span class="string">&#x27;config&#x27;</span>, <span class="string">&#x27;get&#x27;</span>, scope + <span class="string">&#x27;:registry&#x27;</span>])).stdout</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (!registry || registry === <span class="string">&#x27;undefined&#x27;</span>) &#123;</span><br><span class="line">        registry = (<span class="keyword">await</span> execa(<span class="built_in">this</span>.bin, [<span class="string">&#x27;config&#x27;</span>, <span class="string">&#x27;get&#x27;</span>, <span class="string">&#x27;registry&#x27;</span>])).stdout</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      <span class="comment">// Yarn 2 uses `npmRegistryServer` instead of `registry`</span></span><br><span class="line">      registry = (<span class="keyword">await</span> execa(<span class="built_in">this</span>.bin, [<span class="string">&#x27;config&#x27;</span>, <span class="string">&#x27;get&#x27;</span>, <span class="string">&#x27;npmRegistryServer&#x27;</span>])).stdout</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">this</span>._registries[cacheKey] = stripAnsi(registry).trim()</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">this</span>._registries[cacheKey]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç¤ºä¾‹ä¸­å¦‚æœ vue create è¿˜æœ‰ -r é€‰é¡¹åˆ™é‡‡ç”¨è®¾ç½®çš„å®‰è£…æºï¼Œå¦åˆ™è°ƒç”¨ shouldUseTaobao å‡½æ•°æ¥åˆ¤æ–­æ˜¯å¦éœ€è¦ä½¿ç”¨æ·˜å® NPM é•œåƒæºï¼Œå¦‚æœä¸¤è€…éƒ½ä¸åŒ¹é…åˆ™ä¼šè°ƒç”¨ <a target="_blank" rel="noopener" href="https://www.npmjs.com/package/execa">execa</a> æ¥ç›´æ¥æ‰§è¡Œ <code>this.bin</code> æ–‡ä»¶ï¼Œè¿™å„¿çš„ bin å±æ€§å®é™…ä¸Šå°±æ˜¯ PackageManager ç±»åˆ›å»ºçš„æ—¶å€™ä¼ å…¥çš„ forcePackageManager å‚æ•°ï¼Œå³ yarn / npm / pnpmï¼Œåœ¨é€‰å®šå®‰è£…æºåç´§æ¥ç€è°ƒç”¨ executeCommand å‡½æ•°ï¼ŒexecuteCommand å‡½æ•°åˆ©ç”¨äº† execa æ‰§è¡Œ npm æˆ–è€… yarn å®‰è£…å‘½ä»¤ã€‚è‡³æ­¤<strong>å®‰è£…ä¾èµ–</strong>çš„æµç¨‹å°±å…¨éƒ¨ç»“æŸäº†ï¼Œæ¥ä¸‹æ¥å°±æ˜¯ <code>vue create</code> æœ€æ ¸å¿ƒçš„éƒ¨åˆ†<strong>ä»£ç ç”Ÿæˆ</strong>ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> create (cliOptions = &#123;&#125;, preset = <span class="literal">null</span>) &#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="comment">// run generator</span></span><br><span class="line">  log(<span class="string">`ğŸš€  Invoking generators...`</span>)</span><br><span class="line">  <span class="built_in">this</span>.emit(<span class="string">&#x27;creation&#x27;</span>, &#123; <span class="attr">event</span>: <span class="string">&#x27;invoking-generators&#x27;</span> &#125;)</span><br><span class="line">  <span class="keyword">const</span> plugins = <span class="keyword">await</span> <span class="built_in">this</span>.resolvePlugins(preset.plugins, pkg)</span><br><span class="line">  <span class="keyword">const</span> generator = <span class="keyword">new</span> Generator(context, &#123;</span><br><span class="line">    pkg,</span><br><span class="line">    plugins,</span><br><span class="line">    afterInvokeCbs,</span><br><span class="line">    afterAnyInvokeCbs</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">await</span> generator.generate(&#123;</span><br><span class="line">    extractConfigFiles: preset.useConfigFiles</span><br><span class="line">  &#125;)</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç¤ºä¾‹ä¸­åœ¨å®ä¾‹åŒ– Generator å®ä¾‹ä¹‹å‰è°ƒç”¨äº† resolvePlugins å¯¹æ’ä»¶è¿›è¡Œåˆå§‹åŒ–ï¼Œä¸¾ä¸ªä¾‹å­ï¼š<code>[&#123; '@vue/cli-plugin-babel': &#123; useTsWithBabel: true &#125; &#125;]</code> çš„å…¥å‚å°†è¢«è½¬åŒ–ç”Ÿæˆ <code>[&#123; id: '@vue/cli-plugin-babel', apply, options: &#123; useTsWithBabel: true &#125;&#125;]</code>ï¼Œè¿™å„¿ä¸»è¦çš„ä¸åŒæ˜¯å¤šäº† apply å¯¹è±¡ï¼Œå®é™…ä¸Šäº†å¯¹åº”æ’ä»¶ä¸‹ <code>generator</code> æ–‡ä»¶çš„åŠ è½½å¯¹è±¡ï¼Œåœ¨ç¤ºä¾‹ä¸­ä¹Ÿå°±æ˜¯ <code>@vue/cli-plugin-babel/generator</code> æ–‡ä»¶ã€‚</p>
<p>å†å®Œæˆäº†å¯¹æ’ä»¶çš„åˆå§‹åŒ–å’Œæ¯ä¸ªæ’ä»¶ä¸‹çš„ <code>generator.js</code> æ–‡ä»¶çš„åŠ è½½åæ­£å¼å¼€å§‹ Generator å®ä¾‹çš„åˆ›å»ºï¼Œåœ¨å®ä¾‹åŒ–ä¸€ä¸ª Generator çš„æ—¶å€™ä¼šåˆå§‹åŒ–ä¸€äº›æˆå‘˜å˜é‡ï¼Œæœ€é‡è¦çš„å°±æ˜¯è°ƒç”¨æ’ä»¶çš„ generatorsï¼Œä¸åŒäº 1.x/2.x åŸºäºæ¨¡æ¿çš„è„šæ‰‹æ¶ï¼ŒVue-cli3.0 é‡‡ç”¨äº†ä¸€å¥— åŸºäºæ’ä»¶çš„æ¶æ„ï¼Œåˆ°è¿™é‡Œå°±ä¼šäº¤ç»™å„ä¸ªæ’ä»¶å»æ‰§è¡Œäº†ï¼Œçœ‹ä¸€ä¸‹ Generator å®ä¾‹åŒ–çš„ä»£ç ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="class"><span class="keyword">class</span> <span class="title">Generator</span> </span>&#123;</span><br><span class="line">  <span class="title">constructor</span> (<span class="params">context, &#123;</span></span><br><span class="line"><span class="params">    pkg = &#123;&#125;,</span></span><br><span class="line"><span class="params">    plugins = [],</span></span><br><span class="line"><span class="params">    afterInvokeCbs = [],</span></span><br><span class="line"><span class="params">    afterAnyInvokeCbs = [],</span></span><br><span class="line"><span class="params">    files = &#123;&#125;,</span></span><br><span class="line"><span class="params">    invoking = <span class="literal">false</span></span></span><br><span class="line"><span class="params">  &#125; = &#123;&#125;</span>) &#123;</span><br><span class="line">    <span class="built_in">this</span>.context = context</span><br><span class="line">    <span class="built_in">this</span>.plugins = plugins</span><br><span class="line">    <span class="built_in">this</span>.originalPkg = pkg</span><br><span class="line">    <span class="built_in">this</span>.pkg = <span class="built_in">Object</span>.assign(&#123;&#125;, pkg)</span><br><span class="line">    <span class="built_in">this</span>.pm = <span class="keyword">new</span> PackageManager(&#123; context &#125;)</span><br><span class="line">    <span class="built_in">this</span>.imports = &#123;&#125;</span><br><span class="line">    <span class="built_in">this</span>.rootOptions = &#123;&#125;</span><br><span class="line">    <span class="built_in">this</span>.afterInvokeCbs = afterInvokeCbs</span><br><span class="line">    <span class="built_in">this</span>.afterAnyInvokeCbs = afterAnyInvokeCbs</span><br><span class="line">    <span class="built_in">this</span>.configTransforms = &#123;&#125; <span class="comment">// æ’ä»¶é€šè¿‡ GeneratorAPI æš´éœ²çš„ addConfigTransform æ–¹æ³•æ·»åŠ å¦‚ä½•æå–é…ç½®æ–‡ä»¶</span></span><br><span class="line">    <span class="built_in">this</span>.defaultConfigTransforms = defaultConfigTransforms <span class="comment">// é»˜è®¤çš„é…ç½®æ–‡ä»¶</span></span><br><span class="line">    <span class="built_in">this</span>.reservedConfigTransforms = reservedConfigTransforms <span class="comment">// ä¿ç•™çš„é…ç½®æ–‡ä»¶ vue.config.js</span></span><br><span class="line">    <span class="built_in">this</span>.invoking = invoking</span><br><span class="line">    <span class="comment">// for conflict resolution</span></span><br><span class="line">    <span class="built_in">this</span>.depSources = &#123;&#125;</span><br><span class="line">    <span class="comment">// virtual file tree</span></span><br><span class="line">    <span class="built_in">this</span>.files = <span class="built_in">Object</span>.keys(files).length</span><br><span class="line">      <span class="comment">// when execute `vue add/invoke`, only created/modified files are written to disk</span></span><br><span class="line">      ? watchFiles(files, <span class="built_in">this</span>.filesModifyRecord = <span class="keyword">new</span> <span class="built_in">Set</span>())</span><br><span class="line">      <span class="comment">// all files need to be written to disk</span></span><br><span class="line">      : files</span><br><span class="line">    <span class="built_in">this</span>.fileMiddlewares = []</span><br><span class="line">    <span class="built_in">this</span>.postProcessFilesCbs = []</span><br><span class="line">    <span class="comment">// exit messages</span></span><br><span class="line">    <span class="built_in">this</span>.exitLogs = []</span><br><span class="line"></span><br><span class="line">    <span class="comment">// load all the other plugins</span></span><br><span class="line">    <span class="built_in">this</span>.allPluginIds = <span class="built_in">Object</span>.keys(<span class="built_in">this</span>.pkg.dependencies || &#123;&#125;)</span><br><span class="line">      .concat(<span class="built_in">Object</span>.keys(<span class="built_in">this</span>.pkg.devDependencies || &#123;&#125;))</span><br><span class="line">      .filter(isPlugin)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> cliService = plugins.find(<span class="function"><span class="params">p</span> =&gt;</span> p.id === <span class="string">&#x27;@vue/cli-service&#x27;</span>)</span><br><span class="line">    <span class="keyword">const</span> rootOptions = cliService</span><br><span class="line">      ? cliService.options</span><br><span class="line">      : inferRootOptions(pkg)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">this</span>.rootOptions = rootOptions</span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç„¶åæŸ¥çœ‹å…¶å…·ä½“è¢«è°ƒç”¨å®ä¾‹çš„ generate æ–¹æ³•ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> generate (&#123;</span><br><span class="line">  extractConfigFiles = <span class="literal">false</span>,</span><br><span class="line">  checkExisting = <span class="literal">false</span></span><br><span class="line">&#125; = &#123;&#125;) &#123;</span><br><span class="line">  <span class="keyword">await</span> <span class="built_in">this</span>.initPlugins()</span><br><span class="line"></span><br><span class="line">  <span class="comment">// save the file system before applying plugin for comparison</span></span><br><span class="line">  <span class="keyword">const</span> initialFiles = <span class="built_in">Object</span>.assign(&#123;&#125;, <span class="built_in">this</span>.files)</span><br><span class="line">  <span class="comment">// extract configs from package.json into dedicated files.</span></span><br><span class="line">  <span class="built_in">this</span>.extractConfigFiles(extractConfigFiles, checkExisting)</span><br><span class="line">  <span class="comment">// wait for file resolve</span></span><br><span class="line">  <span class="keyword">await</span> <span class="built_in">this</span>.resolveFiles()</span><br><span class="line">  <span class="comment">// set package.json</span></span><br><span class="line">  <span class="built_in">this</span>.sortPkg()</span><br><span class="line">  <span class="built_in">this</span>.files[<span class="string">&#x27;package.json&#x27;</span>] = <span class="built_in">JSON</span>.stringify(<span class="built_in">this</span>.pkg, <span class="literal">null</span>, <span class="number">2</span>) + <span class="string">&#x27;\n&#x27;</span></span><br><span class="line">  <span class="comment">// write/update file tree to disk</span></span><br><span class="line">  <span class="keyword">await</span> writeFileTree(<span class="built_in">this</span>.context, <span class="built_in">this</span>.files, initialFiles, <span class="built_in">this</span>.filesModifyRecord)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™å„¿ initPlugins çš„ä¸»è¦ä½œç”¨æ˜¯ä¸ºæ¯ä¸ªæ’ä»¶å¯¹åº”ç”Ÿæˆä¸€ä¸ª GeneratorAPI å®ä¾‹ï¼ŒåŒæ—¶å°†å®ä¾‹ä½œä¸ºå‚æ•°ä¼ é€’ç»™å‰é¢æ’ä»¶åˆå§‹åŒ–æ—¶ç”Ÿæˆçš„æ’ä»¶ä¸‹ <code>generator</code> æ–‡ä»¶çš„åŠ è½½å¯¹è±¡ï¼Œä¹Ÿå¯ä»¥ç†è§£ä¸ºå°†å®ä¾‹ api ä¼ å…¥æ’ä»¶æš´éœ²å‡ºæ¥çš„ generator å‡½æ•°ï¼Œè¿™å„¿çš„æœ€é‡è¦çš„å°±æ˜¯ GeneratorAPI äº†ã€‚</p>
<p>å‰é¢è¯´åˆ° Vue CLI æ˜¯åŸºäºä¸€å¥—æ’ä»¶æ¶æ„çš„ï¼Œé‚£ä¹ˆå¦‚æœæ’ä»¶éœ€è¦è‡ªå®šä¹‰é¡¹ç›®æ¨¡æ¿ã€ä¿®æ”¹æ¨¡æ¿ä¸­çš„ä¸€äº›æ–‡ä»¶æˆ–è€…æ·»åŠ ä¸€äº›ä¾èµ–çš„è¯æ€ä¹ˆå¤„ç†å‘¢ï¼Ÿæ–¹æ³•æ˜¯ @vue/cli æ’ä»¶æ‰€æä¾›çš„ generator å‘å¤–æš´éœ²ä¸€ä¸ªå‡½æ•°ï¼Œæ¥æ”¶çš„ç¬¬ä¸€ä¸ªå‚æ•° apiï¼Œç„¶åé€šè¿‡è¯¥ api æä¾›çš„æ–¹æ³•å»å®Œæˆåº”ç”¨çš„æ‹“å±•å·¥ä½œï¼Œè¿™é‡Œæ‰€è¯´ çš„ api å°±æ˜¯ GeneratorAPIï¼Œä¸‹é¢çœ‹ä¸€ä¸‹ GeneratorAPI æä¾›äº†å“ªäº›æ–¹æ³•ã€‚</p>
<ul>
<li>hasPluginï¼šåˆ¤æ–­é¡¹ç›®ä¸­æ˜¯å¦æœ‰æŸä¸ªæ’ä»¶</li>
<li>extendPackageï¼šæ‹“å±• package.json é…ç½®</li>
<li>renderï¼šåˆ©ç”¨ ejs æ¸²æŸ“æ¨¡æ¿æ–‡ä»¶</li>
<li>onCreateCompleteï¼šå†…å­˜ä¸­ä¿å­˜çš„æ–‡ä»¶å­—ç¬¦ä¸²å…¨éƒ¨è¢«å†™å…¥æ–‡ä»¶åçš„å›è°ƒå‡½æ•°</li>
<li>exitLogï¼šå½“ generator é€€å‡ºçš„æ—¶å€™è¾“å‡ºçš„ä¿¡æ¯</li>
<li>genJSConfigï¼šå°† json æ–‡ä»¶ç”Ÿæˆä¸º js é…ç½®æ–‡ä»¶</li>
<li>injectImportsï¼šå‘æ–‡ä»¶å½“ä¸­æ³¨å…¥importè¯­æ³•çš„æ–¹æ³•</li>
<li>injectRootOptionsï¼šå‘ Vue æ ¹å®ä¾‹ä¸­æ·»åŠ é€‰é¡¹</li>
<li>â€¦</li>
</ul>
<p>ä¸‹é¢ä»¥ <code>@vue/cli-service/generator/index.js</code> ä¸ºä¾‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function">(<span class="params">api, options</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">/* æ¸²æŸ“ ejs æ¨¡æ¿ */</span></span><br><span class="line">  api.render(<span class="string">&#x27;./template&#x27;</span>, &#123;</span><br><span class="line">    doesCompile: api.hasPlugin(<span class="string">&#x27;babel&#x27;</span>) || api.hasPlugin(<span class="string">&#x27;typescript&#x27;</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// æ‰©å±• package.json</span></span><br><span class="line">  api.extendPackage(&#123;</span><br><span class="line">    scripts: &#123;</span><br><span class="line">      <span class="string">&#x27;serve&#x27;</span>: <span class="string">&#x27;vue-cli-service serve&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;build&#x27;</span>: <span class="string">&#x27;vue-cli-service build&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    dependencies: &#123;</span><br><span class="line">      <span class="string">&#x27;vue&#x27;</span>: <span class="string">&#x27;^2.5.17&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    devDependencies: &#123;</span><br><span class="line">      <span class="string">&#x27;vue-template-compiler&#x27;</span>: <span class="string">&#x27;^2.5.17&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&#x27;postcss&#x27;</span>: &#123;</span><br><span class="line">      <span class="string">&#x27;plugins&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;autoprefixer&#x27;</span>: &#123;&#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    browserslist: [</span><br><span class="line">      <span class="string">&#x27;&gt; 1%&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;last 2 versions&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;not ie &lt;= 8&#x27;</span></span><br><span class="line">    ]</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">// å¦‚æœ preset ä¸­åŒ…å« vue-router</span></span><br><span class="line">  <span class="keyword">if</span> (options.router) &#123;</span><br><span class="line">    <span class="built_in">require</span>(<span class="string">&#x27;./router&#x27;</span>)(api, options)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// å¦‚æœ preset ä¸­åŒ…å« vuex</span></span><br><span class="line">  <span class="keyword">if</span> (options.vuex) &#123;</span><br><span class="line">    <span class="built_in">require</span>(<span class="string">&#x27;./vuex&#x27;</span>)(api, options)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// å¦‚æœ preset ä¸­åŒ…å« cssPreprocessorï¼Œå³é€‰æ‹©äº† css é¢„å¤„ç†å™¨</span></span><br><span class="line">  <span class="keyword">if</span> (options.cssPreprocessor) &#123;</span><br><span class="line">    <span class="keyword">const</span> deps = &#123;</span><br><span class="line">      sass: &#123;</span><br><span class="line">        <span class="string">&#x27;node-sass&#x27;</span>: <span class="string">&#x27;^4.9.0&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;sass-loader&#x27;</span>: <span class="string">&#x27;^7.0.1&#x27;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      less: &#123;</span><br><span class="line">        <span class="string">&#x27;less&#x27;</span>: <span class="string">&#x27;^3.0.4&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;less-loader&#x27;</span>: <span class="string">&#x27;^4.1.0&#x27;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      stylus: &#123;</span><br><span class="line">        <span class="string">&#x27;stylus&#x27;</span>: <span class="string">&#x27;^0.54.5&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;stylus-loader&#x27;</span>: <span class="string">&#x27;^3.0.2&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    api.extendPackage(&#123;</span><br><span class="line">      devDependencies: deps[options.cssPreprocessor]</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// additional tooling configurations</span></span><br><span class="line">  <span class="keyword">if</span> (options.configs) &#123;</span><br><span class="line">    api.extendPackage(options.configs)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡ç¤ºä¾‹æˆ‘ä»¬å¯ä»¥æ„Ÿå—åˆ° vue-cli 3.0 çš„æ’ä»¶æœºåˆ¶çš„æ ¸å¿ƒï¼š<strong>é€šè¿‡ GeneratorAPI æ‰€æš´éœ²çš„æ–¹æ³•å°†æ‰€æœ‰åŠŸèƒ½éƒ½äº¤ç»™æ’ä»¶å»å®Œæˆ</strong>ã€‚å¯¹äº vue-cli 3.0 å†…ç½®çš„æ’ä»¶ï¼Œæ¯”å¦‚ï¼š@vue/cli-plugin-eslint ã€@vue/cli-plugin-pwa ç­‰ç­‰ï¼Œä»¥åŠå…¶ä»–ç¬¬ä¸‰æ–¹æ’ä»¶ï¼Œä»–ä»¬çš„ generator ä½œç”¨éƒ½æ˜¯ä¸€æ ·éƒ½å¯ä»¥å‘é¡¹ç›®çš„ package.json ä¸­æ³¨å…¥é¢å¤–çš„ä¾èµ–æˆ–å­—æ®µï¼Œå¹¶å‘é¡¹ç›®ä¸­æ·»åŠ æ–‡ä»¶ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥ç»“åˆ GeneratorAPI æ‰€æš´éœ²çš„æ–¹æ³•è‡ªå®šä¹‰æ’ä»¶ï¼Œå› æ­¤ vue-cli 3.0 çš„æ’ä»¶æœºåˆ¶ç»™äºˆäº†æˆ‘ä»¬æå¤§çš„çµæ´»æ€§ä¸æ‰©å±•æ€§ã€‚</p>
<p>åœ¨å®Œæˆå¯¹æ¯ä¸ªæ’ä»¶çš„å¤„ç†ä¹‹åå¼€å§‹è¿›å…¥åˆ°äº†<strong>ç”Ÿæˆé¡¹ç›®æ–‡ä»¶</strong>çš„é˜¶æ®µï¼Œå¤§è‡´å¯ä»¥åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼Œ<strong>extractConfigFilesï¼ˆæå–é…ç½®æ–‡ä»¶ï¼‰</strong>ï¼Œ<strong>resolveFilesï¼ˆæ¨¡æ¿æ¸²æŸ“ï¼‰</strong> å’Œ <strong>writeFileTreeï¼ˆåœ¨ç£ç›˜ä¸Šç”Ÿæˆæ–‡ä»¶ï¼‰</strong>ã€‚</p>
<p>1ã€ extractConfigFiles</p>
<p>æå–é…ç½®æ–‡ä»¶æŒ‡çš„æ˜¯å°†ä¸€äº›æ’ä»¶ï¼ˆæ¯”å¦‚ eslintï¼Œbabelï¼‰çš„é…ç½®ä» package.json çš„å­—æ®µä¸­æå–åˆ°ä¸“å±çš„é…ç½®æ–‡ä»¶ä¸­ã€‚ä¸‹é¢ä»¥ eslint ä¸ºä¾‹è¿›è¡Œåˆ†æï¼š åœ¨åˆå§‹åŒ–é¡¹ç›®çš„æ—¶å€™ï¼Œå¦‚æœé€‰æ‹©äº† eslint æ’ä»¶ï¼Œåœ¨è°ƒç”¨ @vue/cli-plugin-eslint çš„ generator çš„æ—¶å€™ï¼Œå°±ä¼šå‘ package.json æ³¨å…¥ eslintConfig å­—æ®µï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function">(<span class="params">api, &#123; config, lintOn = [] &#125;, _, invoking</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> lintOn === <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">    lintOn = lintOn.split(<span class="string">&#x27;,&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> eslintConfig = <span class="built_in">require</span>(<span class="string">&#x27;../eslintOptions&#x27;</span>).config(api)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> pkg = &#123;</span><br><span class="line">    scripts: &#123;</span><br><span class="line">      lint: <span class="string">&#x27;vue-cli-service lint&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    eslintConfig,</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span></span></span><br><span class="line">    <span class="comment">// Move these dependencies to package.json in v4.</span></span><br><span class="line">    <span class="comment">// Now in v3 we have to add redundant eslint related dependencies</span></span><br><span class="line">    <span class="comment">// in order to keep compatibility with v3.0.x users who defaults to ESlint v4.</span></span><br><span class="line">    devDependencies: &#123;</span><br><span class="line">      <span class="string">&#x27;babel-eslint&#x27;</span>: <span class="string">&#x27;^10.0.1&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;eslint&#x27;</span>: <span class="string">&#x27;^5.8.0&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;esliint-plugin-vue&#x27;</span>: <span class="string">&#x27;^5.0.0-0&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> injectEditorConfig = <span class="function">(<span class="params">config</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> filePath = api.resolve(<span class="string">&#x27;.editorconfig&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> (fs.existsSync(filePath)) &#123;</span><br><span class="line">      <span class="comment">// Append to existing .editorconfig</span></span><br><span class="line">      api.render(<span class="function"><span class="params">files</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> configPath = path.resolve(__dirname, <span class="string">`./template/<span class="subst">$&#123;config&#125;</span>/_editorconfig`</span>)</span><br><span class="line">        <span class="keyword">const</span> editorconfig = fs.readFileSync(configPath, <span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        files[<span class="string">&#x27;.editorconfig&#x27;</span>] += <span class="string">`\n<span class="subst">$&#123;editorconfig&#125;</span>`</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      api.render(<span class="string">`./template/<span class="subst">$&#123;config&#125;</span>`</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (config === <span class="string">&#x27;airbnb&#x27;</span>) &#123;</span><br><span class="line">    eslintConfig.extends.push(<span class="string">&#x27;@vue/airbnb&#x27;</span>)</span><br><span class="line">    <span class="built_in">Object</span>.assign(pkg.devDependencies, &#123;</span><br><span class="line">      <span class="string">&#x27;@vue/eslint-config-airbnb&#x27;</span>: <span class="string">&#x27;^4.0.0&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">    injectEditorConfig(<span class="string">&#x27;airbnb&#x27;</span>)</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (config === <span class="string">&#x27;standard&#x27;</span>) &#123;</span><br><span class="line">    eslintConfig.extends.push(<span class="string">&#x27;@vue/standard&#x27;</span>)</span><br><span class="line">    <span class="built_in">Object</span>.assign(pkg.devDependencies, &#123;</span><br><span class="line">      <span class="string">&#x27;@vue/eslint-config-standard&#x27;</span>: <span class="string">&#x27;^4.0.0&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">    injectEditorConfig(<span class="string">&#x27;standard&#x27;</span>)</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (config === <span class="string">&#x27;prettier&#x27;</span>) &#123;</span><br><span class="line">    eslintConfig.extends.push(<span class="string">&#x27;@vue/prettier&#x27;</span>)</span><br><span class="line">    <span class="built_in">Object</span>.assign(pkg.devDependencies, &#123;</span><br><span class="line">      <span class="string">&#x27;@vue/eslint-config-prettier&#x27;</span>: <span class="string">&#x27;^4.0.0&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">// prettier &amp; default config do not have any style rules</span></span><br><span class="line">    <span class="comment">// so no need to generate an editorconfig file</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// default</span></span><br><span class="line">    eslintConfig.extends.push(<span class="string">&#x27;eslint:recommended&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  api.extendPackage(pkg)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™æ˜¯ <code>@vue/cli-plugin-eslint/generator/index.js</code> ä¸­çš„ä¸€éƒ¨åˆ†ä»£ç ï¼Œä»ä»£ç ä¸­å¯ä»¥çœ‹å‡ºï¼Œåˆ©ç”¨ GeneratorAPI çš„ extendPackage æ–¹æ³•å‘ package.josn é‡Œé¢æ³¨å…¥äº† scriptsï¼ŒeslintConfig ä»¥åŠ devDependencies å­—æ®µï¼Œå¦å¤–ä¹Ÿä¼šæ ¹æ®é€‰æ‹©çš„ eslint æ¨¡å¼æ·»åŠ å¯¹åº”çš„ä¾èµ–å’Œä¿®æ”¹å¯¹åº”çš„é…ç½®æ–‡ä»¶ï¼Œä¾‹å¦‚é€‰æ‹©äº† airbnb æ¨¡å¼ï¼Œå°±ä¼šå‘ eslintConfig.extends æ·»åŠ  @vue/airbnb é…ç½®ï¼Œå¹¶ä¸”æ·»åŠ  @vue/eslint-config-airbnb ä¾èµ–å’Œä¿®æ”¹ .editorconfig é…ç½®æ–‡ä»¶ã€‚æ­¤æ—¶ é¡¹ç›® package.json ä¸­ eslintConfig å­—æ®µå†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"><span class="attr">&quot;eslintConfig&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;root&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">&quot;env&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;node&quot;</span>: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;extends&quot;</span>: [</span><br><span class="line">      <span class="string">&quot;plugin:vue/essential&quot;</span>,</span><br><span class="line">      <span class="string">&quot;@vue/airbnb&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">&quot;rules&quot;</span>: &#123;&#125;,</span><br><span class="line">    <span class="attr">&quot;parserOptions&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;parser&quot;</span>: <span class="string">&quot;babel-eslint&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¦‚æœ preset çš„ useConfigFiles ä¸º true ï¼Œæˆ–è€…ä»¥ Manually æ¨¡å¼åˆå§‹åŒ– preset çš„æ—¶å€™é€‰æ‹© In dedicated config files å­˜æ”¾é…ç½®æ–‡ä»¶ï¼Œé‚£ä¹ˆ extractConfigFiles æ–¹æ³•å°±ä¼šå°† package.json ä¸­ eslintConfig å­—æ®µå†…å®¹æå–åˆ° .eslintrc.js æ–‡ä»¶ä¸­ï¼Œå†…å­˜ä¸­ .eslintrc.js å†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  root: <span class="literal">true</span>,</span><br><span class="line">  env: &#123;</span><br><span class="line">    node: <span class="literal">true</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="keyword">extends</span>: [</span><br><span class="line">    <span class="string">&#x27;plugin:vue/essential&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;@vue/airbnb&#x27;</span>,</span><br><span class="line">  ],</span><br><span class="line">  rules: &#123;</span><br><span class="line">    <span class="string">&#x27;no-console&#x27;</span>: process.env.NODE_ENV === <span class="string">&#x27;production&#x27;</span> ? <span class="string">&#x27;error&#x27;</span> : <span class="string">&#x27;off&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;no-debugger&#x27;</span>: process.env.NODE_ENV === <span class="string">&#x27;production&#x27;</span> ? <span class="string">&#x27;error&#x27;</span> : <span class="string">&#x27;off&#x27;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  parserOptions: &#123;</span><br><span class="line">    parser: <span class="string">&#x27;babel-eslint&#x27;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>extractConfigFiles æ–¹æ³•çš„å…·ä½“å®ç°ä¸»è¦æ˜¯è°ƒç”¨ ConfigTransform å®ä¾‹çš„ transform æ–¹æ³•ï¼Œä»£ç å®ç°çš„æ¯”è¾ƒæ¸…æ™°ï¼Œå„ä½åŒå­¦å¯ä»¥è‡ªå·±çœ‹ä¸‹ã€‚è¿™é‡Œå°±ä¸åšè¯¦ç»† åˆ†æäº†ï¼Œåœ¨é…ç½®æ–‡ä»¶æå–å®Œäº†ä»¥åæ¥ä¸‹æ¥å°±æ˜¯æ‰§è¡Œ resolveFiles å‡½æ•°äº†ã€‚</p>
<p>2ã€ resolveFiles</p>
<p>resolveFiles ä¸»è¦åˆ†ä¸ºä»¥ä¸‹ä¸‰ä¸ªéƒ¨åˆ†æ‰§è¡Œï¼š</p>
<ul>
<li>fileMiddlewares</li>
<li>injectImportsAndOptions</li>
<li>postProcessFilesCbs</li>
</ul>
<p>fileMiddlewares é‡Œé¢åŒ…å«äº† ejs render å‡½æ•°ï¼Œæ‰€æœ‰æ’ä»¶è°ƒç”¨ api.render æ—¶å€™åªæ˜¯æŠŠå¯¹åº”çš„æ¸²æŸ“å‡½æ•° push åˆ°äº† fileMiddlewares ä¸­ï¼Œç­‰æ‰€æœ‰çš„ æ’ä»¶æ‰§è¡Œå®Œä»¥åæ‰ä¼šéå†æ‰§è¡Œ fileMiddlewares é‡Œé¢çš„æ‰€æœ‰å‡½æ•°ï¼Œå³åœ¨å†…å­˜ä¸­ç”Ÿæˆæ¨¡æ¿æ–‡ä»¶å­—ç¬¦ä¸²ã€‚</p>
<p>injectImportsAndOptions å°±æ˜¯å°† generator æ³¨å…¥çš„ import å’Œ rootOption è§£æåˆ°å¯¹åº”çš„æ–‡ä»¶ä¸­ï¼Œæ¯”å¦‚é€‰æ‹©äº† vuex, ä¼šåœ¨ src/main.js ä¸­æ·»åŠ  import store from â€˜./storeâ€™ï¼Œä»¥åŠåœ¨ vue æ ¹å®ä¾‹ä¸­æ·»åŠ  router é€‰é¡¹ã€‚</p>
<p>postProcessFilesCbs æ˜¯åœ¨æ‰€æœ‰æ™®é€šæ–‡ä»¶åœ¨å†…å­˜ä¸­æ¸²æŸ“æˆå­—ç¬¦ä¸²å®Œæˆä¹‹åè¦æ‰§è¡Œçš„éå†å›è°ƒã€‚ä¾‹å¦‚å°† @vue/cli-service/generator/index.js ä¸­çš„ render æ˜¯æ”¾åœ¨äº† fileMiddlewares é‡Œé¢ï¼Œè€Œå°† @vue/cli-service/generator/router/index.js ä¸­å°†æ›¿æ¢ src/App.vue æ–‡ä»¶çš„æ–¹æ³•æ”¾åœ¨äº† postProcessFiles é‡Œé¢ï¼ŒåŸå› æ˜¯å¯¹ src/App.vue æ–‡ä»¶çš„ä¸€äº›æ›¿æ¢ä¸€å®šæ˜¯å‘ç”Ÿåœ¨ render å‡½æ•°ä¹‹åï¼Œå¦‚æœåœ¨ä¹‹å‰ï¼Œä¿®æ”¹åçš„ src/App.vue åœ¨ä¹‹å render å‡½æ•°æ‰§è¡Œæ—¶åˆä¼šè¢«è¦†ç›–ï¼Œè¿™æ ·æ˜¾ç„¶ä¸åˆç†ã€‚</p>
<p>3ã€ writeFileTree</p>
<p>åœ¨æå–äº†é…ç½®æ–‡ä»¶å’Œæ¨¡æ¿æ¸²æŸ“ä¹‹åè°ƒç”¨äº† sortPkg å¯¹ package.json çš„å­—æ®µè¿›è¡Œäº†æ’åºå¹¶å°† package.json è½¬åŒ–ä¸º json å­—ç¬¦ä¸²æ·»åŠ åˆ°é¡¹ç›®çš„ files ä¸­ã€‚ æ­¤æ—¶æ•´ä¸ªé¡¹ç›®çš„æ–‡ä»¶å·²ç»åœ¨å†…å­˜ä¸­ç”Ÿæˆå¥½äº†ï¼ˆåœ¨æºç ä¸­å°±æ˜¯å¯¹åº”çš„ this.filesï¼‰ï¼Œæ¥ä¸‹æ¥å°±è°ƒç”¨ writeFileTree æ–¹æ³•å°†å†…å­˜ä¸­çš„å­—ç¬¦ä¸²æ¨¡æ¿æ–‡ä»¶ç”Ÿæˆåœ¨ç£ç›˜ä¸­ã€‚åˆ°è¿™é‡Œ vue create æ ¸å¿ƒéƒ¨åˆ† generator åŸºæœ¬ä¸Šå°±åˆ†æå®Œäº†ã€‚</p>
<img src="/assets/emoji/04.png" width="280" />
<p>æ¥ä¸‹æ¥åœ¨ <code>../lib/Creator.js</code> æ–‡ä»¶çš„ create æ–¹æ³•ä¸­è¿˜æœ‰ä¸€äº›å…¶ä»–é¢å¤–å¤„ç†ï¼Œä¸»è¦åŒ…æ‹¬ï¼š</p>
<ul>
<li>å®‰è£…é¢å¤–ä¾èµ–ï¼šè¿™é‡Œçš„ä¾èµ–æ¥æºäº preset çš„ optionï¼Œæ¯”å¦‚é€‰æ‹©äº† scss css é¢„å¤„ç†å™¨ï¼Œé‚£ä¹ˆå°±éœ€è¦é¢å¤–å®‰è£… node-sass å’Œ sass-loader ä¸¤ä¸ªä¾èµ–ã€‚</li>
<li>æ‰§è¡Œ createCompleteCbsï¼šæ‰€æœ‰æ–‡ä»¶éƒ½å†™åœ¨ç£ç›˜åæ‰§è¡Œçš„éå†å›è°ƒã€‚</li>
<li>ç”Ÿæˆ <a target="_blank" rel="noopener" href="http://README.md">README.md</a>ï¼šæ ¹æ® package.json çš„ script çš„å­—æ®µç”Ÿæˆç”Ÿæˆå¯¹åº”çš„ <a target="_blank" rel="noopener" href="http://README.md">README.md</a>ã€‚</li>
<li>git åˆå§‹åŒ–æäº¤ï¼šè°ƒç”¨ shouldInitGit æ¥åˆ¤æ–­æ˜¯å¦éœ€è¦ git åˆå§‹åŒ–æäº¤ï¼Œå¦‚æœéœ€è¦åˆå§‹åŒ–æäº¤å°±ä¼šæ‰§è¡Œ git add å’Œ git commmit å‘½ä»¤ã€‚</li>
<li>æ—¥å¿—è¾“å‡ºï¼šæ’ä»¶çš„ generator å¯ä»¥åˆ©ç”¨ GeneratorAPI æš´éœ²çš„ exitLog æ–¹æ³•åœ¨é¡¹ç›®è¾“å‡ºå…¶ä»–æ‰€æœ‰çš„ message ä¹‹åè¾“å‡ºä¸€äº›æ—¥å¿—ã€‚</li>
</ul>
<p><strong>æ€»ç»“ï¼š</strong></p>
<p>vue create å‘½ä»¤æ€»çš„æ¥è¯´å°±å®ä¾‹åŒ–äº†2ä¸ªç±»ï¼Œç„¶åå„è‡ªè°ƒäº†ä¸€ä¸ªæ–¹æ³•ã€‚å½“æ‰§è¡Œ create å‘½ä»¤æ—¶ä¼šåˆ›å»ºä¸€ä¸ª Creator å®ä¾‹ï¼Œ ç„¶åè°ƒç”¨å…¶ create æ–¹æ³•ã€‚åœ¨ create æ–¹æ³•ä¸­åˆä¼šåˆ›å»ºä¸€ä¸ª Generator å®ä¾‹ï¼Œç„¶åå†è°ƒç”¨å…¶ generator æ–¹æ³•ï¼Œåˆå§‹åŒ–æ•´ä¸ªé¡¹ç›®ä¼šäº¤ç»™å„ä¸ªæ’ä»¶å»å®Œæˆã€‚æ¯”å¦‚æ ¸å¿ƒæ’ä»¶ @vue/cli-service ä¼šæ¸²æŸ“æ•´ä¸ªé¡¹ç›®çš„æ–‡ä»¶ï¼Œ@vue/cli-plugin-eslint ä¼šè¿›è¡Œ eslint çš„ä¸€äº›é…ç½®ï¼Œ @vue/cli-plugin-unit-jest æ’ä»¶ä¹Ÿä¼šè¿›è¡Œä¸€äº› jest çš„é…ç½®ï¼Œå„ä¸ªåŠŸèƒ½éƒ½ä¼šäº¤ç»™å¯¹åº”çš„æ’ä»¶å»å®Œæˆï¼Œè€Œ GeneratorAPI åˆå…è®¸ä¸€ä¸ªæ’ä»¶çš„ generator å‘ package.json æ³¨å…¥é¢å¤–çš„ä¾èµ–æˆ–å­—æ®µï¼Œå¹¶å‘é¡¹ç›®ä¸­æ·»åŠ æ–‡ä»¶ï¼Œè¿™ä¹Ÿè®©æ’ä»¶å¯¹æ•´ä¸ªé¡¹ç›®æ‹¥æœ‰æ›´é«˜çš„å¯é…ç½®æ€§ã€‚</p>
<h4 id="2-add-å‘½ä»¤"><a class="markdownIt-Anchor" href="#2-add-å‘½ä»¤"></a> 2ã€add å‘½ä»¤</h4>
<p>æ–‡ç« å‰é¢é€šè¿‡è§£æ vue create å‘½ä»¤çš„å…·ä½“æ‰§è¡Œæµç¨‹ä»‹ç»äº†é¡¹ç›®åˆ›å»ºåˆå§‹åŒ–çš„ä¸»è¦è¿‡ç¨‹ï¼Œå…¶æœ€æ ¸å¿ƒçš„å°±æ˜¯æ’ä»¶æœºåˆ¶ï¼Œå…¶ä½¿å¾—ç”¨æˆ·å¯¹é¡¹ç›®æœ‰äº†æ›´é«˜çš„å¯é…ç½®æ€§ï¼Œå†å®Œæˆé¡¹ç›®åˆå§‹æ„å»ºåæˆ‘ä»¬ä¾ç„¶å¯ä»¥é€šè¿‡ vue add æŒ‡ä»¤æ·»åŠ æ’ä»¶ï¼Œé‚£ä¹ˆå…¶å®ç°åŸç†æœ‰æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p>
<p>vue add å‘½ä»¤çš„å…¥å£åœ¨ packages/@vue/cli/bin/vue.js ä¸­:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">program</span><br><span class="line">  .command(<span class="string">&#x27;add &lt;plugin&gt; [pluginOptions]&#x27;</span>)</span><br><span class="line">  .description(<span class="string">&#x27;install a plugin and invoke its generator in an already created project&#x27;</span>)</span><br><span class="line">  .option(<span class="string">&#x27;--registry &lt;url&gt;&#x27;</span>, <span class="string">&#x27;Use specified npm registry when installing dependencies (only for npm)&#x27;</span>)</span><br><span class="line">  .allowUnknownOption()</span><br><span class="line">  .action(<span class="function">(<span class="params">plugin</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">require</span>(<span class="string">&#x27;../lib/add&#x27;</span>)(plugin, minimist(process.argv.slice(<span class="number">3</span>)))</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>
<p>ä»ä»£ç ä¸­å¯ä»¥çœ‹å‡ºï¼Œvue add å‘½ä»¤æ¥å—ä¸¤ä¸ªå‚æ•°:</p>
<ul>
<li>pluginï¼š æ’ä»¶åç§°ï¼Œå¿…å¡«ã€‚</li>
<li>registryï¼š å®‰è£…æ’ä»¶æŒ‡å®šçš„å®‰è£…æºï¼Œåªé’ˆå¯¹äº npm åŒ…ç®¡ç†å™¨ï¼Œé€‰å¡«ã€‚</li>
</ul>
<p>å½“æ‰§è¡Œäº† vue add å‘½ä»¤åä¼šåŠ è½½ @vue/cli/lib/add.jsï¼Œä¸‹é¢å°±é€æ­¥å¼€å§‹åˆ†æã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function">(<span class="params">...args</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> add(...args).catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">    error(err)</span><br><span class="line">    <span class="keyword">if</span> (!process.env.VUE_CLI_TEST) &#123;</span><br><span class="line">      process.exit(<span class="number">1</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬æ¥ç€æ¥æŸ¥çœ‹ add æ–¹æ³•ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">add</span> (<span class="params">pluginToAdd, options = &#123;&#125;, context = process.cwd()</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!(<span class="keyword">await</span> confirmIfGitDirty(context))) &#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// for `vue add` command in 3.x projects</span></span><br><span class="line">  <span class="keyword">const</span> servicePkg = loadModule(<span class="string">&#x27;@vue/cli-service/package.json&#x27;</span>, context)</span><br><span class="line">  <span class="keyword">if</span> (servicePkg &amp;&amp; semver.satisfies(servicePkg.version, <span class="string">&#x27;3.x&#x27;</span>)) &#123;</span><br><span class="line">    <span class="comment">// special internal &quot;plugins&quot;</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="regexp">/^(@vue\/)?router$/</span>.test(pluginToAdd)) &#123; <span class="comment">// åŒ¹é… @vue/routerï¼Œrouter</span></span><br><span class="line">      <span class="keyword">return</span> addRouter(context)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="regexp">/^(@vue\/)?vuex$/</span>.test(pluginToAdd)) &#123; <span class="comment">// åŒ¹é… @vue/vuexï¼Œvuex</span></span><br><span class="line">      <span class="keyword">return</span> addVuex(context)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è§£ææ’ä»¶åç§°</span></span><br><span class="line">  <span class="comment">// @bar/foo =&gt; @bar/vue-cli-plugin-foo</span></span><br><span class="line">  <span class="comment">// @vue/foo =&gt; @vue/cli-plugin-foo</span></span><br><span class="line">  <span class="comment">// foo =&gt; vue-cli-plugin-foo</span></span><br><span class="line">  <span class="keyword">const</span> pluginRe = <span class="regexp">/^(@?[^@]+)(?:@(.+))?$/</span></span><br><span class="line">  <span class="keyword">const</span> [</span><br><span class="line">    <span class="comment">// eslint-disable-next-line</span></span><br><span class="line">    _skip,</span><br><span class="line">    pluginName,</span><br><span class="line">    pluginVersion</span><br><span class="line">  ] = pluginToAdd.match(pluginRe)</span><br><span class="line">  <span class="keyword">const</span> packageName = resolvePluginId(pluginName)</span><br><span class="line"></span><br><span class="line">  log()</span><br><span class="line">  log(<span class="string">`ğŸ“¦  Installing <span class="subst">$&#123;chalk.cyan(packageName)&#125;</span>...`</span>)</span><br><span class="line">  log()</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> pm = <span class="keyword">new</span> PackageManager(&#123; context &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (pluginVersion) &#123;</span><br><span class="line">    <span class="keyword">await</span> pm.add(<span class="string">`<span class="subst">$&#123;packageName&#125;</span>@<span class="subst">$&#123;pluginVersion&#125;</span>`</span>)</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (isOfficialPlugin(packageName)) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; latestMinor &#125; = <span class="keyword">await</span> getVersions()</span><br><span class="line">    <span class="keyword">await</span> pm.add(<span class="string">`<span class="subst">$&#123;packageName&#125;</span>@~<span class="subst">$&#123;latestMinor&#125;</span>`</span>)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">await</span> pm.add(packageName, &#123; <span class="attr">tilde</span>: <span class="literal">true</span> &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  log(<span class="string">`<span class="subst">$&#123;chalk.green(<span class="string">&#x27;âœ”&#x27;</span>)&#125;</span>  Successfully installed plugin: <span class="subst">$&#123;chalk.cyan(packageName)&#125;</span>`</span>)</span><br><span class="line">  log()</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> generatorPath = resolveModule(<span class="string">`<span class="subst">$&#123;packageName&#125;</span>/generator`</span>, context)</span><br><span class="line">  <span class="keyword">if</span> (generatorPath) &#123;</span><br><span class="line">    invoke(pluginName, options, context)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    log(<span class="string">`Plugin <span class="subst">$&#123;packageName&#125;</span> does not have a generator to invoke`</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>add å‡½æ•°çš„ä¸»è¦åŠŸèƒ½å°±æ˜¯å®‰è£…æ’ä»¶åŒ…ï¼Œå¯¹äº vue-cli å†…éƒ¨ä¸€äº›ç‰¹æ®Šçš„&quot;æ’ä»¶&quot;ï¼Œæ¯”å¦‚ routerï¼Œvuexï¼Œå°±ä¸ä¼šé€šè¿‡åŒ…ç®¡ç†å™¨å®‰è£…ï¼Œè€Œæ˜¯ç›´æ¥åŠ è½½ @vue/cli-service/generator/router å’Œ @vue/cli-service/generator/vuexï¼Œè¿™ä¸¤ä¸ªæ–‡ä»¶ä¹Ÿæ˜¯ä¸¤ä¸ª generatorï¼Œå¯ä»¥å‘ package.json æ³¨å…¥é¢å¤–çš„ä¾èµ–æˆ–å­—æ®µï¼Œå¹¶å‘é¡¹ç›®ä¸­æ·»åŠ æ–‡ä»¶ï¼Œå¯¹äºæ™®é€šçš„ç¬¬ä¸‰æ–¹æ’ä»¶ï¼Œåˆ™éœ€è¦é€šè¿‡åŒ…ç®¡ç†å™¨å®‰è£…ï¼Œç¤ºä¾‹è°ƒç”¨çš„ <code>pm.add</code> æ–¹æ³•å®ç°å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// @vue/cli/lib/util/ProjectPackageManager.js</span></span><br><span class="line"><span class="keyword">async</span> add (packageName, &#123;</span><br><span class="line">  tilde = <span class="literal">false</span>,</span><br><span class="line">  dev = <span class="literal">true</span></span><br><span class="line">&#125; = &#123;&#125;) &#123;</span><br><span class="line">  <span class="keyword">const</span> args = dev ? [<span class="string">&#x27;-D&#x27;</span>] : []</span><br><span class="line">  <span class="keyword">if</span> (tilde) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.bin === <span class="string">&#x27;yarn&#x27;</span>) &#123;</span><br><span class="line">      args.push(<span class="string">&#x27;--tilde&#x27;</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      process.env.npm_config_save_prefix = <span class="string">&#x27;~&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">this</span>.needsPeerDepsFix) &#123;</span><br><span class="line">    args.push(<span class="string">&#x27;--legacy-peer-deps&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">await</span> <span class="built_in">this</span>.runCommand(<span class="string">&#x27;add&#x27;</span>, [packageName, ...args])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¦‚æœç”¨æˆ·æŒ‡å®šæ’ä»¶åŒ…åç§°æ—¶æœªæŒ‡å®šç‰ˆæœ¬å·é‚£ä¹ˆåœ¨è°ƒç”¨ <code>pm.add</code> æ–¹æ³•æ—¶ä¼šä¼ å…¥å‚æ•° <code>tilde: true</code>ï¼Œåœ¨ <code>pm.add</code> çš„å†…éƒ¨ä¼šæ ¹æ®åŒ…ç®¡ç†å™¨çš„å…·ä½“ç±»å‹è¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœæ˜¯ yarn ä¼šæ·»åŠ  --tilde å‚æ•°ï¼Œå¦‚æœæ˜¯ npm æˆ– pnpm åˆ™ä¼šå°† npm_config_save_prefix çš„é…ç½®è®¾ä¸º â€˜~â€™ï¼Œè¿™ä¸ªé…ç½®çš„é»˜è®¤å€¼ä¸º â€˜^â€™, ä¾‹å¦‚ä¸€ä¸ªåŒ…çš„ç‰ˆæœ¬æ˜¯ 1.2.3ï¼Œé»˜è®¤æƒ…å†µä¸‹é‚£ä¹ˆåœ¨ package.json ä¸­å°±ä¼šè¢«è®¾ç½®ä¸º â€˜^1.2.3â€™ï¼Œè¿™æ ·ï¼Œå¯¹äº minor éƒ¨åˆ†çš„æ›´æ–°ä¾ç„¶æ˜¯å¯ä»¥çš„ã€‚ä½†æ˜¯å¦‚æœè®¾ç½®äº† npm config set save-prefix=â€~â€ï¼Œé‚£ä¹ˆå°±ä¼šè¢«è®¾ç½®ä¸º â€~1.2.3â€ï¼Œæ­¤æ—¶åªå…è®¸æœ€åä¸€ä½æ•°å­—çš„ç‰ˆæœ¬æ›´æ–°ã€‚æœ€åå†é€šè¿‡ runCommand å‡½æ•°æ‰§è¡Œå…·ä½“åŒ…ç®¡ç†å™¨ï¼ˆå¦‚ yarnï¼‰çš„ add æŒ‡ä»¤ã€‚</p>
<p>åœ¨ vue-cli å®˜æ–¹æ–‡æ¡£ä¸­å¯¹æ’ä»¶ çš„å‘½åæœ‰ç€æ˜ç¡®çš„è¦æ±‚ï¼Œå³å‘½åæ–¹å¼ä¸ºï¼š<code>vue-cli-plugin-&lt;name&gt;</code>ï¼Œæ’ä»¶éµå¾ªå‘½åçº¦å®šä¹‹åå°±å¯ä»¥ï¼š</p>
<ul>
<li>è¢« @vue/cli-service å‘ç°ï¼›</li>
<li>è¢«å…¶å®ƒå¼€å‘è€…æœç´¢åˆ°ï¼›</li>
<li>é€šè¿‡ <code>vue add &lt;name&gt;</code> æˆ– <code>vue invoke &lt;name&gt;</code> å®‰è£…ä¸‹æ¥ã€‚</li>
</ul>
<p>åœ¨è·å–ç¬¬ä¸‰æ–¹æ’ä»¶åç§°åï¼Œå°±ä¼šè°ƒç”¨ invoke æ–¹æ³•å®‰è£…æ’ä»¶åŒ…ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">invoke</span> (<span class="params">pluginName, options = &#123;&#125;, context = process.cwd()</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!(<span class="keyword">await</span> confirmIfGitDirty(context))) &#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">delete</span> options._</span><br><span class="line">  <span class="keyword">const</span> pkg = getPkg(context) <span class="comment">// è§£æ package.json</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// attempt to locate the plugin in package.json</span></span><br><span class="line">  <span class="keyword">const</span> findPlugin = <span class="function"><span class="params">deps</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!deps) <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">let</span> name</span><br><span class="line">    <span class="comment">// official</span></span><br><span class="line">    <span class="keyword">if</span> (deps[(name = <span class="string">`@vue/cli-plugin-<span class="subst">$&#123;pluginName&#125;</span>`</span>)]) &#123;</span><br><span class="line">      <span class="keyword">return</span> name</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// full id, scoped short, or default short</span></span><br><span class="line">    <span class="keyword">if</span> (deps[(name = resolvePluginId(pluginName))]) &#123;</span><br><span class="line">      <span class="keyword">return</span> name</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> id = findPlugin(pkg.devDependencies) || findPlugin(pkg.dependencies)</span><br><span class="line">  <span class="keyword">if</span> (!id) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(</span><br><span class="line">      <span class="string">`Cannot resolve plugin <span class="subst">$&#123;chalk.yellow(pluginName)&#125;</span> from package.json. `</span> +</span><br><span class="line">        <span class="string">`Did you forget to install it?`</span></span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> pluginGenerator = loadModule(<span class="string">`<span class="subst">$&#123;id&#125;</span>/generator`</span>, context)</span><br><span class="line">  <span class="keyword">if</span> (!pluginGenerator) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">`Plugin <span class="subst">$&#123;id&#125;</span> does not have a generator.`</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// resolve options if no command line options (other than --registry) are passed,</span></span><br><span class="line">  <span class="comment">// and the plugin contains a prompt module.</span></span><br><span class="line">  <span class="comment">// eslint-disable-next-line prefer-const</span></span><br><span class="line">  <span class="keyword">let</span> &#123; registry, $inlineOptions, ...pluginOptions &#125; = options</span><br><span class="line">  <span class="keyword">if</span> ($inlineOptions) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      pluginOptions = <span class="built_in">JSON</span>.parse($inlineOptions)</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">`Couldn&#x27;t parse inline options JSON: <span class="subst">$&#123;e.message&#125;</span>`</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!<span class="built_in">Object</span>.keys(pluginOptions).length) &#123;</span><br><span class="line">    <span class="keyword">let</span> pluginPrompts = loadModule(<span class="string">`<span class="subst">$&#123;id&#125;</span>/prompts`</span>, context)</span><br><span class="line">    <span class="keyword">if</span> (pluginPrompts) &#123;</span><br><span class="line">      <span class="keyword">const</span> prompt = inquirer.createPromptModule()</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> pluginPrompts === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">        pluginPrompts = pluginPrompts(pkg, prompt)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> pluginPrompts.getPrompts === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">        pluginPrompts = pluginPrompts.getPrompts(pkg, prompt)</span><br><span class="line">      &#125;</span><br><span class="line">      pluginOptions = <span class="keyword">await</span> prompt(pluginPrompts)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> plugin = &#123;</span><br><span class="line">    id,</span><br><span class="line">    apply: pluginGenerator,</span><br><span class="line">    options: &#123;</span><br><span class="line">      registry,</span><br><span class="line">      ...pluginOptions</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">await</span> runGenerator(context, plugin, pkg)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¯¥æ–¹æ³•å…ˆè°ƒç”¨ findPlugin åˆ¤æ–­æ’ä»¶æ˜¯å¦å®‰è£…ï¼Œå¦‚æœå®‰è£…ä¹Ÿè¿”å›æ’ä»¶åï¼Œæ¥ç€è·å–ç›®æ ‡æ’ä»¶ä¸‹çš„ generator æ–¹æ³•ã€‚ç„¶åå°±æ˜¯åˆ¤æ–­å‘½ä»¤è¡Œæ˜¯å¦ä¼ å…¥è¡Œå†…å‚æ•°ï¼Œå¦‚æœæ²¡æœ‰å¹¶ä¸”ä¼ å…¥æ’ä»¶å‚æ•°ä¸ºç©ºåˆ™è°ƒç”¨ inquirer.prompt è·å–æ’ä»¶çš„ optionï¼Œå¹¶ä¼ ç»™å…¶ generatorï¼Œåœ¨å®Œæˆè¿™äº›ä»¥åï¼Œå°±æ˜¯ runGeneratorã€‚è¿™å„¿çš„ runGenerator çš„å…·ä½“å®ç°ä¸ vue create å‘½ä»¤ä¸­é¡¹ç›®ç”Ÿæˆçš„é˜¶æ®µåŸºæœ¬ä¸€è‡´ï¼Œå®è´¨ä¸Šå°±æ˜¯æ„é€ ä¸€ä¸ª Generator å®ä¾‹ï¼Œå¹¶è°ƒç”¨å…¶ generate æ–¹æ³•ã€‚åœ¨å®ä¾‹çš„ generator æ–¹æ³•è°ƒç”¨å®Œæˆä¹‹åæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git ls-files --exclude-standard --modified --others</span><br></pre></td></tr></table></figure>
<p>å› ä¸ºæ’ä»¶çš„ generator å¯ä»¥é€šè¿‡ GeneratorAPI æš´éœ²çš„ render å’Œ extendPackage æ–¹æ³•ä¿®æ”¹é¡¹ç›®çš„æ–‡ä»¶ï¼Œå› æ­¤é€šè¿‡æ‰§è¡Œè¯¥å‘½ä»¤å°†å˜åŒ–çš„æ–‡ä»¶æ˜¾ç¤ºåœ¨ç»ˆç«¯ä¸Šï¼Œè¿™å¯¹å¼€å‘è€…ååˆ†åœ°å‹å¥½ã€‚</p>
<p>vue add ç›¸å½“äºåªæ˜¯ vue create ä¸­çš„ä¸€éƒ¨åˆ†ï¼Œvue create åŒ…å«äº†æ’ä»¶çš„å®‰è£…ä»¥åŠè°ƒç”¨ï¼Œvue add å‘½ä»¤åªæ˜¯å°†æ­¤åŠŸèƒ½åˆ†ç¦»äº†å‡ºæ¥ï¼Œè€Œ vue invoke å‘½ä»¤å…¶å®æ˜¯ vue add å‘½åå»æ‰äº†æ’ä»¶åŒ…å®‰è£…çš„é‚£ä¸€éƒ¨åˆ†ï¼Œå…¶ä»– vue å‘½ä»¤ç”±äºç¯‡å¹…é™åˆ¶ï¼ˆwo tai lan leï¼‰æ­¤å¤„ä¸å†ä»‹ç»ã€‚</p>
<h3 id="ä¸‰-vuecli-service"><a class="markdownIt-Anchor" href="#ä¸‰-vuecli-service"></a> ä¸‰ã€@vue/cli-service</h3>
<p>åœ¨ Vue CLI ä¸­å°† webpack åŠç›¸å…³æ’ä»¶æä¾›çš„åŠŸèƒ½éƒ½æ”¶æ•›åˆ° @vue/cli-service å†…éƒ¨æ¥å®ç°ï¼Œæä¾›äº† vue-cli-service å‘½ä»¤å¸®åŠ©ä½¿ç”¨è€…æœ€åŸºæœ¬çš„æ—¥å¸¸å¼€å‘ï¼Œä¸‹é¢å°±å¼€å§‹åˆ†æ @vue/cli-service çš„å…·ä½“å®ç°ã€‚</p>
<h4 id="1-å…¥å£"><a class="markdownIt-Anchor" href="#1-å…¥å£"></a> 1ã€å…¥å£</h4>
<p>vue-cli-service må‘½ä»¤çš„å…¥å£åœ¨ @vue/cli-service/bin/vue-service-service.js ä¸­ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// @vue/cli-service/bin/vue-service-service.js</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#!/usr/bin/env node</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; semver, error &#125; = <span class="built_in">require</span>(<span class="string">&#x27;@vue/cli-shared-utils&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> requiredVersion = <span class="built_in">require</span>(<span class="string">&#x27;../package.json&#x27;</span>).engines.node</span><br><span class="line"></span><br><span class="line"><span class="comment">// Node ç‰ˆæœ¬æ ¡éªŒ</span></span><br><span class="line"><span class="keyword">if</span> (!semver.satisfies(process.version, requiredVersion, &#123; <span class="attr">includePrerelease</span>: <span class="literal">true</span> &#125;)) &#123;</span><br><span class="line">  error(</span><br><span class="line">    <span class="string">`You are using Node <span class="subst">$&#123;process.version&#125;</span>, but vue-cli-service `</span> +</span><br><span class="line">    <span class="string">`requires Node <span class="subst">$&#123;requiredVersion&#125;</span>.\nPlease upgrade your Node version.`</span></span><br><span class="line">  )</span><br><span class="line">  process.exit(<span class="number">1</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Service = <span class="built_in">require</span>(<span class="string">&#x27;../lib/Service&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> service = <span class="keyword">new</span> Service(process.env.VUE_CLI_CONTEXT || process.cwd())</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–å‘½ä»¤å‚æ•° vue-cli-service serve --https</span></span><br><span class="line"><span class="keyword">const</span> rawArgv = process.argv.slice(<span class="number">2</span>)</span><br><span class="line"><span class="comment">// åœ¨ boolean é€‰é¡¹å½“ä¸­çš„å‚æ•°ä¼šè¢«è§£ææˆ trueï¼Œä¾‹å¦‚ args.https: true, args.modern: false</span></span><br><span class="line"><span class="keyword">const</span> args = <span class="built_in">require</span>(<span class="string">&#x27;minimist&#x27;</span>)(rawArgv, &#123;</span><br><span class="line">  boolean: [</span><br><span class="line">    <span class="comment">// build</span></span><br><span class="line">    <span class="comment">// <span class="doctag">FIXME:</span> --no-module, --no-unsafe-inline, no-clean, etc.</span></span><br><span class="line">    <span class="string">&#x27;modern&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;report&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;report-json&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;inline-vue&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;watch&#x27;</span>,</span><br><span class="line">    <span class="comment">// serve</span></span><br><span class="line">    <span class="string">&#x27;open&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;copy&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;https&#x27;</span>,</span><br><span class="line">    <span class="comment">// inspect</span></span><br><span class="line">    <span class="string">&#x27;verbose&#x27;</span></span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">const</span> command = args._[<span class="number">0</span>] <span class="comment">// serve</span></span><br><span class="line"></span><br><span class="line">service.run(command, args, rawArgv).catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">  error(err)</span><br><span class="line">  process.exit(<span class="number">1</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>ä»£ç çœ‹ç€éå¸¸ç®€æ´ï¼Œä¸ä¸€èˆ¬ node å‘½ä»¤æ–‡ä»¶æœ‰ç‚¹ä¸åŒï¼Œç¬¬ä¸€å°±æ˜¯å¹¶æ²¡æœ‰ä¾èµ– commander.jsï¼Œç¬¬äºŒå°±æ˜¯å¹¶æ²¡æœ‰ç›´æ¥æä¾›ç›¸å…³ CLI å‘½ä»¤çš„æœåŠ¡ã€‚ åœ¨ @vue/vue-cli-service ä¸­ï¼Œå¯¹äºç¬¬ä¸€ç‚¹æ˜¯é€šè¿‡ Service è¿™ä¸ªç±»æ¥å¤„ç† node å‘½ä»¤ï¼Œè€Œå¯¹äºç¬¬äºŒç‚¹ï¼Œæ‰€æœ‰çš„ CLI æœåŠ¡éƒ½æ˜¯åŠ¨æ€æ³¨å†Œçš„ã€‚ä»ä¸Šé¢è¿™æ®µä»£ç å¯ä»¥çœ‹å‡ºï¼Œæ‰§è¡Œ CLI å‘½ä»¤åï¼Œä¸»è¦æœ‰ä¸¤ä¸ªæ“ä½œï¼šå®ä¾‹åŒ– Service å’Œè°ƒç”¨å®ä¾‹çš„ run æ–¹æ³•ã€‚</p>
<h4 id="2-service-ç±»å®ä¾‹åŒ–"><a class="markdownIt-Anchor" href="#2-service-ç±»å®ä¾‹åŒ–"></a> 2ã€Service ç±»å®ä¾‹åŒ–</h4>
<p>æˆ‘ä»¬æ¥ç€æŸ¥çœ‹ Service ç±»çš„æ„é€ å‡½æ•°ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// @vue/cli-service/lib/Service.js</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="class"><span class="keyword">class</span> <span class="title">Service</span> </span>&#123;</span><br><span class="line">  <span class="title">constructor</span> (<span class="params">context, &#123; plugins, pkg, inlineOptions, useBuiltIn &#125; = &#123;&#125;</span>) &#123;</span><br><span class="line">    checkWebpack(context)</span><br><span class="line"></span><br><span class="line">    process.VUE_CLI_SERVICE = <span class="built_in">this</span></span><br><span class="line">    <span class="built_in">this</span>.initialized = <span class="literal">false</span></span><br><span class="line">    <span class="built_in">this</span>.context = context</span><br><span class="line">    <span class="built_in">this</span>.inlineOptions = inlineOptions</span><br><span class="line">    <span class="built_in">this</span>.webpackChainFns = []</span><br><span class="line">    <span class="built_in">this</span>.webpackRawConfigFns = []</span><br><span class="line">    <span class="built_in">this</span>.devServerConfigFns = []</span><br><span class="line">    <span class="built_in">this</span>.commands = &#123;&#125;</span><br><span class="line">    <span class="comment">// Folder containing the target package.json for plugins</span></span><br><span class="line">    <span class="built_in">this</span>.pkgContext = context</span><br><span class="line">    <span class="comment">// package.json containing the plugins</span></span><br><span class="line">    <span class="built_in">this</span>.pkg = <span class="built_in">this</span>.resolvePkg(pkg)</span><br><span class="line">    <span class="comment">// If there are inline plugins, they will be used instead of those</span></span><br><span class="line">    <span class="comment">// found in package.json.</span></span><br><span class="line">    <span class="comment">// When useBuiltIn === false, built-in plugins are disabled. This is mostly</span></span><br><span class="line">    <span class="comment">// for testing.</span></span><br><span class="line">    <span class="comment">// å¦‚æœæœ‰ inline plugins çš„è¯ï¼Œå°±ä¸ä¼šå»åŠ è½½ package.json é‡Œ devDependencies å’Œ dependencies çš„æ’ä»¶ï¼ŒuseBuiltIn ä¸º false æ—¶ builtInPlugins ä¼šè¢«ç¦ç”¨</span></span><br><span class="line">    <span class="built_in">this</span>.plugins = <span class="built_in">this</span>.resolvePlugins(plugins, useBuiltIn)</span><br><span class="line">    <span class="comment">// pluginsToSkip will be populated during run()</span></span><br><span class="line">    <span class="built_in">this</span>.pluginsToSkip = <span class="keyword">new</span> <span class="built_in">Set</span>()</span><br><span class="line">    <span class="comment">// resolve the default mode to use for each command</span></span><br><span class="line">    <span class="comment">// this is provided by plugins as module.exports.defaultModes</span></span><br><span class="line">    <span class="comment">// so we can get the information without actually applying the plugin.</span></span><br><span class="line">    <span class="comment">// æ³¨å†Œçš„æ’ä»¶å¯ä»¥é€šè¿‡ module.exports.defaultModes æŒ‡å®šç‰¹å®šçš„æ¨¡å¼</span></span><br><span class="line">    <span class="comment">/*&#123;</span></span><br><span class="line"><span class="comment">      serve: &#x27;development&#x27;,</span></span><br><span class="line"><span class="comment">      build: &#x27;production&#x27;,</span></span><br><span class="line"><span class="comment">      inspect: &#x27;development&#x27;,</span></span><br><span class="line"><span class="comment">      &#x27;test:unit&#x27;: &#x27;test&#x27;</span></span><br><span class="line"><span class="comment">    &#125;*/</span></span><br><span class="line">    <span class="built_in">this</span>.modes = <span class="built_in">this</span>.plugins.reduce(<span class="function">(<span class="params">modes, &#123; apply: &#123; defaultModes &#125; &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">Object</span>.assign(modes, defaultModes)</span><br><span class="line">    &#125;, &#123;&#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å®ä¾‹åŒ–çš„è¿‡ç¨‹ä¸»è¦è¿›è¡Œäº†æ’ä»¶çš„è§£æå’Œä¸ºæ¯ä¸€ç§ CLI å‘½ä»¤æŒ‡å®šæ¨¡å¼ï¼Œå…ˆçœ‹ä¸€ä¸‹æ’ä»¶çš„è§£æï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// @vue/cli-service/lib/Service.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="class"><span class="keyword">class</span> <span class="title">Service</span> </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">  resolvePlugins (inlinePlugins, useBuiltIn) &#123;</span><br><span class="line">    <span class="keyword">const</span> idToPlugin = <span class="function">(<span class="params">id, absolutePath</span>) =&gt;</span> (&#123;</span><br><span class="line">      id: id.replace(<span class="regexp">/^.\//</span>, <span class="string">&#x27;built-in:&#x27;</span>),</span><br><span class="line">      apply: <span class="built_in">require</span>(absolutePath || id)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> plugins</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// å†…ç½®æ’ä»¶</span></span><br><span class="line">    <span class="keyword">const</span> builtInPlugins = [</span><br><span class="line">      <span class="string">&#x27;./commands/serve&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;./commands/build&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;./commands/inspect&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;./commands/help&#x27;</span>,</span><br><span class="line">      <span class="comment">// config plugins are order sensitive</span></span><br><span class="line">      <span class="string">&#x27;./config/base&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;./config/assets&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;./config/css&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;./config/prod&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;./config/app&#x27;</span></span><br><span class="line">    ].map(<span class="function">(<span class="params">id</span>) =&gt;</span> idToPlugin(id)) <span class="comment">// [&#123; id: &#x27;built-in:commands/serve&#x27;, apply:&#123; [Function] defaultModes: [Object] &#125; &#125;,...]</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®ä¾‹åŒ– Service æ—¶ä¼ å…¥æ’ä»¶</span></span><br><span class="line">    <span class="keyword">if</span> (inlinePlugins) &#123;</span><br><span class="line">      plugins = useBuiltIn !== <span class="literal">false</span></span><br><span class="line">        ? builtInPlugins.concat(inlinePlugins)</span><br><span class="line">        : inlinePlugins</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> projectPlugins = <span class="built_in">Object</span>.keys(<span class="built_in">this</span>.pkg.devDependencies || &#123;&#125;)</span><br><span class="line">        .concat(<span class="built_in">Object</span>.keys(<span class="built_in">this</span>.pkg.dependencies || &#123;&#125;))</span><br><span class="line">        .filter(isPlugin) <span class="comment">// isPlugin = id =&gt; /^(@vue\/|vue-|@[\w-]+\/vue-)cli-plugin-/.test(id)</span></span><br><span class="line">        .map(<span class="function"><span class="params">id</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">if</span> (</span><br><span class="line">            <span class="built_in">this</span>.pkg.optionalDependencies &amp;&amp;</span><br><span class="line">            id <span class="keyword">in</span> <span class="built_in">this</span>.pkg.optionalDependencies</span><br><span class="line">          ) &#123;</span><br><span class="line">            <span class="keyword">let</span> apply = loadModule(id, <span class="built_in">this</span>.pkgContext)</span><br><span class="line">            <span class="keyword">if</span> (!apply) &#123;</span><br><span class="line">              warn(<span class="string">`Optional dependency <span class="subst">$&#123;id&#125;</span> is not installed.`</span>)</span><br><span class="line">              apply = <span class="function">() =&gt;</span> &#123;&#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> &#123; id, apply &#125;</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> idToPlugin(id, resolveModule(id, <span class="built_in">this</span>.pkgContext))</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Add the plugin automatically to simplify the webpack-4 tests</span></span><br><span class="line">      <span class="comment">// so that a simple Jest alias would suffice, avoid changing every</span></span><br><span class="line">      <span class="comment">// preset used in the tests</span></span><br><span class="line">      <span class="keyword">if</span> (</span><br><span class="line">        process.env.VUE_CLI_TEST &amp;&amp;</span><br><span class="line">        process.env.VUE_CLI_USE_WEBPACK4 &amp;&amp;</span><br><span class="line">        !projectPlugins.some(<span class="function">(<span class="params">p</span>) =&gt;</span> p.id === <span class="string">&#x27;@vue/cli-plugin-webpack-4&#x27;</span>)</span><br><span class="line">      ) &#123;</span><br><span class="line">        builtInPlugins.push(idToPlugin(<span class="string">&#x27;@vue/cli-plugin-webpack-4&#x27;</span>))</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      plugins = builtInPlugins.concat(projectPlugins)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Local plugins</span></span><br><span class="line">    <span class="comment">// é¡¹ç›®æœ¬åœ°çš„æ’ä»¶ï¼Œé’ˆå¯¹äºåªéœ€è¦åœ¨é¡¹ç›®é‡Œç›´æ¥è®¿é—®æ’ä»¶ API è€Œä¸éœ€è¦åˆ›å»ºä¸€ä¸ªå®Œæ•´çš„æ’ä»¶</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.pkg.vuePlugins &amp;&amp; <span class="built_in">this</span>.pkg.vuePlugins.service) &#123;</span><br><span class="line">      <span class="keyword">const</span> files = <span class="built_in">this</span>.pkg.vuePlugins.service</span><br><span class="line">      <span class="keyword">if</span> (!<span class="built_in">Array</span>.isArray(files)) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">`Invalid type for option &#x27;vuePlugins.service&#x27;, expected &#x27;array&#x27; but got <span class="subst">$&#123;<span class="keyword">typeof</span> files&#125;</span>.`</span>)</span><br><span class="line">      &#125;</span><br><span class="line">      plugins = plugins.concat(files.map(<span class="function"><span class="params">file</span> =&gt;</span> (&#123;</span><br><span class="line">        id: <span class="string">`local:<span class="subst">$&#123;file&#125;</span>`</span>,</span><br><span class="line">        apply: loadModule(<span class="string">`./<span class="subst">$&#123;file&#125;</span>`</span>, <span class="built_in">this</span>.pkgContext)</span><br><span class="line">      &#125;)))</span><br><span class="line">    &#125;</span><br><span class="line">    debug(<span class="string">&#x27;vue:plugins&#x27;</span>)(plugins)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> orderedPlugins = sortPlugins(plugins)</span><br><span class="line">    debug(<span class="string">&#x27;vue:plugins-ordered&#x27;</span>)(orderedPlugins)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> orderedPlugins</span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥å°†è§£æçš„æ’ä»¶åˆ†ä¸º4ç±»ï¼š</p>
<ul>
<li>å†…ç½®æ’ä»¶</li>
<li>inlinePlugins</li>
<li>package.json æ’ä»¶</li>
<li>package.vuePlugins æ’ä»¶</li>
</ul>
<p><strong>å†…ç½®æ’ä»¶</strong>æŒ‡çš„æ˜¯ @vue/cli-service å†…éƒ¨æä¾›çš„æ’ä»¶ï¼Œåˆå¯ä»¥å¤§è‡´åˆ†ä¸ºä¸¤ç±»ï¼Œserveã€buildã€inspectã€help è¿™ä¸€ç±»æ’ä»¶åœ¨å†…éƒ¨åŠ¨æ€æ³¨å†Œæ–°çš„ CLI å‘½ä»¤ï¼Œ å¼€å‘è€…å³å¯é€šè¿‡ npm script çš„å½¢å¼å»å¯åŠ¨å¯¹åº”çš„ CLI å‘½ä»¤æœåŠ¡ï¼Œbase ,css, dev, prod, app è¿™ä¸€ç±»æ’ä»¶ä¸»è¦æ˜¯å®Œæˆ webpack æœ¬åœ°ç¼–è¯‘æ„å»ºæ—¶çš„å„ç§ç›¸å…³çš„é…ç½®ã€‚ @vue/cli-service å°† webpack çš„å¼€å‘æ„å»ºåŠŸèƒ½æ”¶æ•›åˆ°å†…éƒ¨æ¥å®Œæˆã€‚</p>
<p><strong>inlinePlugins</strong> æŒ‡çš„æ˜¯ç›´æ¥åœ¨å®ä¾‹åŒ– Service æ—¶ä¼ å…¥ï¼Œæ‰§è¡Œ vue serve å’Œ vue build å‘½ä»¤æ—¶ä¼šåˆ›å»ºä¸€ä¸ª Service å®ä¾‹ï¼Œå¹¶ä¼ å…¥ inlinePluginsã€‚</p>
<p><strong>package.json æ’ä»¶</strong>æŒ‡çš„æ˜¯ devDependencies å’Œ dependencies ä¸­çš„ vue æ’ä»¶ï¼Œæ¯”å¦‚ @vue/cli-plugin-eslintã€‚</p>
<p><strong>package.vuePlugins</strong> ä¹Ÿæ˜¯åœ¨ package.json ä¸­çš„æ’ä»¶ï¼Œä¸è¿‡æ˜¯åœ¨ vuePlugins å­—æ®µä¸­ï¼Œè¯¥ç±»æ’ä»¶æ˜¯é’ˆå¯¹äºåªéœ€è¦åœ¨é¡¹ç›®é‡Œç›´æ¥è®¿é—®æ’ä»¶ API è€Œä¸éœ€è¦åˆ›å»ºä¸€ä¸ªå®Œæ•´çš„æ’ä»¶ã€‚</p>
<p>æˆ‘ä»¬æ¥ç€æŸ¥çœ‹ CLI æŒ‡å®šæ¨¡å¼ï¼š</p>
<p>CLI æ¨¡å¼æ˜¯ vue cli ä¸­ä¸€ä¸ªé‡è¦çš„æ¦‚å¿µï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œä¸€ä¸ª Vue CLI é¡¹ç›®æœ‰ä¸‰ä¸ªæ¨¡å¼ï¼š</p>
<ul>
<li>development æ¨¡å¼ç”¨äº vue-cli-service serve</li>
<li>test æ¨¡å¼ç”¨äº vue-cli-service test:unit</li>
<li>production æ¨¡å¼ç”¨äº vue-cli-service build å’Œ vue-cli-service test:e2e</li>
</ul>
<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ä¼ é€’ --mode é€‰é¡¹å‚æ•°ä¸ºå‘½ä»¤è¡Œè¦†å†™é»˜è®¤çš„æ¨¡å¼ã€‚è¯¦æƒ…å¯æŸ¥çœ‹<a target="_blank" rel="noopener" href="https://cli.vuejs.org/zh/guide/mode-and-env.html#%E6%A8%A1%E5%BC%8F">å®˜æ–¹æ–‡æ¡£</a>ã€‚</p>
<p>åœ¨ Service çš„æ„é€ å‡½æ•°ä¸­è§£æå®Œæ’ä»¶ä¹‹åå°±ä¸ºæ¯ç§æ’ä»¶å‘½ä»¤æŒ‡å®šæ¨¡å¼ï¼Œæ’ä»¶å‘½ä»¤çš„æ¨¡å¼å¯ä»¥ é€šè¿‡ module.exports.defaultModes ä»¥ { [commandName]: mode } çš„å½¢å¼æ¥æš´éœ²ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="params">api</span> =&gt;</span> &#123;</span><br><span class="line">  api.registerCommand(<span class="string">&#x27;build&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports.defaultModes = &#123;</span><br><span class="line">  build: <span class="string">&#x27;production&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è§£æå‘½ä»¤æ¨¡å¼åˆ©ç”¨ js å†…å»ºå‡½æ•° reduce å®ç°:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">this</span>.modes = <span class="built_in">this</span>.plugins.reduce(<span class="function">(<span class="params">modes, &#123; apply: &#123; defaultModes &#125;&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Object</span>.assign(modes, defaultModes)</span><br><span class="line">&#125;, &#123;&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="3-å®ä¾‹çš„-run-æ–¹æ³•"><a class="markdownIt-Anchor" href="#3-å®ä¾‹çš„-run-æ–¹æ³•"></a> 3ã€å®ä¾‹çš„ run æ–¹æ³•</h4>
<p>åœ¨ vue-cli-service çš„å…¥å£å¤„å®Œæˆ Service ç±»çš„å®ä¾‹åŒ–ååˆè°ƒç”¨äº†å®ä¾‹çš„ run æ–¹æ³•ï¼Œæˆ‘ä»¬æ¥ç€æŸ¥çœ‹å…¶å…·ä½“å®ç°ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// @vue/cli-service/lib/Service.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="class"><span class="keyword">class</span> <span class="title">Service</span> </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="keyword">async</span> run (name, args = &#123;&#125;, rawArgv = []) &#123;</span><br><span class="line">    <span class="comment">// resolve mode</span></span><br><span class="line">    <span class="comment">// prioritize inline --mode</span></span><br><span class="line">    <span class="comment">// fallback to resolved default modes from plugins or development if --watch is defined</span></span><br><span class="line">    <span class="keyword">const</span> mode = args.mode || (name === <span class="string">&#x27;build&#x27;</span> &amp;&amp; args.watch ? <span class="string">&#x27;development&#x27;</span> : <span class="built_in">this</span>.modes[name])</span><br><span class="line"></span><br><span class="line">    <span class="comment">// --skip-plugins arg may have plugins that should be skipped during init()</span></span><br><span class="line">    <span class="built_in">this</span>.setPluginsToSkip(args)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// load env variables, load user config, apply plugins</span></span><br><span class="line">    <span class="keyword">await</span> <span class="built_in">this</span>.init(mode)</span><br><span class="line"></span><br><span class="line">    args._ = args._ || []</span><br><span class="line">    <span class="keyword">let</span> command = <span class="built_in">this</span>.commands[name] <span class="comment">// è¿™é‡Œçš„ commands å°±æ˜¯åŠ è½½æ’ä»¶æ—¶é€šè¿‡ api.registerCommand æ³¨å†Œçš„ commandï¼Œåç»­è¯¦ç»†ä»‹ç»</span></span><br><span class="line">    <span class="keyword">if</span> (!command &amp;&amp; name) &#123;</span><br><span class="line">      error(<span class="string">`command &quot;<span class="subst">$&#123;name&#125;</span>&quot; does not exist.`</span>)</span><br><span class="line">      process.exit(<span class="number">1</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!command || args.help || args.h) &#123;</span><br><span class="line">      command = <span class="built_in">this</span>.commands.help</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      args._.shift() <span class="comment">// remove command itself</span></span><br><span class="line">      rawArgv.shift()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> &#123; fn &#125; = command</span><br><span class="line">    <span class="keyword">return</span> fn(args, rawArgv)</span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>run æ–¹æ³•å¼€å§‹ä¼šè·å–è¯¥å‘½ä»¤æ‰€å¯¹åº”çš„æ¨¡å¼å€¼ï¼Œç„¶åè°ƒç”¨å®ä¾‹çš„ init æ–¹æ³•ï¼Œinit ä¸»è¦æœ‰ä¸‰ä¸ªåŠŸèƒ½ï¼š</p>
<ul>
<li>åŠ è½½å¯¹åº”æ¨¡å¼ä¸‹æœ¬åœ°çš„ç¯å¢ƒå˜é‡æ–‡ä»¶</li>
<li>è§£æ vue.config.js æˆ–è€… package.vue</li>
<li>æ‰§è¡Œæ‰€æœ‰è¢«åŠ è½½çš„æ’ä»¶</li>
</ul>
<p>æˆ‘ä»¬æ¥æŸ¥çœ‹ init æ–¹æ³•çš„å…·ä½“å®ç°ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="class"><span class="keyword">class</span> <span class="title">Service</span> </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">  init (mode = process.env.VUE_CLI_MODE) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.initialized) &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">this</span>.initialized = <span class="literal">true</span></span><br><span class="line">    <span class="built_in">this</span>.mode = mode</span><br><span class="line"></span><br><span class="line">    <span class="comment">// load mode .env</span></span><br><span class="line">    <span class="comment">// åŠ è½½æŒ‡å®šçš„æ¨¡å¼ç¯å¢ƒæ–‡ä»¶</span></span><br><span class="line">    <span class="keyword">if</span> (mode) &#123;</span><br><span class="line">      <span class="built_in">this</span>.loadEnv(mode)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// load base .env</span></span><br><span class="line">    <span class="comment">// åŠ è½½æ™®é€šç¯å¢ƒæ–‡ä»¶</span></span><br><span class="line">    <span class="built_in">this</span>.loadEnv()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// load user config</span></span><br><span class="line">    <span class="keyword">const</span> userOptions = <span class="built_in">this</span>.loadUserOptions()</span><br><span class="line">    <span class="keyword">const</span> loadedCallback = <span class="function">(<span class="params">loadedUserOptions</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.projectOptions = defaultsDeep(loadedUserOptions, defaults())</span><br><span class="line"></span><br><span class="line">      debug(<span class="string">&#x27;vue:project-config&#x27;</span>)(<span class="built_in">this</span>.projectOptions)</span><br><span class="line"></span><br><span class="line">      <span class="comment">// apply plugins.</span></span><br><span class="line">      <span class="built_in">this</span>.plugins.forEach(<span class="function">(<span class="params">&#123; id, apply &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.pluginsToSkip.has(id)) <span class="keyword">return</span></span><br><span class="line">        apply(<span class="keyword">new</span> PluginAPI(id, <span class="built_in">this</span>), <span class="built_in">this</span>.projectOptions)</span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">      <span class="comment">// apply webpack configs from project config file</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">this</span>.projectOptions.chainWebpack) &#123;</span><br><span class="line">        <span class="built_in">this</span>.webpackChainFns.push(<span class="built_in">this</span>.projectOptions.chainWebpack)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">this</span>.projectOptions.configureWebpack) &#123;</span><br><span class="line">        <span class="built_in">this</span>.webpackRawConfigFns.push(<span class="built_in">this</span>.projectOptions.configureWebpack)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (isPromise(userOptions)) &#123;</span><br><span class="line">      <span class="keyword">return</span> userOptions.then(loadedCallback)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> loadedCallback(userOptions)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>init æ‰§è¡Œäº†ä¸¤æ¬¡å®ä¾‹çš„ loadEnv å‡½æ•°ï¼Œç¬¬ä¸€æ¬¡æ˜¯åŠ è½½æŒ‡å®šçš„æ¨¡å¼ç¯å¢ƒæ–‡ä»¶ï¼ˆ.env.development, .env.development.localï¼‰ï¼Œç¬¬äºŒæ¬¡æ‰§è¡Œæ˜¯åŠ è½½æ™®é€šç¯å¢ƒæ–‡ä»¶ (.env, .env.local)ï¼Œçœ‹ä¸€ä¸‹å®ä¾‹ loadEnv å‡½æ•°ä»£ç ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åŠ è½½æœ¬åœ°çš„ç¯å¢ƒæ–‡ä»¶ï¼Œç¯å¢ƒæ–‡ä»¶çš„ä½œç”¨å°±æ˜¯è®¾ç½®æŸä¸ªæ¨¡å¼ä¸‹ç‰¹æœ‰çš„ç¯å¢ƒå˜é‡</span></span><br><span class="line"><span class="comment">// åŠ è½½ç¯å¢ƒå˜é‡å…¶å®è¦æ³¨æ„çš„å°±æ˜¯ä¼˜å…ˆçº§çš„é—®é¢˜ï¼Œä¸‹é¢çš„ä»£ç å·²ç»ä½“ç°çš„éå¸¸æ˜æ˜¾äº†ï¼Œå…ˆåŠ è½½ .env.mode.localï¼Œç„¶ååŠ è½½ .env.mode æœ€åå†åŠ è½½ .env</span></span><br><span class="line"><span class="comment">// ç”±äºç¯å¢ƒå˜é‡ä¸ä¼šè¢«è¦†ç›–ï¼Œå› æ­¤ .env.mode.local çš„ä¼˜å…ˆçº§æœ€é«˜ï¼Œ.env.mode.local ä¸ .env.mode çš„åŒºåˆ«å°±æ˜¯å‰è€…ä¼šè¢« git å¿½ç•¥æ‰ã€‚å¦å¤–ä¸€ç‚¹è¦</span></span><br><span class="line"><span class="comment">// æ³¨æ„çš„å°±æ˜¯ç¯å¢ƒæ–‡ä»¶ä¸ä¼šè¦†ç›–Vue CLI å¯åŠ¨æ—¶å·²ç»å­˜åœ¨çš„ç¯å¢ƒå˜é‡ã€‚</span></span><br><span class="line">loadEnv (mode) &#123;</span><br><span class="line">  <span class="keyword">const</span> logger = debug(<span class="string">&#x27;vue:env&#x27;</span>)</span><br><span class="line">  <span class="comment">// path/.env.production || path/.env.development || ...</span></span><br><span class="line">  <span class="keyword">const</span> basePath = path.resolve(<span class="built_in">this</span>.context, <span class="string">`.env<span class="subst">$&#123;mode ? <span class="string">`.<span class="subst">$&#123;mode&#125;</span>`</span> : <span class="string">``</span>&#125;</span>`</span>)</span><br><span class="line">  <span class="keyword">const</span> localPath = <span class="string">`<span class="subst">$&#123;basePath&#125;</span>.local`</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> load = <span class="function"><span class="params">envPath</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> env = dotenv.config(&#123; <span class="attr">path</span>: envPath, <span class="attr">debug</span>: process.env.DEBUG &#125;) <span class="comment">// åŠ è½½æŒ‡å®šè·¯å¾„çš„ç¯å¢ƒå˜é‡</span></span><br><span class="line">      dotenvExpand(env)</span><br><span class="line">      logger(envPath, env)</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">      <span class="comment">// only ignore error if file is not found</span></span><br><span class="line">      <span class="keyword">if</span> (err.toString().indexOf(<span class="string">&#x27;ENOENT&#x27;</span>) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        error(err)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  load(localPath)</span><br><span class="line">  load(basePath)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// by default, NODE_ENV and BABEL_ENV are set to &quot;development&quot; unless mode</span></span><br><span class="line">  <span class="comment">// is production or test. However the value in .env files will take higher</span></span><br><span class="line">  <span class="comment">// priority.</span></span><br><span class="line">  <span class="keyword">if</span> (mode) &#123;</span><br><span class="line">    <span class="comment">// always set NODE_ENV during tests</span></span><br><span class="line">    <span class="comment">// as that is necessary for tests to not be affected by each other</span></span><br><span class="line">    <span class="keyword">const</span> shouldForceDefaultEnv = (</span><br><span class="line">      process.env.VUE_CLI_TEST &amp;&amp;</span><br><span class="line">      !process.env.VUE_CLI_TEST_TESTING_ENV</span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">const</span> defaultNodeEnv = (mode === <span class="string">&#x27;production&#x27;</span> || mode === <span class="string">&#x27;test&#x27;</span>)</span><br><span class="line">      ? mode</span><br><span class="line">      : <span class="string">&#x27;development&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> (shouldForceDefaultEnv || process.env.NODE_ENV == <span class="literal">null</span>) &#123;</span><br><span class="line">      process.env.NODE_ENV = defaultNodeEnv</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (shouldForceDefaultEnv || process.env.BABEL_ENV == <span class="literal">null</span>) &#123;</span><br><span class="line">      process.env.BABEL_ENV = defaultNodeEnv</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡ä»£ç æˆ‘ä»¬å¯ä»¥çœ‹åˆ° loadEnv æ–¹æ³•çš„ä¸»è¦ä½œç”¨å°±æ˜¯å‘ node process ä¸­æ·»åŠ ç¯å¢ƒå˜é‡ã€‚æˆ‘ä»¬æ¥ç€æŸ¥çœ‹ loadUserOptionsï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Note: we intentionally make this function synchronous by default</span></span><br><span class="line"><span class="comment">// because eslint-import-resolver-webpack does not support async webpack configs.</span></span><br><span class="line">loadUserOptions () &#123;</span><br><span class="line">  <span class="comment">// fileConfig: import(fileConfigPath)/require(fileConfigPath), fileConfigPath: path.resolve(context, &#x27;./vue.config.js&#x27;)</span></span><br><span class="line">  <span class="keyword">const</span> &#123; fileConfig, fileConfigPath &#125; = loadFileConfig(<span class="built_in">this</span>.context)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (isPromise(fileConfig)) &#123;</span><br><span class="line">    <span class="keyword">return</span> fileConfig</span><br><span class="line">      .then(<span class="function"><span class="params">mod</span> =&gt;</span> mod.default)</span><br><span class="line">      .then(<span class="function"><span class="params">loadedConfig</span> =&gt;</span> resolveUserConfig(&#123;</span><br><span class="line">        inlineOptions: <span class="built_in">this</span>.inlineOptions,</span><br><span class="line">        pkgConfig: <span class="built_in">this</span>.pkg.vue,</span><br><span class="line">        fileConfig: loadedConfig,</span><br><span class="line">        fileConfigPath</span><br><span class="line">      &#125;))</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> resolveUserConfig(&#123;</span><br><span class="line">    inlineOptions: <span class="built_in">this</span>.inlineOptions,</span><br><span class="line">    pkgConfig: <span class="built_in">this</span>.pkg.vue, <span class="comment">// package.json é‡Œé¢çš„ vue config</span></span><br><span class="line">    fileConfig,</span><br><span class="line">    fileConfigPath</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç¤ºä¾‹ä»£ç ä¸­çš„ loadFileConfig æ–¹æ³•çš„ä¸»è¦ä½œç”¨æ˜¯é…ç½®æ–‡ä»¶è·¯å¾„çš„è·å–åŠå†…å®¹è§£æï¼Œå…¶é¦–å…ˆä¼šåœ¨éå† â€˜./vue.config.jsâ€™ã€â€™./vue.config.cjsâ€™ã€â€™./vue.config.mjsâ€™ æŸ¥çœ‹å½“å‰é¡¹ç›®ç›®å½•ä¸‹æ˜¯å¦å­˜åœ¨å¯¹åº”æ–‡ä»¶ï¼Œå¦‚æœå­˜åœ¨åˆ™åˆ¤æ–­æ–‡ä»¶å†…å®¹æ˜¯å¦éµä» ESModule è§„èŒƒï¼Ÿå¦‚æœéµä»åˆ™é€šè¿‡ import æ–¹æ³•è·å–æ–‡ä»¶å†…å®¹ï¼Œå¦‚æœä¸æ˜¯åˆ™é€šè¿‡ require æ–¹æ³•è·å–ã€‚åœ¨è·å–åˆ°é…ç½®æ–‡ä»¶å†…å®¹åç´§æ¥ç€è°ƒç”¨äº† resolveUserConfig å‡½æ•°ï¼Œæˆ‘ä»¬æ¥ç€æŸ¥çœ‹å…¶å®ç°ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> <span class="title">resolveUserConfig</span> (<span class="params">&#123;</span></span></span><br><span class="line"><span class="function"><span class="params">  inlineOptions,</span></span></span><br><span class="line"><span class="function"><span class="params">  pkgConfig,</span></span></span><br><span class="line"><span class="function"><span class="params">  fileConfig,</span></span></span><br><span class="line"><span class="function"><span class="params">  fileConfigPath</span></span></span><br><span class="line"><span class="function"><span class="params">&#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (fileConfig) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> fileConfig === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">      fileConfig = fileConfig()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!fileConfig || <span class="keyword">typeof</span> fileConfig !== <span class="string">&#x27;object&#x27;</span>) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(</span><br><span class="line">        <span class="string">`Error loading <span class="subst">$&#123;chalk.bold(fileConfigPath)&#125;</span>: `</span> +</span><br><span class="line">        <span class="string">`should export an object or a function that returns object.`</span></span><br><span class="line">      )</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// package.vue</span></span><br><span class="line">  <span class="keyword">if</span> (pkgConfig &amp;&amp; <span class="keyword">typeof</span> pkgConfig !== <span class="string">&#x27;object&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(</span><br><span class="line">      <span class="string">`Error loading Vue CLI config in <span class="subst">$&#123;chalk.bold(<span class="string">`package.json`</span>)&#125;</span>: `</span> +</span><br><span class="line">      <span class="string">`the &quot;vue&quot; field should be an object.`</span></span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> resolved, resolvedFrom</span><br><span class="line">  <span class="comment">// æ—¢æœ‰ vue.config.js è€Œä¸”åœ¨ package.json é‡Œé¢åˆåŒ…å«äº† vue çš„é…ç½®ï¼Œå°†ä¼šå– vue.config.js çš„é…ç½®</span></span><br><span class="line">  <span class="keyword">if</span> (fileConfig) &#123;</span><br><span class="line">    <span class="keyword">const</span> configFileName = path.basename(fileConfigPath)</span><br><span class="line">    <span class="keyword">if</span> (pkgConfig) &#123;</span><br><span class="line">      warn(</span><br><span class="line">        <span class="string">`&quot;vue&quot; field in package.json ignored `</span> +</span><br><span class="line">        <span class="string">`due to presence of <span class="subst">$&#123;chalk.bold(configFileName)&#125;</span>.`</span></span><br><span class="line">      )</span><br><span class="line">      warn(</span><br><span class="line">        <span class="string">`You should migrate it into <span class="subst">$&#123;chalk.bold(configFileName)&#125;</span> `</span> +</span><br><span class="line">        <span class="string">`and remove it from package.json.`</span></span><br><span class="line">      )</span><br><span class="line">    &#125;</span><br><span class="line">    resolved = fileConfig</span><br><span class="line">    resolvedFrom = configFileName</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (pkgConfig) &#123;</span><br><span class="line">    resolved = pkgConfig</span><br><span class="line">    resolvedFrom = <span class="string">&#x27;&quot;vue&quot; field in package.json&#x27;</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    resolved = inlineOptions || &#123;&#125;</span><br><span class="line">    resolvedFrom = <span class="string">&#x27;inline options&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// normalize some options</span></span><br><span class="line">  <span class="keyword">if</span> (resolved.publicPath !== <span class="string">&#x27;auto&#x27;</span>) &#123;</span><br><span class="line">    ensureSlash(resolved, <span class="string">&#x27;publicPath&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> resolved.publicPath === <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">    resolved.publicPath = resolved.publicPath.replace(<span class="regexp">/^\.\//</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  removeSlash(resolved, <span class="string">&#x27;outputDir&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// validate options</span></span><br><span class="line">  validate(resolved, <span class="function"><span class="params">msg</span> =&gt;</span> &#123;</span><br><span class="line">    error(<span class="string">`Invalid options in <span class="subst">$&#123;chalk.bold(resolvedFrom)&#125;</span>: <span class="subst">$&#123;msg&#125;</span>`</span>)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> resolved</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç¤ºä¾‹ä»£ç é¦–å…ˆä¼šåŠ è½½é¡¹ç›®ä¸­ vue.config.jsï¼Œç„¶åä¼šåŠ è½½ package.json ä¸­çš„ vue å­—æ®µä¸­çš„é…ç½®ä¿¡æ¯ã€‚å¦‚æœæ—¢æœ‰ vue.config.js è€Œä¸”åœ¨ package.json é‡Œé¢åˆåŒ…å«äº† vue çš„é…ç½®ï¼Œå°†ä¼šå– vue.config.js çš„é…ç½®ï¼Œå¦‚æœä¸¤è€…éƒ½æ²¡æœ‰é…ç½®ä¿¡æ¯çš„è¯ä¼šå– this.inlineOptions || {}ï¼Œ åœ¨è·å–åˆ°é…ç½®ä»¥åè¿˜ä¼šè¿›è¡Œä¸€äº›å¤„ç†å’ŒéªŒè¯ï¼Œæœ€åè¿”å›é…ç½® resolved ã€‚</p>
<p>åœ¨é€šè¿‡ loadUserOptions æ–¹æ³•å®Œæˆäº†é…ç½®æ–‡ä»¶çš„è§£æåŠè·å–åç´§æ¥ç€ä¾¿å¼€å§‹åŠ è½½æ’ä»¶ï¼Œæ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// apply plugins.</span></span><br><span class="line"><span class="built_in">this</span>.plugins.forEach(<span class="function">(<span class="params">&#123; id, apply &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">this</span>.pluginsToSkip.has(id)) <span class="keyword">return</span></span><br><span class="line">  <span class="comment">// service æ’ä»¶æ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ª PluginAPI å®ä¾‹ï¼Œä¸€ä¸ªåŒ…å« vue.config.js å†…æŒ‡å®šçš„é¡¹ç›®æœ¬åœ°é€‰é¡¹çš„å¯¹è±¡ï¼Œæˆ–è€…åœ¨ package.json å†…çš„ vue å­—æ®µã€‚</span></span><br><span class="line">  apply(<span class="keyword">new</span> PluginAPI(id, <span class="built_in">this</span>), <span class="built_in">this</span>.projectOptions)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>PluginAPI ç±»çš„æ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Note: if a plugin-registered command needs to run in a specific default mode,</span></span><br><span class="line"><span class="comment">// the plugin needs to expose it via `module.exports.defaultModes` in the form</span></span><br><span class="line"><span class="comment">// of &#123; [commandName]: mode &#125;. This is because the command mode needs to be</span></span><br><span class="line"><span class="comment">// known and applied before loading user options / applying plugins.</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PluginAPI</span> </span>&#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;string&#125;</span> <span class="variable">id</span></span> - Id of the plugin.</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;Service&#125;</span> <span class="variable">service</span></span> - A vue-cli-service instance.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="title">constructor</span> (<span class="params">id, service</span>) &#123;</span><br><span class="line">    <span class="built_in">this</span>.id = id</span><br><span class="line">    <span class="built_in">this</span>.service = service</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  get version () &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">require</span>(<span class="string">&#x27;../package.json&#x27;</span>).version</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  assertVersion (range) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> range === <span class="string">&#x27;number&#x27;</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (!<span class="built_in">Number</span>.isInteger(range)) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;Expected string or integer value.&#x27;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">      range = <span class="string">`^<span class="subst">$&#123;range&#125;</span>.0.0-0`</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> range !== <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;Expected string or integer value.&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (semver.satisfies(<span class="built_in">this</span>.version, range, &#123; <span class="attr">includePrerelease</span>: <span class="literal">true</span> &#125;)) <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(</span><br><span class="line">      <span class="string">`Require @vue/cli-service &quot;<span class="subst">$&#123;range&#125;</span>&quot;, but was loaded with &quot;<span class="subst">$&#123;<span class="built_in">this</span>.version&#125;</span>&quot;.`</span></span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Current working directory.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  getCwd () &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.service.context</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Resolve path for a project.</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;string&#125;</span> <span class="variable">_path</span></span> - Relative path from project root</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@return <span class="type">&#123;string&#125;</span> </span>The resolved absolute path.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  resolve (_path) &#123;</span><br><span class="line">    <span class="keyword">return</span> path.resolve(<span class="built_in">this</span>.service.context, _path)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Check if the project has a given plugin.</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;string&#125;</span> <span class="variable">id</span></span> - Plugin id, can omit the (<span class="doctag">@vue</span>/|vue-|<span class="doctag">@scope</span>/vue)-cli-plugin- prefix</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@return <span class="type">&#123;boolean&#125;</span></span></span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  hasPlugin (id) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.service.plugins.some(<span class="function"><span class="params">p</span> =&gt;</span> matchesPluginId(id, p.id))</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Register a command that will become available as `vue-cli-service [name]`.</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;string&#125;</span> <span class="variable">name</span></span></span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;object&#125;</span> </span>[opts]</span></span><br><span class="line"><span class="comment">   *   &#123;</span></span><br><span class="line"><span class="comment">   *     description: string,</span></span><br><span class="line"><span class="comment">   *     usage: string,</span></span><br><span class="line"><span class="comment">   *     options: &#123; [string]: string &#125;</span></span><br><span class="line"><span class="comment">   *   &#125;</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;function&#125;</span> <span class="variable">fn</span></span></span></span><br><span class="line"><span class="comment">   *   (args: &#123; [string]: string &#125;, rawArgs: string[]) =&gt; ?Promise</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  registerCommand (name, opts, fn) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> opts === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">      fn = opts</span><br><span class="line">      opts = <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">this</span>.service.commands[name] = &#123; fn, <span class="attr">opts</span>: opts || &#123;&#125; &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Register a function that will receive a chainable webpack config</span></span><br><span class="line"><span class="comment">   * the function is lazy and won&#x27;t be called until `resolveWebpackConfig` is</span></span><br><span class="line"><span class="comment">   * called</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;function&#125;</span> <span class="variable">fn</span></span></span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  chainWebpack (fn) &#123;</span><br><span class="line">    <span class="built_in">this</span>.service.webpackChainFns.push(fn)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Register</span></span><br><span class="line"><span class="comment">   * - a webpack configuration object that will be merged into the config</span></span><br><span class="line"><span class="comment">   * OR</span></span><br><span class="line"><span class="comment">   * - a function that will receive the raw webpack config.</span></span><br><span class="line"><span class="comment">   *   the function can either mutate the config directly or return an object</span></span><br><span class="line"><span class="comment">   *   that will be merged into the config.</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;object | function&#125;</span> <span class="variable">fn</span></span></span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  configureWebpack (fn) &#123;</span><br><span class="line">    <span class="built_in">this</span>.service.webpackRawConfigFns.push(fn)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Register a dev serve config function. It will receive the express `app`</span></span><br><span class="line"><span class="comment">   * instance of the dev server.</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;function&#125;</span> <span class="variable">fn</span></span></span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  configureDevServer (fn) &#123;</span><br><span class="line">    <span class="built_in">this</span>.service.devServerConfigFns.push(fn)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Resolve the final raw webpack config, that will be passed to webpack.</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;ChainableWebpackConfig&#125;</span> </span>[chainableConfig]</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@return <span class="type">&#123;object&#125;</span> </span>Raw webpack config.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  resolveWebpackConfig (chainableConfig) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.service.resolveWebpackConfig(chainableConfig)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Resolve an intermediate chainable webpack config instance, which can be</span></span><br><span class="line"><span class="comment">   * further tweaked before generating the final raw webpack config.</span></span><br><span class="line"><span class="comment">   * You can call this multiple times to generate different branches of the</span></span><br><span class="line"><span class="comment">   * base webpack config.</span></span><br><span class="line"><span class="comment">   * See https://github.com/mozilla-neutrino/webpack-chain</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@return <span class="type">&#123;ChainableWebpackConfig&#125;</span></span></span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  resolveChainableWebpackConfig () &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.service.resolveChainableWebpackConfig()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Generate a cache identifier from a number of variables</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  genCacheConfig (id, partialIdentifier, configFiles = []) &#123;</span><br><span class="line">    <span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line">    <span class="keyword">const</span> cacheDirectory = <span class="built_in">this</span>.resolve(<span class="string">`node_modules/.cache/<span class="subst">$&#123;id&#125;</span>`</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// replace \r\n to \n generate consistent hash</span></span><br><span class="line">    <span class="keyword">const</span> fmtFunc = <span class="function"><span class="params">conf</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> conf === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> conf.toString().replace(<span class="regexp">/\r\n?/g</span>, <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> conf</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> variables = &#123;</span><br><span class="line">      partialIdentifier,</span><br><span class="line">      <span class="string">&#x27;cli-service&#x27;</span>: <span class="built_in">require</span>(<span class="string">&#x27;../package.json&#x27;</span>).version,</span><br><span class="line">      env: process.env.NODE_ENV,</span><br><span class="line">      test: !!process.env.VUE_CLI_TEST,</span><br><span class="line">      config: [</span><br><span class="line">        fmtFunc(<span class="built_in">this</span>.service.projectOptions.chainWebpack),</span><br><span class="line">        fmtFunc(<span class="built_in">this</span>.service.projectOptions.configureWebpack)</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      variables[<span class="string">&#x27;cache-loader&#x27;</span>] = <span class="built_in">require</span>(<span class="string">&#x27;cache-loader/package.json&#x27;</span>).version</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      <span class="comment">// cache-loader is only intended to be used for webpack 4</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">Array</span>.isArray(configFiles)) &#123;</span><br><span class="line">      configFiles = [configFiles]</span><br><span class="line">    &#125;</span><br><span class="line">    configFiles = configFiles.concat([</span><br><span class="line">      <span class="string">&#x27;package-lock.json&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;yarn.lock&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;pnpm-lock.yaml&#x27;</span></span><br><span class="line">    ])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> readConfig = <span class="function"><span class="params">file</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> absolutePath = <span class="built_in">this</span>.resolve(file)</span><br><span class="line">      <span class="keyword">if</span> (!fs.existsSync(absolutePath)) &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (absolutePath.endsWith(<span class="string">&#x27;.js&#x27;</span>)) &#123;</span><br><span class="line">        <span class="comment">// should evaluate config scripts to reflect environment variable changes</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="built_in">JSON</span>.stringify(<span class="built_in">require</span>(absolutePath))</span><br><span class="line">        &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">          <span class="keyword">return</span> fs.readFileSync(absolutePath, <span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> fs.readFileSync(absolutePath, <span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    variables.configFiles = configFiles.map(<span class="function"><span class="params">file</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> content = readConfig(file)</span><br><span class="line">      <span class="keyword">return</span> content &amp;&amp; content.replace(<span class="regexp">/\r\n?/g</span>, <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> cacheIdentifier = hash(variables)</span><br><span class="line">    <span class="keyword">return</span> &#123; cacheDirectory, cacheIdentifier &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = PluginAPI</span><br></pre></td></tr></table></figure>
<p>ç®€å•ä»‹ç»ä¸€äº› PluginAPI å¸¸ç”¨çš„æ–¹æ³•ï¼š</p>
<ul>
<li>registerCommand: æ³¨å†Œ cli å‘½ä»¤æœåŠ¡</li>
<li>chainWebpack: é€šè¿‡ webpack-chain ä¿®æ”¹ webpack é…ç½®</li>
<li>configureWebpack: é€šè¿‡ webpack-merge å¯¹ webpack é…ç½®è¿›è¡Œåˆå¹¶</li>
<li>resolveWebpackConfig: è°ƒç”¨ä¹‹å‰é€šè¿‡ chainWebpack å’Œ configureWebpack ä¸Šå®Œæˆçš„å¯¹äº webpack é…ç½®çš„æ”¹é€ ï¼Œå¹¶è¿”å›æœ€ç»ˆçš„ webpack é…ç½®</li>
<li>genCacheConfig: è¿”å› cacheDirectory, cacheIdentifier</li>
<li>â€¦</li>
</ul>
<p>ç³»ç»Ÿçš„å†…ç½®æ’ä»¶ builtInPlugins ä¾‹å¦‚ â€˜./commands/serveâ€™ã€â€™./commands/buildâ€™ ç­‰ä¹Ÿæ˜¯é€šè¿‡è°ƒç”¨ PluginAPI æä¾›çš„å…·ä½“æ–¹æ³•å®ç°å…¶åŠŸèƒ½ï¼Œæˆ‘ä»¬ä»¥ serve å‘½ä»¤ä¸ºä¾‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// @vue/cli-service/lib/commands/serve.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function">(<span class="params">api, options</span>) =&gt;</span> &#123;</span><br><span class="line">  api.registerCommand(<span class="string">&#x27;serve&#x27;</span>, &#123;</span><br><span class="line">    description: <span class="string">&#x27;start development server&#x27;</span>,</span><br><span class="line">    usage: <span class="string">&#x27;vue-cli-service serve [options] [entry]&#x27;</span>,</span><br><span class="line">    options: &#123;</span><br><span class="line">      <span class="string">&#x27;--open&#x27;</span>: <span class="string">`open browser on server start`</span>,</span><br><span class="line">      <span class="string">&#x27;--copy&#x27;</span>: <span class="string">`copy url to clipboard on server start`</span>,</span><br><span class="line">      <span class="string">&#x27;--mode&#x27;</span>: <span class="string">`specify env mode (default: development)`</span>,</span><br><span class="line">      <span class="string">&#x27;--host&#x27;</span>: <span class="string">`specify host (default: <span class="subst">$&#123;defaults.host&#125;</span>)`</span>,</span><br><span class="line">      <span class="string">&#x27;--port&#x27;</span>: <span class="string">`specify port (default: <span class="subst">$&#123;defaults.port&#125;</span>)`</span>,</span><br><span class="line">      <span class="string">&#x27;--https&#x27;</span>: <span class="string">`use https (default: <span class="subst">$&#123;defaults.https&#125;</span>)`</span>,</span><br><span class="line">      <span class="string">&#x27;--public&#x27;</span>: <span class="string">`specify the public network URL for the HMR client`</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">serve</span> (<span class="params">args</span>) </span>&#123;</span><br><span class="line">   <span class="comment">// resolveWebpackConfig</span></span><br><span class="line">   <span class="comment">// create server</span></span><br><span class="line">   <span class="comment">// ....</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åˆ©ç”¨ api.registerCommand æ³¨å†Œäº† serve å‘½åï¼Œå¹¶å°† serve å‘½ä»¤çš„å¤„ç†å‡½æ•°æŒ‚è½½åˆ° Service å®ä¾‹çš„ serve å‘½ä»¤ä¸­ï¼Œå½“ç„¶ä½ è¿˜å¯ä»¥é€šè¿‡ module.exports.defaultModes ä»¥ <code>&#123; [commandName]: mode &#125;</code> çš„å½¢å¼æ¥æŒ‡å®šå‘½ä»¤çš„è¿è¡Œæ¨¡å¼ã€‚</p>
<p>åˆ†æåˆ°è¿™é‡Œä½ åº”è¯¥é€æ¸ç†Ÿæ‚‰ vue-cli 3.0 çš„æ’ä»¶æœºåˆ¶äº†ï¼Œvue-cli 3.0 å°†æ‰€æœ‰çš„å·¥ä½œéƒ½äº¤ç»™æ’ä»¶å»æ‰§è¡Œï¼Œå¼€å‘æ¨¡å¼æ‰§è¡Œå†…ç½® serve æ’ä»¶ï¼Œæ‰“åŒ…æ‰§è¡Œå†…ç½® build æ’ä»¶ï¼Œæ£€æŸ¥ä»£ç è§„èŒƒç”± @vue/cli-plugin-eslint æ’ä»¶å®Œæˆã€‚</p>
<p>åœ¨åŠ è½½å®Œæ‰€æœ‰çš„æ’ä»¶ä»¥åï¼Œå®ä¾‹çš„ init æ–¹æ³•åœ¨æœ€åä¼šè¯»å–é¡¹ç›®é…ç½®ä¸­çš„ webpack é…ç½®ä¿¡æ¯ï¼Œå³ chainWebpack å’Œ configureWebpackï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// apply webpack configs from project config file</span></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">this</span>.projectOptions.chainWebpack) &#123;</span><br><span class="line">  <span class="built_in">this</span>.webpackChainFns.push(<span class="built_in">this</span>.projectOptions.chainWebpack)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">this</span>.projectOptions.configureWebpack) &#123;</span><br><span class="line">  <span class="built_in">this</span>.webpackRawConfigFns.push(<span class="built_in">this</span>.projectOptions.configureWebpack)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨å®ä¾‹çš„ run å‡½æ•°ä¸­æ‰§è¡Œäº†å®ä¾‹ init å‡½æ•°å¯¹ Service å®ä¾‹çš„å±æ€§è¿›è¡Œåˆå§‹åŒ–åå°±ä¼šè§£æ CLI å‘½ä»¤ï¼Œå…·ä½“å®ç°å¦‚ä¸‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">args._ = args._ || []</span><br><span class="line"><span class="keyword">let</span> command = <span class="built_in">this</span>.commands[name] <span class="comment">// åŠ è½½æ’ä»¶æ—¶æ³¨å†Œäº† commandï¼Œapi.registerCommand</span></span><br><span class="line"><span class="keyword">if</span> (!command &amp;&amp; name) &#123; <span class="comment">// éæ³•å‘½ä»¤</span></span><br><span class="line">  error(<span class="string">`command &quot;<span class="subst">$&#123;name&#125;</span>&quot; does not exist.`</span>)</span><br><span class="line">  process.exit(<span class="number">1</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (!command || args.help) &#123; <span class="comment">// vue-cli-service || vue-cli-service -h</span></span><br><span class="line">  command = <span class="built_in">this</span>.commands.help</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  args._.shift() <span class="comment">// remove command itself</span></span><br><span class="line">  rawArgv.shift()</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> &#123; fn &#125; = command</span><br><span class="line"><span class="keyword">return</span> fn(args, rawArgv)</span><br></pre></td></tr></table></figure>
<p>ä¼šå…ˆå¯¹ CLI å‘½ä»¤è¿›è¡Œä¸€ä¸ªåˆ¤æ–­ï¼Œä¸»è¦æœ‰ä¸€ä¸‹ä¸‰ç§æƒ…å†µï¼š</p>
<ul>
<li>è¾“å…¥äº†å‘½ä»¤ name ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰é€šè¿‡ api.registerCommand æ³¨å†Œï¼Œå³éæ³•å‘½ä»¤ï¼Œprocess.exit(1)</li>
<li>ç›´æ¥è¾“å…¥äº† vue-cli-service æˆ–è€… vue-cli-service --helpï¼ŒåŠ è½½å†…ç½® help æ’ä»¶</li>
<li>æ­£å¸¸è¾“å…¥ï¼Œeg: vue-cli-service test:unitï¼Œè¿™ç§æƒ…å†µä¼šåŠ è½½å¯¹åº”åœ°å•å…ƒæµ‹è¯•æ’ä»¶ @vue/cli-plugin-unit-jest || @vue/cli-plugin-unit-mochaï¼Œå¹¶æ‰§è¡Œæ’ä»¶å†…ä¸å¯¹åº” test å‘½ä»¤æŒ‡å®šçš„å¤„ç†å‡½æ•°ã€‚</li>
</ul>
<h4 id="4-æ€»ç»“"><a class="markdownIt-Anchor" href="#4-æ€»ç»“"></a> 4ã€æ€»ç»“</h4>
<p>è‡³æ­¤ @vue/cli-service çš„åˆ†æå°±å®Œæˆäº†ï¼Œ@vue/cli-service çš„ä¸»è¦ä½œç”¨å°±æ˜¯æä¾›äº† vue-cli-service å‘½ä»¤ï¼Œä½†æ˜¯ä¸ä¸€èˆ¬ node å‘½ä»¤æ–‡ä»¶æœ‰ç‚¹ä¸åŒï¼Œ@vue/cli-service å¹¶æ²¡æœ‰ç›´æ¥æä¾›ç›¸å…³ serveã€build ç­‰ CLI å‘½ä»¤çš„æœåŠ¡ã€‚å…·ä½“å®ç°ä¸»è¦æ˜¯é€šè¿‡ Service å®ä¾‹çš„ run æ–¹æ³•ï¼Œrun æ–¹æ³•ä¸»è¦æ‰§è¡Œäº†ç¯å¢ƒå˜é‡æ–‡ä»¶åŠ è½½ï¼Œè·å–é¡¹ç›®é…ç½®ä¿¡æ¯ï¼Œåˆå¹¶é¡¹ç›®é…ç½®ï¼ŒåŠ è½½æ’ä»¶ï¼ŒåŠ è½½é¡¹ç›®é…ç½®ä¸­çš„ webpack ä¿¡æ¯ï¼Œæœ€å æ‰§è¡Œ CLI æœåŠ¡ï¼Œå¸¸è§çš„ serve å’Œ build æŒ‡ä»¤ä¹Ÿæ˜¯é€šè¿‡ç³»ç»Ÿæä¾›çš„å†…ç½®æ’ä»¶å®ç°çš„ï¼Œåœ¨ä¸‹é¢æˆ‘ä»¬å°†è¯¦ç»†ä»‹ç» Vue CLI çš„æœ€åä¸€ä¸ªæ ¸å¿ƒå†…å®¹ï¼šæ’ä»¶ã€‚</p>
<h3 id="å››-æ’ä»¶"><a class="markdownIt-Anchor" href="#å››-æ’ä»¶"></a> å››ã€æ’ä»¶</h3>
<p>ï¼ˆå·²ç»å…­ä¸‡å­—äº†ï¼Œï¼Œï¼Œæˆ‘å½“æ—¶è®ºæ–‡éƒ½æ²¡è¿™ä¹ˆå¤šå­—ğŸ˜­ï¼‰</p>
<p>é€šè¿‡å‰æ–‡å¯¹äº @vue/cli å’Œ @vue/cli-service çš„ä»‹ç»æˆ‘ä»¬ä¹Ÿå·²ç»åˆæ­¥çŸ¥é“äº† Vue CLI ä¸­æ’ä»¶çš„é‡è¦æ€§ï¼Œä¸€ä¸ª CLI æ’ä»¶æ˜¯ä¸€ä¸ª npm åŒ…ï¼Œå®ƒèƒ½å¤Ÿä¸º Vue CLI åˆ›å»ºçš„é¡¹ç›®æ·»åŠ é¢å¤–çš„åŠŸèƒ½ï¼Œè¿™äº›åŠŸèƒ½åŒ…æ‹¬ï¼š</p>
<ul>
<li>ä¿®æ”¹é¡¹ç›®çš„ webpack é…ç½® - ä¾‹å¦‚ï¼Œå¦‚æœä½ çš„æ’ä»¶å¸Œæœ›å»é’ˆå¯¹æŸç§ç±»å‹çš„æ–‡ä»¶å·¥ä½œï¼Œä½ å¯ä»¥ä¸ºè¿™ä¸ªç‰¹å®šçš„æ–‡ä»¶æ‰©å±•åæ·»åŠ æ–°çš„ webpack è§£æè§„åˆ™ã€‚æ¯”å¦‚è¯´ï¼Œ@vue/cli-plugin-typescript å°±æ·»åŠ è¿™æ ·çš„è§„åˆ™æ¥è§£æ .ts å’Œ .tsx æ‰©å±•çš„æ–‡ä»¶ï¼›</li>
<li>æ·»åŠ æ–°çš„ vue-cli-service å‘½ä»¤ - ä¾‹å¦‚ï¼Œ@vue/cli-plugin-unit-jest æ·»åŠ äº† test:unit å‘½ä»¤ï¼Œå…è®¸å¼€å‘è€…è¿è¡Œå•å…ƒæµ‹è¯•ï¼›</li>
<li>æ‰©å±• package.json - å½“ä½ çš„æ’ä»¶æ·»åŠ äº†ä¸€äº›ä¾èµ–åˆ°é¡¹ç›®ä¸­ï¼Œä½ éœ€è¦å°†ä»–ä»¬æ·»åŠ åˆ° package çš„ dependencies éƒ¨åˆ†æ—¶ï¼Œè¿™æ˜¯ä¸€ä¸ªæœ‰ç”¨çš„é€‰é¡¹ï¼›</li>
<li>åœ¨é¡¹ç›®ä¸­åˆ›å»ºæ–°æ–‡ä»¶ã€æˆ–è€…ä¿®æ”¹è€æ–‡ä»¶ã€‚æœ‰æ—¶åˆ›å»ºä¸€ä¸ªç¤ºä¾‹ç»„ä»¶æˆ–è€…é€šè¿‡ç»™å…¥å£æ–‡ä»¶ï¼ˆmain.jsï¼‰æ·»åŠ å¯¼å…¥ï¼ˆimportsï¼‰æ˜¯ä¸€ä¸ªå¥½çš„ä¸»æ„ï¼›</li>
<li>æç¤ºç”¨æˆ·é€‰æ‹©ä¸€ä¸ªç‰¹å®šçš„é€‰é¡¹ - ä¾‹å¦‚ï¼Œä½ å¯ä»¥è¯¢é—®ç”¨æˆ·æ˜¯å¦åˆ›å»ºæˆ‘ä»¬å‰é¢æåˆ°çš„ç¤ºä¾‹ç»„ä»¶ã€‚</li>
</ul>
<p>CLI æ’ä»¶åº”è¯¥æ€»æ˜¯åŒ…å«ä¸€ä¸ª service æ’ä»¶ åšä¸ºä¸»çš„å¯¼å‡ºï¼Œå¹¶ä¸”ä»–èƒ½å¤Ÿé€‰æ‹©æ€§çš„åŒ…å« generator, prompt æ–‡ä»¶ å’Œ Vue UI é›†æˆã€‚</p>
<p>ä½œä¸ºä¸€ä¸ª npm åŒ…ï¼ŒCLI æ’ä»¶å¿…é¡»æœ‰ä¸€ä¸ª package.json æ–‡ä»¶ã€‚é€šå¸¸å»ºè®®åœ¨ <a target="_blank" rel="noopener" href="http://README.md">README.md</a> ä¸­åŒ…å«æ’ä»¶çš„æè¿°ï¼Œæ¥å¸®åŠ©å…¶ä»–äººåœ¨ npm ä¸Šå‘ç°ä½ çš„æ’ä»¶ã€‚</p>
<p>æ‰€ä»¥ï¼Œé€šå¸¸çš„ CLI æ’ä»¶ç›®å½•ç»“æ„çœ‹èµ·æ¥åƒä¸‹é¢è¿™æ ·ï¼š</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">â”œâ”€â”€ README.md</span><br><span class="line">â”œâ”€â”€ generator.js  <span class="comment"># generatorï¼ˆå¯é€‰ï¼‰</span></span><br><span class="line">â”œâ”€â”€ index.js      <span class="comment"># service æ’ä»¶</span></span><br><span class="line">â”œâ”€â”€ package.json</span><br><span class="line">â”œâ”€â”€ prompts.js    <span class="comment"># prompt æ–‡ä»¶ï¼ˆå¯é€‰ï¼‰</span></span><br><span class="line">â””â”€â”€ ui.js         <span class="comment"># Vue UI é›†æˆï¼ˆå¯é€‰ï¼‰</span></span><br></pre></td></tr></table></figure>
<h4 id="1-packagejson"><a class="markdownIt-Anchor" href="#1-packagejson"></a> 1ã€package.json</h4>
<p>ä¸ºäº†è®©ä¸€ä¸ª CLI æ’ä»¶åœ¨ Vue CLI é¡¹ç›®ä¸­è¢«æ­£å¸¸ä½¿ç”¨ï¼Œå®ƒå¿…é¡»éµå¾ª vue-cli-plugin-<name> æˆ–è€… @scope/vue-cli-plugin-<name> è¿™æ ·çš„å‘½åæƒ¯ä¾‹ã€‚è¿™æ ·ä½ çš„æ’ä»¶æ‰èƒ½å¤Ÿï¼š</p>
<ul>
<li>è¢« @vue/cli-service å‘ç°;</li>
<li>è¢«å…¶ä»–å¼€å‘è€…é€šè¿‡æœç´¢å‘ç°;</li>
<li>é€šè¿‡ <code>vue add &lt;name&gt;</code> æˆ–è€… <code>vue invoke &lt;name&gt;</code> å®‰è£…;</li>
</ul>
<p>ä¸ºäº†èƒ½å¤Ÿè¢«ç”¨æˆ·åœ¨æœç´¢æ—¶æ›´å¥½çš„å‘ç°ï¼Œkeywords å°½å¯èƒ½å¤šå†™ä¸€äº›é¡¹ç›®ç›¸å…³çš„è¯ï¼ŒåŒæ—¶å¯ä»¥å°†æ’ä»¶çš„å…³é”®æè¿°æ”¾åˆ° description å­—æ®µä¸­ã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;vue-cli-plugin-apollo&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;version&quot;</span>: <span class="string">&quot;0.7.7&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;description&quot;</span>: <span class="string">&quot;vue-cli plugin to add Apollo and GraphQL&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä½ åº”è¯¥åœ¨ homepage æˆ–è€… repository å­—æ®µæ·»åŠ åˆ›å»ºæ’ä»¶çš„å®˜ç½‘åœ°å€æˆ–è€…ä»“åº“çš„åœ°å€ï¼Œè¿™æ ·ä½ çš„æ’ä»¶è¯¦æƒ…é‡Œå°±ä¼šå‡ºç°ä¸€ä¸ª æŸ¥çœ‹è¯¦æƒ… æŒ‰é’®ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;repository&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;git&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;url&quot;</span>: <span class="string">&quot;git+https://github.com/Akryum/vue-cli-plugin-apollo.git&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;homepage&quot;</span>: <span class="string">&quot;https://github.com/Akryum/vue-cli-plugin-apollo#readme&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-generator"><a class="markdownIt-Anchor" href="#2-generator"></a> 2ã€generator</h4>
<p>æ’ä»¶çš„ Generator éƒ¨åˆ†é€šå¸¸åœ¨ä½ æƒ³è¦ä¸ºé¡¹ç›®æ‰©å±•åŒ…ä¾èµ–ï¼Œåˆ›å»ºæ–°çš„æ–‡ä»¶æˆ–è€…ç¼–è¾‘å·²ç»å­˜åœ¨çš„æ–‡ä»¶æ—¶éœ€è¦ã€‚åœ¨ CLI æ’ä»¶å†…éƒ¨ï¼Œgenerator åº”è¯¥æ”¾åœ¨ generator.js æˆ–è€… generator/index.js æ–‡ä»¶ä¸­ã€‚å®ƒå°†åœ¨ä»¥ä¸‹ä¸¤ä¸ªåœºæ™¯è¢«è°ƒç”¨ï¼š</p>
<ul>
<li>é¡¹ç›®åˆå§‹åˆ›å»ºæœŸé—´ï¼ŒCLI æ’ä»¶è¢«ä½œä¸ºé¡¹ç›®åˆ›å»º preset çš„ä¸€éƒ¨åˆ†è¢«å®‰è£…æ—¶ã€‚</li>
<li>å½“æ’ä»¶åœ¨é¡¹ç›®åˆ›å»ºå®Œæˆå’Œé€šè¿‡ vue add æˆ–è€… vue invoke å•ç‹¬è°ƒç”¨è¢«å®‰è£…æ—¶ã€‚</li>
</ul>
<p>ä¸€ä¸ª generator åº”è¯¥å¯¼å‡ºä¸€ä¸ªæ¥æ”¶ä¸‰ä¸ªå‚æ•°çš„å‡½æ•°ï¼š</p>
<p>1ã€ä¸€ä¸ª GeneratorAPI å®ä¾‹ï¼›</p>
<p>2ã€æ’ä»¶çš„ generator é€‰é¡¹ã€‚è¿™äº›é€‰é¡¹åœ¨é¡¹ç›®åˆ›å»ºï¼Œæˆ–è€…ä» ~/.vuerc è½½å…¥é¢„è®¾æ—¶è¢«è§£æã€‚ä¾‹å¦‚ï¼šå¦‚æœä¿å­˜çš„ ~/.vuerc åƒè¿™æ ·ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;presets&quot;</span> : &#123;</span><br><span class="line">    <span class="attr">&quot;foo&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;plugins&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;@vue/cli-plugin-foo&quot;</span>: &#123; <span class="attr">&quot;option&quot;</span>: <span class="string">&quot;bar&quot;</span> &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¦‚æœç”¨æˆ·ä½¿ç”¨ preset foo åˆ›å»ºäº†ä¸€ä¸ªé¡¹ç›®ï¼Œé‚£ä¹ˆ @vue/cli-plugin-foo çš„ generator å°±ä¼šæ”¶åˆ° { option: â€˜barâ€™ } ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ã€‚</p>
<p>å¯¹äºç¬¬ä¸‰æ–¹æ’ä»¶ï¼Œè¿™ä¸ªé€‰é¡¹å°†åœ¨ç”¨æˆ·æ‰§è¡Œ vue invoke æ—¶ï¼Œä»æç¤ºæˆ–è€…å‘½ä»¤è¡Œå‚æ•°ä¸­è¢«è§£æã€‚</p>
<p>3ã€æ•´ä¸ª preset (presets.foo) å°†ä¼šä½œä¸ºç¬¬ä¸‰ä¸ªå‚æ•°ä¼ å…¥ã€‚</p>
<p>å…³äº GeneratorAPI æˆ‘ä»¬å·²ç»åœ¨å‰é¢è§£æ @vue/cli çš„è¿‡ç¨‹ä¸­è¿›è¡Œäº†è¯¦ç»†ä»‹ç»ï¼Œé‚£ä¹ˆæˆ‘ä»¬é€šè¿‡ GeneratorAPI å¯ä»¥å®ç°å“ªäº›åŠŸèƒ½å‘¢ï¼Ÿ</p>
<p><strong>1ã€åˆ›å»ºæ–°çš„æ¨¡æ¿</strong></p>
<p>å½“ä½ è°ƒç”¨ api.render(â€™./templateâ€™) æ—¶ï¼Œè¯¥ generator å°†ä¼šä½¿ç”¨ EJS æ¸²æŸ“ ./template ä¸­çš„æ–‡ä»¶ (ç›¸å¯¹äº generator ä¸­çš„æ–‡ä»¶è·¯å¾„è¿›è¡Œè§£æ)</p>
<p>æƒ³è±¡æˆ‘ä»¬æ­£åœ¨åˆ›å»º vue-cli-auto-routing æ’ä»¶ï¼Œæˆ‘ä»¬å¸Œæœ›å½“æ’ä»¶åœ¨é¡¹ç›®ä¸­è¢«å¼•ç”¨æ—¶åšä»¥ä¸‹çš„æ”¹å˜ï¼š</p>
<ul>
<li>åˆ›å»ºä¸€ä¸ª layouts æ–‡ä»¶å¤¹åŒ…å«é»˜è®¤å¸ƒå±€æ–‡ä»¶ï¼›</li>
<li>åˆ›å»ºä¸€ä¸ª pages æ–‡ä»¶å¤¹åŒ…å« about å’Œ home é¡µé¢ï¼›</li>
<li>åœ¨ src æ–‡ä»¶å¤¹ä¸­æ·»åŠ  router.js æ–‡ä»¶</li>
</ul>
<p>ä¸ºäº†æ¸²æŸ“è¿™ä¸ªç»“æ„ï¼Œä½ éœ€è¦åœ¨ generator/template æ–‡ä»¶å¤¹å†…åˆ›å»ºå®ƒï¼š</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">â”œâ”€â”€ src</span><br><span class="line"> â”œâ”€â”€ layouts</span><br><span class="line">  â”œâ”€â”€ default.vue</span><br><span class="line"> â”œâ”€â”€ pages</span><br><span class="line">  â”œâ”€â”€ about.vue</span><br><span class="line">  â”œâ”€â”€ home.vue</span><br><span class="line"> â”œâ”€â”€ router</span><br><span class="line">  â””â”€â”€ index.js</span><br></pre></td></tr></table></figure>
<p>æ¨¡æ¿åˆ›å»ºå®Œä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨ generator/index.js æ–‡ä»¶ä¸­æ·»åŠ  api.render(â€™./templateâ€™) æ¥è°ƒç”¨ã€‚</p>
<p>ä¸è¿‡éœ€è¦æ³¨æ„æ–‡ä»¶åçš„è¾¹ç•Œæƒ…å†µï¼Œå¦‚æœä½ æƒ³è¦æ¸²æŸ“ä¸€ä¸ªä»¥ç‚¹å¼€å¤´çš„æ¨¡æ¿æ–‡ä»¶ (ä¾‹å¦‚ .env)ï¼Œåˆ™éœ€è¦éµå¾ªä¸€ä¸ªç‰¹æ®Šçš„å‘½åçº¦å®šï¼Œå› ä¸ºä»¥ç‚¹å¼€å¤´çš„æ–‡ä»¶ä¼šåœ¨æ’ä»¶å‘å¸ƒåˆ° npm çš„æ—¶å€™è¢«å¿½ç•¥ï¼š</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä»¥ç‚¹å¼€å¤´çš„æ¨¡æ¿éœ€è¦ä½¿ç”¨ä¸‹åˆ’çº¿å–ä»£é‚£ä¸ªç‚¹ï¼š</span></span><br><span class="line"></span><br><span class="line">/generator/template/_env</span><br><span class="line"></span><br><span class="line"><span class="comment"># å½“è°ƒç”¨ api.render(&#x27;./template&#x27;) æ—¶ï¼Œå®ƒåœ¨é¡¹ç›®æ–‡ä»¶å¤¹ä¸­å°†è¢«æ¸²æŸ“ä¸ºï¼š</span></span><br><span class="line"></span><br><span class="line">/generator/template/.env</span><br></pre></td></tr></table></figure>
<p>åŒæ—¶è¿™ä¹Ÿæ„å‘³ç€å½“ä½ æƒ³æ¸²æŸ“ä»¥ä¸‹åˆ’çº¿å¼€å¤´çš„æ–‡ä»¶æ—¶ï¼ŒåŒæ ·éœ€è¦éµå¾ªä¸€ä¸ªç‰¹æ®Šçš„å‘½åçº¦å®šï¼š</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿™ç§æ¨¡æ¿éœ€è¦ä½¿ç”¨ä¸¤ä¸ªä¸‹åˆ’çº¿æ¥å–ä»£å•ä¸ªä¸‹åˆ’çº¿ï¼š</span></span><br><span class="line"></span><br><span class="line">/generator/template/__variables.scss</span><br><span class="line"></span><br><span class="line"><span class="comment"># å½“è°ƒç”¨ api.render(&#x27;./template&#x27;) æ—¶ï¼Œå®ƒåœ¨é¡¹ç›®æ–‡ä»¶å¤¹ä¸­å°†è¢«æ¸²æŸ“ä¸ºï¼š</span></span><br><span class="line"></span><br><span class="line">/generator/template/_variable.scss</span><br></pre></td></tr></table></figure>
<p><strong>2ã€ç¼–è¾‘å·²ç»å­˜åœ¨çš„æ¨¡æ¿</strong></p>
<p>æ­¤å¤–ï¼Œä½ å¯ä»¥ä½¿ç”¨ YAML å‰ç½®å…ƒä¿¡æ¯ç»§æ‰¿å¹¶æ›¿æ¢å·²æœ‰çš„æ¨¡æ¿æ–‡ä»¶çš„ä¸€éƒ¨åˆ†ï¼ˆå³ä½¿æ¥è‡ªå¦ä¸€ä¸ªåŒ…ï¼‰ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">extend:</span> <span class="string">&#x27;@vue/cli-service/generator/template/src/App.vue&#x27;</span></span><br><span class="line"><span class="attr">replace:</span> <span class="type">!!js/regexp</span> <span class="string">/&lt;script&gt;[^]*?&lt;\/script&gt;/</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"></span><br><span class="line"><span class="string">&lt;script&gt;</span></span><br><span class="line"><span class="string">export</span> <span class="string">default</span> &#123;</span><br><span class="line">  <span class="string">//</span> <span class="string">æ›¿æ¢é»˜è®¤è„šæœ¬</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="string">&lt;/script&gt;</span></span><br></pre></td></tr></table></figure>
<p>ä¹Ÿå¯ä»¥æ›¿æ¢å¤šå¤„ï¼Œåªä¸è¿‡ä½ éœ€è¦å°†æ›¿æ¢çš„å­—ç¬¦ä¸²åŒ…è£¹åœ¨ &lt;%# REPLACE %&gt; å’Œ &lt;%# END_REPLACE %&gt; å—ä¸­ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">extend:</span> <span class="string">&#x27;@vue/cli-service/generator/template/src/App.vue&#x27;</span></span><br><span class="line"><span class="attr">replace:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="type">!!js/regexp</span> <span class="string">/Welcome</span> <span class="string">to</span> <span class="string">Your</span> <span class="string">Vue\.js</span> <span class="string">App/</span></span><br><span class="line">  <span class="bullet">-</span> <span class="type">!!js/regexp</span> <span class="string">/&lt;script&gt;[^]*?&lt;\/script&gt;</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"></span><br><span class="line">&lt;%<span class="ruby"><span class="comment"># REPLACE </span></span>%&gt;</span><br><span class="line"><span class="string">æ›¿æ¢æ¬¢è¿ä¿¡æ¯</span></span><br><span class="line">&lt;%<span class="ruby"><span class="comment"># END_REPLACE </span></span>%&gt;</span><br><span class="line"></span><br><span class="line">&lt;%<span class="ruby"><span class="comment"># REPLACE </span></span>%&gt;</span><br><span class="line"><span class="string">&lt;script&gt;</span></span><br><span class="line"><span class="string">export</span> <span class="string">default</span> &#123;</span><br><span class="line">  <span class="string">//</span> <span class="string">æ›¿æ¢é»˜è®¤è„šæœ¬</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="string">&lt;/script&gt;</span></span><br><span class="line">&lt;%<span class="ruby"><span class="comment"># END_REPLACE </span></span>%&gt;</span><br></pre></td></tr></table></figure>
<p><strong>3ã€æ‰©å±•åŒ…</strong></p>
<p>å¦‚æœä½ éœ€è¦å‘é¡¹ç›®ä¸­æ·»åŠ é¢å¤–çš„ä¾èµ–ï¼Œåˆ›å»ºä¸€ä¸ª npm è„šæœ¬æˆ–è€…ä¿®æ”¹ package.json çš„å…¶ä»–ä»»ä½•ä¸€å¤„ï¼Œä½ å¯ä»¥ä½¿ç”¨ API extendPackage æ–¹æ³•ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generator/index.js</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="params">api</span> =&gt;</span> &#123;</span><br><span class="line">  api.extendPackage(&#123;</span><br><span class="line">    dependencies: &#123;</span><br><span class="line">      <span class="string">&#x27;vue-router-layout&#x27;</span>: <span class="string">&#x27;^0.1.2&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨ä¸Šé¢è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æ·»åŠ äº†ä¸€ä¸ªä¾èµ–ï¼švue-router-layoutã€‚åœ¨æ’ä»¶è°ƒç”¨æ—¶ï¼Œè¿™ä¸ª npm æ¨¡å—å°†è¢«å®‰è£…ï¼Œè¿™ä¸ªä¾èµ–å°†è¢«æ·»åŠ åˆ°ç”¨æˆ·é¡¹ç›®çš„ package.json æ–‡ä»¶ã€‚</p>
<p>åŒæ ·ä½¿ç”¨è¿™ä¸ª API æˆ‘ä»¬å¯ä»¥æ·»åŠ æ–°çš„ npm ä»»åŠ¡åˆ°é¡¹ç›®ä¸­ã€‚ä¸ºäº†å®ç°è¿™ä¸ªï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰ä¸€ä¸ªä»»åŠ¡åå’Œä¸€ä¸ªå‘½ä»¤ï¼Œè¿™æ ·ä»–æ‰èƒ½å¤Ÿåœ¨ç”¨æˆ· package.json æ–‡ä»¶çš„ scripts éƒ¨åˆ†è¿è¡Œï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generator/index.js</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="params">api</span> =&gt;</span> &#123;</span><br><span class="line">  api.extendPackage(&#123;</span><br><span class="line">    scripts: &#123;</span><br><span class="line">      greet: <span class="string">&#x27;vue-cli-service greet&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨ä¸Šé¢è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æ·»åŠ äº†ä¸€ä¸ªæ–°çš„ greet ä»»åŠ¡æ¥æ‰§è¡Œä¸€ä¸ªåˆ›å»ºåœ¨ Service éƒ¨åˆ† çš„è‡ªå®šä¹‰ vue-cli æœåŠ¡å‘½ä»¤ã€‚</p>
<p><strong>4ã€ä¿®æ”¹ä¸»æ–‡ä»¶</strong></p>
<p>é€šè¿‡ generator æ–¹æ³•ä½ èƒ½å¤Ÿä¿®æ”¹é¡¹ç›®ä¸­çš„æ–‡ä»¶ã€‚æœ€æœ‰ç”¨çš„åœºæ™¯æ˜¯é’ˆå¯¹ main.js æˆ– main.ts æ–‡ä»¶çš„ä¸€äº›ä¿®æ”¹ï¼šæ–°çš„å¯¼å…¥ï¼Œæ–°çš„ Vue.use() è°ƒç”¨ç­‰ã€‚</p>
<p>è®©æˆ‘ä»¬æ¥æ€è€ƒä¸€ä¸ªåœºæ™¯ï¼Œå½“æˆ‘ä»¬é€šè¿‡ æ¨¡æ¿ åˆ›å»ºäº†ä¸€ä¸ª router.js æ–‡ä»¶ï¼Œç°åœ¨æˆ‘ä»¬å¸Œæœ›å¯¼å…¥è¿™ä¸ªè·¯ç”±åˆ°ä¸»æ–‡ä»¶ä¸­ã€‚æˆ‘ä»¬å°†ç”¨åˆ°ä¸¤ä¸ª generator API æ–¹æ³•ï¼š entryFile å°†è¿”å›é¡¹ç›®çš„ä¸»æ–‡ä»¶ï¼ˆmain.js æˆ– main.tsï¼‰ï¼ŒinjectImports ç”¨äºæ·»åŠ æ–°çš„å¯¼å…¥åˆ°ä¸»æ–‡ä»¶ä¸­ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generator/index.js</span></span><br><span class="line"></span><br><span class="line">api.injectImports(api.entryFile, <span class="string">`import router from &#x27;./router&#x27;`</span>)</span><br></pre></td></tr></table></figure>
<p>ç°åœ¨ï¼Œå½“æˆ‘ä»¬è·¯ç”±è¢«å¯¼å…¥æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸»æ–‡ä»¶ä¸­å°†è¿™ä¸ªè·¯ç”±æ³¨å…¥åˆ° Vue å®ä¾‹ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ afterInvoke é’©å­ï¼Œè¿™ä¸ªé’©å­å°†åœ¨æ–‡ä»¶è¢«å†™å…¥ç¡¬ç›˜ä¹‹åè¢«è°ƒç”¨ã€‚</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡ Node çš„ fs æ¨¡å—ï¼ˆæä¾›äº†æ–‡ä»¶äº¤äº’ APIï¼‰è¯»å–æ–‡ä»¶å†…å®¹ï¼Œå°†å†…å®¹æ‹†åˆ†</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generator/index.js</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports.hooks = <span class="function">(<span class="params">api</span>) =&gt;</span> &#123;</span><br><span class="line">  api.afterInvoke(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line">    <span class="keyword">const</span> contentMain = fs.readFileSync(api.resolve(api.entryFile), &#123; <span class="attr">encoding</span>: <span class="string">&#x27;utf-8&#x27;</span> &#125;)</span><br><span class="line">    <span class="keyword">const</span> lines = contentMain.split(<span class="regexp">/\r?\n/g</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç„¶åæˆ‘ä»¬éœ€è¦æ‰¾åˆ°åŒ…å« render å•è¯çš„å­—ç¬¦ä¸²ï¼ˆå®ƒé€šå¸¸æ˜¯ Vue å®ä¾‹çš„ä¸€éƒ¨åˆ†ï¼‰ï¼Œrouter å°±æ˜¯ä¸‹ä¸€ä¸ªå­—ç¬¦ä¸²ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generator/index.js</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports.hooks = <span class="function">(<span class="params">api</span>) =&gt;</span> &#123;</span><br><span class="line">  api.afterInvoke(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line">    <span class="keyword">const</span> contentMain = fs.readFileSync(api.resolve(api.entryFile), &#123; <span class="attr">encoding</span>: <span class="string">&#x27;utf-8&#x27;</span> &#125;)</span><br><span class="line">    <span class="keyword">const</span> lines = contentMain.split(<span class="regexp">/\r?\n/g</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> renderIndex = lines.findIndex(<span class="function"><span class="params">line</span> =&gt;</span> line.match(<span class="regexp">/render/</span>))</span><br><span class="line">    lines[renderIndex] += <span class="string">`\n router,`</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æœ€åï¼Œä½ éœ€è¦å°†å†…å®¹å†™å…¥ä¸»æ–‡ä»¶ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generator/index.js</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports.hooks = <span class="function">(<span class="params">api</span>) =&gt;</span> &#123;</span><br><span class="line">  api.afterInvoke(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; EOL &#125; = <span class="built_in">require</span>(<span class="string">&#x27;os&#x27;</span>)</span><br><span class="line">    <span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line">    <span class="keyword">const</span> contentMain = fs.readFileSync(api.resolve(api.entryFile), &#123; <span class="attr">encoding</span>: <span class="string">&#x27;utf-8&#x27;</span> &#125;)</span><br><span class="line">    <span class="keyword">const</span> lines = contentMain.split(<span class="regexp">/\r?\n/g</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> renderIndex = lines.findIndex(<span class="function"><span class="params">line</span> =&gt;</span> line.match(<span class="regexp">/render/</span>))</span><br><span class="line">    lines[renderIndex] += <span class="string">`<span class="subst">$&#123;EOL&#125;</span>  router,`</span></span><br><span class="line"></span><br><span class="line">    fs.writeFileSync(api.entryFile, lines.join(EOL), &#123; <span class="attr">encoding</span>: <span class="string">&#x27;utf-8&#x27;</span> &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="3-service-æ’ä»¶"><a class="markdownIt-Anchor" href="#3-service-æ’ä»¶"></a> 3ã€service æ’ä»¶</h4>
<p>Service æ’ä»¶å¯ä»¥ä¿®æ”¹ webpack é…ç½®ï¼Œåˆ›å»ºæ–°çš„ vue-cli service å‘½ä»¤æˆ–è€…ä¿®æ”¹å·²ç»å­˜åœ¨çš„å‘½ä»¤ï¼ˆå¦‚ serve å’Œ buildï¼‰ã€‚</p>
<p>Service æ’ä»¶åœ¨ Service å®ä¾‹è¢«åˆ›å»ºåè‡ªåŠ¨åŠ è½½ - ä¾‹å¦‚ï¼Œæ¯æ¬¡ vue-cli-service å‘½ä»¤åœ¨é¡¹ç›®ä¸­è¢«è°ƒç”¨çš„æ—¶å€™ã€‚å®ƒä½äº CLI æ’ä»¶æ ¹ç›®å½•çš„ index.js æ–‡ä»¶ã€‚</p>
<p>ä¸€ä¸ª service æ’ä»¶åº”è¯¥å¯¼å‡ºä¸€ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°æ¥å—ä¸¤ä¸ªå‚æ•°ï¼š</p>
<ul>
<li>ä¸€ä¸ª PluginAPI å®ä¾‹</li>
<li>ä¸€ä¸ªåŒ…å« vue.config.js å†…æŒ‡å®šçš„é¡¹ç›®æœ¬åœ°é€‰é¡¹çš„å¯¹è±¡ï¼Œæˆ–è€…åœ¨ package.json å†…çš„ vue å­—æ®µã€‚</li>
</ul>
<p>PluginAPI ä¸º service æ’ä»¶æä¾›äº†é’ˆå¯¹ä¸åŒçš„ç¯å¢ƒæ‰©å±•/ä¿®æ”¹å†…éƒ¨çš„ webpack é…ç½®çš„èƒ½åŠ›ã€‚ä¾‹å¦‚ï¼Œè¿™é‡Œæˆ‘ä»¬åœ¨ webpack-chain ä¸­æ·»åŠ  vue-auto-routing è¿™ä¸ª webpack æ’ä»¶ï¼Œå¹¶æŒ‡å®šå‚æ•°ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> VueAutoRoutingPlugin = <span class="built_in">require</span>(<span class="string">&#x27;vue-auto-routing/lib/webpack-plugin&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function">(<span class="params">api, options</span>) =&gt;</span> &#123;</span><br><span class="line">  api.chainWebpack(<span class="function"><span class="params">webpackConfig</span> =&gt;</span> &#123;</span><br><span class="line">    webpackConfig</span><br><span class="line">    .plugin(<span class="string">&#x27;vue-auto-routing&#x27;</span>)</span><br><span class="line">      .use(VueAutoRoutingPlugin, [</span><br><span class="line">        &#123;</span><br><span class="line">          pages: <span class="string">&#x27;src/pages&#x27;</span>,</span><br><span class="line">          nested: <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">      ])</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ configureWebpack æ–¹æ³•ä¿®æ”¹ webpack é…ç½®æˆ–è€…è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œè¿”å›çš„å¯¹è±¡å°†é€šè¿‡ webpack-merge è¢«åˆå¹¶åˆ°é…ç½®ä¸­ã€‚</p>
<p>é™¤äº†ä¿®æ”¹ webpack é…ç½®ä¹‹å¤–æˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡ Service æ’ä»¶å®ç°å¦‚ä¸‹åŠŸèƒ½ï¼š</p>
<p><strong>1ã€æ·»åŠ ä¸€ä¸ªæ–°çš„ cli-service å‘½ä»¤</strong></p>
<p>é€šè¿‡ service æ’ä»¶ä½ å¯ä»¥æ³¨å†Œä¸€ä¸ªæ–°çš„ cli-service å‘½ä»¤ï¼Œé™¤äº†æ ‡å‡†çš„å‘½ä»¤ï¼ˆå³ serve å’Œ buildï¼‰ã€‚ä½ å¯ä»¥ä½¿ç”¨ registerCommand API æ–¹æ³•å®ç°ã€‚</p>
<p>ä¸‹é¢çš„ä¾‹å­åˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„æ–°å‘½ä»¤ï¼Œå¯ä»¥å‘å¼€å‘æ§åˆ¶å°è¾“å‡ºä¸€æ¡é—®å€™è¯­ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">api.registerCommand(</span><br><span class="line">  <span class="string">&#x27;greet&#x27;</span>,</span><br><span class="line">  &#123;</span><br><span class="line">    description: <span class="string">&#x27;Write a greeting to the console&#x27;</span>,</span><br><span class="line">    usage: <span class="string">&#x27;vue-cli-service greet&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  () =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`ğŸ‘‹  Hello`</span>)</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æä¾›äº†å‘½ä»¤çš„åå­—ï¼ˆâ€˜greetâ€™ï¼‰ã€ä¸€ä¸ªæœ‰ description å’Œ usage é€‰é¡¹çš„å¯¹è±¡ï¼Œå’Œä¸€ä¸ªåœ¨æ‰§è¡Œ vue-cli-service greet å‘½ä»¤æ—¶ä¼šè°ƒç”¨çš„å‡½æ•°ã€‚</p>
<p>å¦‚æœä½ åœ¨å·²ç»å®‰è£…äº†æ’ä»¶çš„é¡¹ç›®ä¸­è¿è¡Œæ–°å‘½ä»¤ï¼Œä½ å°†çœ‹åˆ°ä¸‹é¢çš„è¾“å‡ºï¼š</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ vue-cli-service greet</span><br><span class="line">ğŸ‘‹ Hello!</span><br></pre></td></tr></table></figure>
<p>ä½ ä¹Ÿå¯ä»¥ç»™æ–°å‘½ä»¤å®šä¹‰ä¸€ç³»åˆ—å¯èƒ½çš„é€‰é¡¹ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬æ·»åŠ ä¸€ä¸ª --name é€‰é¡¹ï¼Œå¹¶ä¿®æ”¹å®ç°å‡½æ•°ï¼Œå½“æä¾›äº† name å‚æ•°æ—¶æŠŠå®ƒä¹Ÿæ‰“å°å‡ºæ¥ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">api.registerCommand(</span><br><span class="line">  <span class="string">&#x27;greet&#x27;</span>,</span><br><span class="line">  &#123;</span><br><span class="line">    description: <span class="string">&#x27;Writes a greeting to the console&#x27;</span>,</span><br><span class="line">    usage: <span class="string">&#x27;vue-cli-service greet [options]&#x27;</span>,</span><br><span class="line">    options: &#123; <span class="string">&#x27;--name&#x27;</span>: <span class="string">&#x27;specifies a name for greeting&#x27;</span> &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  args =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (args.name) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">`ğŸ‘‹ Hello, <span class="subst">$&#123;args.name&#125;</span>!`</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">`ğŸ‘‹ Hello!`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>ç°åœ¨ï¼Œå¦‚æœ greet å‘½ä»¤æºå¸¦äº†ç‰¹å®šçš„ --name é€‰é¡¹ï¼Œè¿™ä¸ª name è¢«æ·»åŠ åˆ°æ§åˆ¶å°è¾“å‡ºï¼š</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ vue-cli-service greet --name <span class="string">&#x27;John Doe&#x27;</span></span><br><span class="line">ğŸ‘‹ Hello, John Doe!</span><br></pre></td></tr></table></figure>
<p><strong>2ã€ä¿®æ”¹å·²ç»å­˜åœ¨çš„ cli-service å‘½ä»¤</strong></p>
<p>å¦‚æœä½ æƒ³ä¿®æ”¹ä¸€ä¸ªå·²ç»å­˜åœ¨çš„ cli-service å‘½ä»¤ï¼Œä½ å¯ä»¥ä½¿ç”¨ api.service.commands è·å–åˆ°å‘½ä»¤å¯¹è±¡å¹¶ä¸”åšäº›æ”¹å˜ã€‚æˆ‘ä»¬å°†åœ¨åº”ç”¨ç¨‹åºè¿è¡Œçš„ç«¯å£æ‰“å°ä¸€æ¡ä¿¡æ¯åˆ°æ§åˆ¶å°ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; serve &#125; = api.service.commands</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> serveFn = serve.fn</span><br><span class="line"></span><br><span class="line">serve.fn = <span class="function">(<span class="params">...args</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> serveFn(...args).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="function"><span class="title">if</span>(<span class="params">res &amp;&amp; res.url</span>)</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">`Project is running now at <span class="subst">$&#123;res.url&#125;</span>`</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨ä¸Šé¢çš„è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä»å·²ç»å­˜åœ¨çš„å‘½ä»¤åˆ—è¡¨ä¸­è·å–åˆ°å‘½ä»¤å¯¹è±¡ serveï¼›ç„¶åæˆ‘ä»¬ä¿®æ”¹äº†ä»–çš„ fn éƒ¨åˆ†ï¼ˆfn æ˜¯åˆ›å»ºè¿™ä¸ªæ–°å‘½ä»¤æ—¶ä¼ å…¥çš„ç¬¬ä¸‰ä¸ªå‚æ•°ï¼›å®ƒå®šä¹‰äº†åœ¨æ‰§è¡Œè¿™ä¸ªå‘½ä»¤æ—¶è¦æ‰§è¡Œçš„å‡½æ•°ï¼‰ã€‚ä¿®æ”¹å®Œåï¼Œè¿™ä¸ªæ§åˆ¶å°æ¶ˆæ¯å°†åœ¨ serve å‘½ä»¤æˆåŠŸè¿è¡Œåæ‰“å°ã€‚</p>
<p><strong>3ã€ä¸ºå‘½ä»¤æŒ‡å®šæ¨¡å¼</strong></p>
<p>å¦‚æœä¸€ä¸ªå·²æ³¨å†Œçš„æ’ä»¶å‘½ä»¤éœ€è¦è¿è¡Œåœ¨ç‰¹å®šçš„é»˜è®¤æ¨¡å¼ä¸‹ï¼Œåˆ™è¯¥æ’ä»¶éœ€è¦é€šè¿‡ module.exports.defaultModes ä»¥ { [commandName]: mode } çš„å½¢å¼æ¥æš´éœ²ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="params">api</span> =&gt;</span> &#123;</span><br><span class="line">  api.registerCommand(<span class="string">&#x27;build&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports.defaultModes = &#123;</span><br><span class="line">  build: <span class="string">&#x27;production&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™æ˜¯å› ä¸ºæˆ‘ä»¬éœ€è¦åœ¨åŠ è½½ç¯å¢ƒå˜é‡ä¹‹å‰çŸ¥é“è¯¥å‘½ä»¤çš„é¢„æœŸæ¨¡å¼ï¼Œæ‰€ä»¥éœ€è¦æå‰åŠ è½½ç”¨æˆ·é€‰é¡¹/åº”ç”¨æ’ä»¶ã€‚</p>
<h4 id="4-prompt-æ–‡ä»¶"><a class="markdownIt-Anchor" href="#4-prompt-æ–‡ä»¶"></a> 4ã€prompt æ–‡ä»¶</h4>
<p>å¯¹è¯æ˜¯åœ¨åˆ›å»ºä¸€ä¸ªæ–°çš„é¡¹ç›®æˆ–è€…åœ¨å·²æœ‰é¡¹ç›®ä¸­æ·»åŠ æ–°çš„æ’ä»¶æ—¶å¤„ç†ç”¨æˆ·é€‰é¡¹æ—¶éœ€è¦çš„ã€‚æ‰€æœ‰çš„å¯¹è¯é€»è¾‘éƒ½å­˜å‚¨åœ¨ prompts.js æ–‡ä»¶ä¸­ã€‚å¯¹è¯å†…éƒ¨æ˜¯é€šè¿‡ inquirer å®ç°ã€‚</p>
<p>å½“ç”¨æˆ·é€šè¿‡è°ƒç”¨ vue invoke åˆå§‹åŒ–æ’ä»¶æ—¶ï¼Œå¦‚æœæ’ä»¶æ ¹ç›®å½•åŒ…å« prompts.jsï¼Œå®ƒå°†åœ¨è°ƒç”¨æ—¶è¢«ä½¿ç”¨ã€‚è¿™ä¸ªæ–‡ä»¶åº”è¯¥å¯¼å‡ºä¸€ä¸ªé—®é¢˜æ•°ç»„ â€“ å°†è¢« Inquirer.js å¤„ç†ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// prompts.js </span></span><br><span class="line"><span class="comment">// ç›´æ¥è¿”å›é—®é¢˜æ•°ç»„</span></span><br><span class="line"><span class="built_in">module</span>.exports = [</span><br><span class="line">  &#123;</span><br><span class="line">    type: <span class="string">&#x27;input&#x27;</span>,</span><br><span class="line">    name: <span class="string">&#x27;locale&#x27;</span>,</span><br><span class="line">    message: <span class="string">&#x27;The locale of project localization.&#x27;</span>,</span><br><span class="line">    validate: <span class="function"><span class="params">input</span> =&gt;</span> !!input,</span><br><span class="line">    <span class="keyword">default</span>: <span class="string">&#x27;en&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿”å›é—®é¢˜æ•°ç»„çš„å‡½æ•°</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="params">pkg</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> prompts = [</span><br><span class="line">    &#123;</span><br><span class="line">      type: <span class="string">&#x27;input&#x27;</span>,</span><br><span class="line">      name: <span class="string">&#x27;locale&#x27;</span>,</span><br><span class="line">      message: <span class="string">&#x27;The locale of project localization.&#x27;</span>,</span><br><span class="line">      validate: <span class="function"><span class="params">input</span> =&gt;</span> !!input,</span><br><span class="line">      <span class="keyword">default</span>: <span class="string">&#x27;en&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ·»åŠ åŠ¨æ€å¯¹è¯</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="string">&#x27;@vue/cli-plugin-eslint&#x27;</span> <span class="keyword">in</span> (pkg.devDependencies || &#123;&#125;)) &#123;</span><br><span class="line">    prompts.push(&#123;</span><br><span class="line">      type: <span class="string">&#x27;confirm&#x27;</span>,</span><br><span class="line">      name: <span class="string">&#x27;useESLintPluginVueI18n&#x27;</span>,</span><br><span class="line">      message: <span class="string">&#x27;Use ESLint plugin for Vue I18n ?&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> prompts</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è§£æåˆ°çš„ç­”æ¡ˆå¯¹è±¡å°†ä½œä¸ºé€‰é¡¹ä¼ å…¥åˆ°æ’ä»¶çš„ generatorã€‚å¦‚æœæˆ‘ä»¬æƒ³åœ¨ generator ä¸­ä½¿ç”¨ç”¨æˆ·çš„é€‰æ‹©ç»“æœï¼Œå¯ä»¥é€šè¿‡å¯¹è¯åå­—è·å¾—ã€‚ä¾‹å¦‚æˆ‘ä»¬å¯ä»¥ä¿®æ”¹ä¸€ä¸‹ generator/index.jsï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (options.useESLintPluginVueI18n) &#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="5-vue-ui-é›†æˆ"><a class="markdownIt-Anchor" href="#5-vue-ui-é›†æˆ"></a> 5ã€Vue UI é›†æˆ</h4>
<p>Vue CLI æœ‰ä¸€ä¸ªéå¸¸å¼ºå¤§çš„ UI å·¥å…· â€“ å…è®¸ç”¨æˆ·é€šè¿‡å›¾å½¢æ¥å£æ¥æ¶æ„å’Œç®¡ç†é¡¹ç›®ã€‚Vue CLI æ’ä»¶èƒ½å¤Ÿé›†æˆåˆ°æ¥å£ä¸­ã€‚UI ä¸º CLI æ’ä»¶æä¾›äº†é¢å¤–çš„åŠŸèƒ½ï¼š</p>
<ul>
<li>å¯ä»¥æ‰§è¡Œ npm ä»»åŠ¡ï¼Œç›´æ¥åœ¨ UI ä¸­æ‰§è¡Œæ’ä»¶ä¸­å®šä¹‰çš„å‘½ä»¤ï¼›</li>
<li>å¯ä»¥å±•ç¤ºæ’ä»¶çš„è‡ªå®šä¹‰é…ç½®ã€‚</li>
<li>å½“åˆ›å»ºé¡¹ç›®æ—¶ï¼Œä½ å¯ä»¥å±•ç¤ºå¯¹è¯</li>
<li>å¦‚æœä½ æƒ³æ”¯æŒå¤šç§è¯­è¨€ï¼Œä½ å¯ä»¥ä¸ºä½ çš„æ’ä»¶æ·»åŠ æœ¬åœ°åŒ–</li>
<li>ä½ å¯ä»¥ä½¿æ’ä»¶åœ¨ Vue UI æœç´¢ä¸­è¢«æœç´¢åˆ°</li>
</ul>
<p>å›¾å½¢åŒ–é…ç½®åŠç®¡ç†ä¹Ÿæ˜¯ Vue CLI æœ€æ–°æ¶æ„çš„ä¸€ä¸ªé‡è¦äº®ç‚¹ï¼Œä¸ªäººæ„Ÿè§‰å®é™…æ’ä»¶å¼€å‘æ¯”è¾ƒå°‘ç”¨ï¼Œæ‰€ä»¥æ­¤å¤„ä¸å†å±•å¼€ï¼Œè¯¦ç»†é…ç½®æ–¹æ³•è¯·æŸ¥çœ‹<a target="_blank" rel="noopener" href="https://cli.vuejs.org/zh/dev-guide/plugin-dev.html#ui-%E9%9B%86%E6%88%90">å®˜æ–¹æ–‡æ¡£</a></p>
<p>è‡³æ­¤å¯¹äº Vue CLI çš„æ¶æ„çš„ä¸»è¦åˆ†æå…¨éƒ¨å®Œæˆï¼Œè¿™ç§åŸºäºæ’ä»¶æœºåˆ¶çš„æ¶æ„ä¸ºå¼€å‘è€…æä¾›äº†ç»ˆç«¯å‘½ä»¤è¡Œå·¥å…·ã€é›¶é…ç½®è„šæ‰‹æ¶ã€æ’ä»¶ä½“ç³»ã€å›¾å½¢åŒ–ç®¡ç†ç•Œé¢ç­‰è¯¸å¤šåŠŸèƒ½ï¼Œç›¸è¾ƒäºæ—©å‰çš„  vue-cli å…¶å¯é…ç½®æ€§å¼ºï¼Œæä¸ºçµæ´»å¹¶ä¸”ç‰ˆæœ¬ä¾èµ–æ˜“äºç®¡ç†ä¸å‡çº§ï¼Œå°±å¾ˆç‰›çš®ï¼</p>
<img src="/assets/emoji/05.jpg" width="280" />
<h2 id="å‚è€ƒèµ„æ–™"><a class="markdownIt-Anchor" href="#å‚è€ƒèµ„æ–™"></a> å‚è€ƒèµ„æ–™</h2>
<p><a target="_blank" rel="noopener" href="https://kuangpf.com/vue-cli-analysis">vue-cli-analysis</a></p>
<p><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1781202">å‰–æ Vue CLI å®ç°åŸç†</a></p>
<p><a target="_blank" rel="noopener" href="https://cli.vuejs.org/">Vue CLIå®˜æ–¹æ–‡æ¡£</a></p>

    </div>

    
    
    
        <div class="reward-container">
  <div></div>
  <button onclick="var qr = document.getElementById('qr'); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    æ‰“èµ
  </button>
  <div id="qr" style="display: none;">
      
      <div style="display: inline-block;">
        <img src="/assets/config/weixin.png" alt="kyleezhang å¾®ä¿¡æ”¯ä»˜">
        <p>å¾®ä¿¡æ”¯ä»˜</p>
      </div>
      
      <div style="display: inline-block;">
        <img src="/assets/config/alipay.png" alt="kyleezhang æ”¯ä»˜å®">
        <p>æ”¯ä»˜å®</p>
      </div>

  </div>
</div>

        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>æœ¬æ–‡ä½œè€…ï¼š </strong>kyleezhang
  </li>
  <li class="post-copyright-link">
    <strong>æœ¬æ–‡é“¾æ¥ï¼š</strong>
    <a href="http://kyleezhang.com/2021/05/15/vue-cli-02/" title="ä»vue-cliåˆ°Vue CLIï¼ˆäºŒï¼‰">http://kyleezhang.com/2021/05/15/vue-cli-02/</a>
  </li>
  <li class="post-copyright-license">
    <strong>ç‰ˆæƒå£°æ˜ï¼š </strong>æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼
  </li>
</ul>
</div>

        

  <div class="followme">
    <p>æ¬¢è¿å…³æ³¨æˆ‘çš„å…¶å®ƒå‘å¸ƒæ¸ é“</p>

    <div class="social-list">

        <div class="social-item">
          <a target="_blank" class="social-link" href="/assets/config/wechat.png">
            <span class="icon">
              <i class="fab fa-weixin"></i>
            </span>

            <span class="label">WeChat</span>
          </a>
        </div>

        <div class="social-item">
          <a target="_blank" class="social-link" href="/atom.xml">
            <span class="icon">
              <i class="fa fa-rss"></i>
            </span>

            <span class="label">RSS</span>
          </a>
        </div>
    </div>
  </div>


      <footer class="post-footer">
          
          <div class="post-tags">
              <a href="/tags/cli/" rel="tag"><i class="fa fa-tag"></i>cli</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2021/04/21/javascript-number/" rel="prev" title="JavaScript ä¸­çš„ Number ç±»å‹">
      <i class="fa fa-chevron-left"></i> JavaScript ä¸­çš„ Number ç±»å‹
    </a></div>
      <div class="post-nav-item">
    <a href="/2021/06/02/javascript-array/" rel="next" title="JavaScript ä¸­çš„æ•°ç»„">
      JavaScript ä¸­çš„æ•°ç»„ <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="gitalk-container"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#vue-cli"><span class="nav-text"> Vue CLI</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%80-%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84"><span class="nav-text"> ä¸€ã€æ•´ä½“æ¶æ„</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%8C-vuecli"><span class="nav-text"> äºŒã€@vue&#x2F;cli</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-create-%E5%91%BD%E4%BB%A4"><span class="nav-text"> 1ã€create å‘½ä»¤</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-add-%E5%91%BD%E4%BB%A4"><span class="nav-text"> 2ã€add å‘½ä»¤</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%89-vuecli-service"><span class="nav-text"> ä¸‰ã€@vue&#x2F;cli-service</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E5%85%A5%E5%8F%A3"><span class="nav-text"> 1ã€å…¥å£</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-service-%E7%B1%BB%E5%AE%9E%E4%BE%8B%E5%8C%96"><span class="nav-text"> 2ã€Service ç±»å®ä¾‹åŒ–</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-%E5%AE%9E%E4%BE%8B%E7%9A%84-run-%E6%96%B9%E6%B3%95"><span class="nav-text"> 3ã€å®ä¾‹çš„ run æ–¹æ³•</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-%E6%80%BB%E7%BB%93"><span class="nav-text"> 4ã€æ€»ç»“</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9B%9B-%E6%8F%92%E4%BB%B6"><span class="nav-text"> å››ã€æ’ä»¶</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-packagejson"><span class="nav-text"> 1ã€package.json</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-generator"><span class="nav-text"> 2ã€generator</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-service-%E6%8F%92%E4%BB%B6"><span class="nav-text"> 3ã€service æ’ä»¶</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-prompt-%E6%96%87%E4%BB%B6"><span class="nav-text"> 4ã€prompt æ–‡ä»¶</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-vue-ui-%E9%9B%86%E6%88%90"><span class="nav-text"> 5ã€Vue UI é›†æˆ</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="nav-text"> å‚è€ƒèµ„æ–™</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="kyleezhang"
      src="/assets/config/avatar.png">
  <p class="site-author-name" itemprop="name">kyleezhang</p>
  <div class="site-description" itemprop="description">å­¦æºäºæ€</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">39</span>
          <span class="site-state-item-name">æ–‡ç« </span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">12</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/kyleezhang" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;kyleezhang" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="/2942181559@qq.com" title="E-Mail â†’ 2942181559@qq.com"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/u/6998903195" title="Weibo â†’ https:&#x2F;&#x2F;weibo.com&#x2F;u&#x2F;6998903195" rel="noopener" target="_blank"><i class="fab fa-weibo fa-fw"></i>Weibo</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">kyleezhang</span>
</div>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="ç«™ç‚¹æ€»å­—æ•°">564k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="ç«™ç‚¹é˜…è¯»æ—¶é•¿">8:33</span>
</div>



        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="æ€»è®¿å®¢é‡">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="æ€»è®¿é—®é‡">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

  

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.css">

<script>
NexT.utils.loadComments(document.querySelector('#gitalk-container'), () => {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID    : '5cb74a324ff7b0f7b544',
      clientSecret: 'cd372db5bb46f07eda7fae4b615fd27371c80dc7',
      repo        : 'kyleezhang.github.io',
      owner       : 'kyleezhang',
      admin       : ['kyleezhang'],
      id          : '54d70eba3fe0249ff8e00cc6ecdf92dc',
        language: 'zh-CN',
      distractionFreeMode: true
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
});
</script>

  <!-- èƒŒæ™¯åŠ¨ç”» -->
<script src="/js/particle.js"></script>

</body>
</html>
