<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/config/favicon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/config/favicon.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/config/favicon.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"kyleezhang.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"enable":true,"style":"tabs","active":false,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="å…¶å® Webpack å®˜ç½‘é¦–å±çš„è‹±é›„åŒºå°±å·²ç»å¾ˆæ¸…æ¥šåœ°æè¿°äº†å®ƒçš„å·¥ä½œåŸç†ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š">
<meta property="og:type" content="article">
<meta property="og:title" content="Webpackè¿è¡Œæœºåˆ¶">
<meta property="og:url" content="http://kyleezhang.com/2020/12/16/webpack-runtime/index.html">
<meta property="og:site_name" content="kyleezhang&#96;s Blog">
<meta property="og:description" content="å…¶å® Webpack å®˜ç½‘é¦–å±çš„è‹±é›„åŒºå°±å·²ç»å¾ˆæ¸…æ¥šåœ°æè¿°äº†å®ƒçš„å·¥ä½œåŸç†ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://kyleezhang.com/assets/webpack-runtime/01.png">
<meta property="og:image" content="http://kyleezhang.com/assets/webpack-runtime/02.gif">
<meta property="og:image" content="http://kyleezhang.com/assets/webpack-runtime/03.gif">
<meta property="og:image" content="http://kyleezhang.com/assets/webpack-runtime/04.png">
<meta property="og:image" content="http://kyleezhang.com/assets/webpack-runtime/05.png">
<meta property="og:image" content="http://kyleezhang.com/assets/webpack-runtime/06.png">
<meta property="og:image" content="http://kyleezhang.com/assets/webpack-runtime/08.png">
<meta property="og:image" content="http://kyleezhang.com/assets/webpack-runtime/09.png">
<meta property="og:image" content="http://kyleezhang.com/assets/webpack-runtime/10.png">
<meta property="og:image" content="http://kyleezhang.com/assets/webpack-runtime/11.png">
<meta property="og:image" content="http://kyleezhang.com/assets/webpack-runtime/12.png">
<meta property="og:image" content="http://kyleezhang.com/assets/webpack-runtime/13.jpg">
<meta property="og:image" content="http://kyleezhang.com/assets/webpack-runtime/15.png">
<meta property="og:image" content="http://kyleezhang.com/assets/webpack-runtime/14.png">
<meta property="og:image" content="http://kyleezhang.com/assets/webpack-runtime/16.jpg">
<meta property="og:image" content="http://kyleezhang.com/assets/webpack-runtime/17.jpg">
<meta property="og:image" content="http://kyleezhang.com/assets/webpack-runtime/18.jpeg">
<meta property="article:published_time" content="2020-12-16T15:20:42.000Z">
<meta property="article:modified_time" content="2022-06-16T02:32:58.933Z">
<meta property="article:author" content="kyleezhang">
<meta property="article:tag" content="webpack">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://kyleezhang.com/assets/webpack-runtime/01.png">

<link rel="canonical" href="http://kyleezhang.com/2020/12/16/webpack-runtime/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>Webpackè¿è¡Œæœºåˆ¶ | kyleezhang`s Blog</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-2KR3NK700N"></script>
    <script>
      if (CONFIG.hostname === location.hostname) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-2KR3NK700N');
      }
    </script>


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?f1621cb3fb0792bb294fce1b938d5eef";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="kyleezhang`s Blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband">
    <a target="_blank" rel="noopener" href="https://github.com/kyleezhang " class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#fff; color:#151513; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
    </div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ ">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">kyleezhang`s Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>é¦–é¡µ</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>æ ‡ç­¾</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>åˆ†ç±»</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>å½’æ¡£</a>

  </li>
        <li class="menu-item menu-item-sitemap">

    <a href="/sitemap.xml" rel="section"><i class="fa fa-sitemap fa-fw"></i>ç«™ç‚¹åœ°å›¾</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://kyleezhang.com/2020/12/16/webpack-runtime/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/assets/config/avatar.png">
      <meta itemprop="name" content="kyleezhang">
      <meta itemprop="description" content="å­¦æºäºæ€">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="kyleezhang`s Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Webpackè¿è¡Œæœºåˆ¶
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2020-12-16 15:20:42" itemprop="dateCreated datePublished" datetime="2020-12-16T15:20:42+00:00">2020-12-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2022-06-16 02:32:58" itemprop="dateModified" datetime="2022-06-16T02:32:58+00:00">2022-06-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/" itemprop="url" rel="index"><span itemprop="name">å‰ç«¯å·¥ç¨‹åŒ–</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="é˜…è¯»æ¬¡æ•°" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
              <span id="busuanzi_value_page_pv"></span>
            </span><br>
            <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
              <span>27k</span>
            </span>
            <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
              <span>25 åˆ†é’Ÿ</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>å…¶å® Webpack å®˜ç½‘é¦–å±çš„è‹±é›„åŒºå°±å·²ç»å¾ˆæ¸…æ¥šåœ°æè¿°äº†å®ƒçš„å·¥ä½œåŸç†ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br />
<img src="/assets/webpack-runtime/01.png" width="760" /></p>
<a id="more"></a>
<p>ä»¥ä¸€ä¸ªæ™®é€šçš„å‰ç«¯é¡¹ç›®ä¸ºä¾‹ï¼Œé¡¹ç›®ä¸­ä¸€èˆ¬éƒ½ä¼šæ•£è½ç€å„ç§å„æ ·çš„ä»£ç åŠèµ„æºæ–‡ä»¶ï¼Œæ¯”å¦‚ JSã€CSSã€å›¾ç‰‡ã€å­—ä½“ç­‰ï¼Œè¿™äº›æ–‡ä»¶åœ¨ Webpack çš„æ€æƒ³ä¸­éƒ½å±äºå½“å‰é¡¹ç›®ä¸­çš„ä¸€ä¸ªæ¨¡å—ã€‚Webpack å¯ä»¥é€šè¿‡æ‰“åŒ…ï¼Œå°†å®ƒä»¬æœ€ç»ˆèšé›†åˆ°ä¸€èµ·ã€‚Webpack åœ¨æ•´ä¸ªæ‰“åŒ…çš„è¿‡ç¨‹ä¸­ï¼š</p>
<ul>
<li>é€šè¿‡ Loader å¤„ç†ç‰¹æ®Šç±»å‹èµ„æºçš„åŠ è½½ï¼Œä¾‹å¦‚åŠ è½½æ ·å¼ã€å›¾ç‰‡ï¼›</li>
<li>é€šè¿‡ Plugin å®ç°å„ç§è‡ªåŠ¨åŒ–çš„æ„å»ºä»»åŠ¡ï¼Œä¾‹å¦‚è‡ªåŠ¨å‹ç¼©ã€è‡ªåŠ¨å‘å¸ƒã€‚</li>
</ul>
<p>å…·ä½“æ¥çœ‹æ‰“åŒ…çš„è¿‡ç¨‹ï¼ŒWebpack å¯åŠ¨åï¼Œä¼šæ ¹æ®æˆ‘ä»¬çš„é…ç½®ï¼Œæ‰¾åˆ°é¡¹ç›®ä¸­çš„æŸä¸ªæŒ‡å®šæ–‡ä»¶ï¼ˆä¸€èˆ¬è¿™ä¸ªæ–‡ä»¶éƒ½ä¼šæ˜¯ä¸€ä¸ª JS æ–‡ä»¶ï¼‰ä½œä¸ºå…¥å£ã€‚ç„¶åé¡ºç€å…¥å£æ–‡ä»¶ä¸­çš„ä»£ç ï¼Œæ ¹æ®ä»£ç ä¸­å‡ºç°çš„ importï¼ˆES Modulesï¼‰æˆ–è€…æ˜¯ requireï¼ˆCommonJSï¼‰ä¹‹ç±»çš„è¯­å¥ï¼Œè§£ææ¨æ–­å‡ºæ¥è¿™ä¸ªæ–‡ä»¶æ‰€ä¾èµ–çš„èµ„æºæ¨¡å—ï¼Œç„¶åå†åˆ†åˆ«å»è§£ææ¯ä¸ªèµ„æºæ¨¡å—çš„ä¾èµ–ï¼Œå‘¨è€Œå¤å§‹ï¼Œæœ€åå½¢æˆæ•´ä¸ªé¡¹ç›®ä¸­æ‰€æœ‰ç”¨åˆ°çš„æ–‡ä»¶ä¹‹é—´çš„ä¾èµ–å…³ç³»æ ‘ï¼Œå…·ä½“è¿‡ç¨‹å¦‚ä¸‹æ‰€ç¤ºï¼š<br />
<img src="/assets/webpack-runtime/02.gif" width="680" /></p>
<p>æœ‰äº†è¿™ä¸ªä¾èµ–å…³ç³»æ ‘è¿‡åï¼Œ Webpack ä¼šéå†ï¼ˆé€’å½’ï¼‰è¿™ä¸ªä¾èµ–æ ‘ï¼Œæ‰¾åˆ°æ¯ä¸ªèŠ‚ç‚¹å¯¹åº”çš„èµ„æºæ–‡ä»¶ï¼Œç„¶åæ ¹æ®é…ç½®é€‰é¡¹ä¸­çš„ Loader é…ç½®ï¼Œäº¤ç»™å¯¹åº”çš„ Loader å»åŠ è½½è¿™ä¸ªæ¨¡å—ï¼Œæœ€åå°†åŠ è½½çš„ç»“æœæ”¾å…¥ bundle.jsï¼ˆæ‰“åŒ…ç»“æœï¼‰ä¸­ï¼Œä»è€Œå®ç°æ•´ä¸ªé¡¹ç›®çš„æ‰“åŒ…ï¼Œå…·ä½“è¿‡ç¨‹å¦‚ä¸‹æ‰€ç¤ºï¼š<br />
<img src="/assets/webpack-runtime/03.gif" /></p>
<p>ä¸‹é¢æˆ‘ä»¬è¯¦ç»†äº†è§£ä¸€ä¸‹ Webpack çš„æ ¸å¿ƒå·¥ä½œæµç¨‹ï¼š</p>
<h2 id="loaderæœºåˆ¶"><a class="markdownIt-Anchor" href="#loaderæœºåˆ¶"></a> Loaderæœºåˆ¶</h2>
<p>loader ç”¨äºå¯¹æ¨¡å—çš„æºä»£ç è¿›è¡Œè½¬æ¢ã€‚loader å¯ä»¥ä½¿ä½ åœ¨ import æˆ–&quot;åŠ è½½&quot;æ¨¡å—æ—¶é¢„å¤„ç†æ–‡ä»¶ã€‚å› æ­¤ï¼Œloader ç±»ä¼¼äºå…¶ä»–æ„å»ºå·¥å…·ä¸­â€œä»»åŠ¡(task)â€ï¼Œå¹¶æä¾›äº†å¤„ç†å‰ç«¯æ„å»ºæ­¥éª¤çš„å¼ºå¤§æ–¹æ³•ã€‚loader å¯ä»¥å°†æ–‡ä»¶ä»ä¸åŒçš„è¯­è¨€ï¼ˆå¦‚ TypeScriptè½¬æ¢ä¸º JavaScript)ï¼Œæˆ–å°†å†…è”å›¾åƒè½¬æ¢ä¸º data URLã€‚loader ç”šè‡³å…è®¸ä½ ç›´æ¥åœ¨ JavaScript æ¨¡å—ä¸­ import CSSæ–‡ä»¶ï¼é€šä¿—ç‚¹è®²å°±æ˜¯loaderåœ¨webpackä¸­æ‹…ä»»ç¿»è¯‘å®˜çš„è§’è‰²ã€‚<br />
Webpack é…ç½®æ–‡ä»¶ä¸­å¯¹ Loader çš„é…ç½®ä¸»è¦åˆ†ä¸ºï¼šåŒ¹é…è§„åˆ™å’ŒåŒ¹é…è§„åˆ™åçš„åº”ç”¨ã€‚</p>
<h3 id="ä¸€-loaderçš„åŒ¹é…è§„åˆ™"><a class="markdownIt-Anchor" href="#ä¸€-loaderçš„åŒ¹é…è§„åˆ™"></a> ä¸€ã€loaderçš„åŒ¹é…è§„åˆ™</h3>
<p>loader çš„åŒ¹é…è§„åˆ™åŒ…æ‹¬ä¸‹é¢å‡ ç§ï¼š</p>
<ul>
<li>{ test: â€¦ } æŒ‡å®šç‰¹å®šåç¼€åæ–‡ä»¶</li>
<li>{ include: â€¦ } æŒ‡å®šç‰¹å®šçš„æ–‡ä»¶è·¯å¾„</li>
<li>{ exclude: â€¦ } æ’é™¤ç‰¹å®šçš„è·¯å¾„</li>
<li>{ and: [â€¦] } å¿…é¡»åŒ¹é…æ•°ç»„ä¸­æ‰€æœ‰æ¡ä»¶</li>
<li>{ or: [â€¦] } åŒ¹é…æ•°ç»„ä¸­ä»»æ„ä¸€ä¸ªæ¡ä»¶</li>
<li>{ not: [â€¦] } æ’é™¤åŒ¹é…æ•°ç»„ä¸­æ‰€æœ‰æ¡ä»¶</li>
</ul>
<p>ä¸Šè¿°çš„æ‰€è°“æ¡ä»¶çš„å€¼å¯ä»¥æ˜¯ï¼š</p>
<ul>
<li>å­—ç¬¦ä¸²ï¼šå¿…é¡»ä»¥æä¾›çš„å­—ç¬¦ä¸²å¼€å§‹ï¼Œæ‰€ä»¥æ˜¯å­—ç¬¦ä¸²çš„è¯ï¼Œè¿™é‡Œæˆ‘ä»¬éœ€è¦æä¾›ç»å¯¹è·¯å¾„</li>
<li>æ­£åˆ™è¡¨è¾¾å¼ï¼šè°ƒç”¨æ­£åˆ™çš„ test æ–¹æ³•æ¥åˆ¤æ–­åŒ¹é…</li>
<li>å‡½æ•°ï¼š(path) =&gt; booleanï¼Œè¿”å› true è¡¨ç¤ºåŒ¹é…</li>
<li>æ•°ç»„ï¼šè‡³å°‘åŒ…å«ä¸€ä¸ªæ¡ä»¶çš„æ•°ç»„</li>
<li>å¯¹è±¡ï¼šåŒ¹é…æ‰€æœ‰å±æ€§å€¼çš„æ¡ä»¶</li>
</ul>
<p>ä¸¾ä¸ªğŸŒ°:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">rules: [</span><br><span class="line">  &#123;</span><br><span class="line">    test: <span class="regexp">/\.jsx?/</span>, <span class="comment">// æ­£åˆ™</span></span><br><span class="line">    include: [</span><br><span class="line">      path.resolve(__dirname, <span class="string">&#x27;src&#x27;</span>), <span class="comment">// å­—ç¬¦ä¸²ï¼Œæ³¨æ„æ˜¯ç»å¯¹è·¯å¾„</span></span><br><span class="line">    ], <span class="comment">// æ•°ç»„</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    test: &#123;</span><br><span class="line">      js: <span class="regexp">/\.js/</span>,</span><br><span class="line">      jsx: <span class="regexp">/\.jsx/</span>,</span><br><span class="line">    &#125;, <span class="comment">// å¯¹è±¡ï¼Œä¸å»ºè®®ä½¿ç”¨</span></span><br><span class="line">    not: [</span><br><span class="line">      (value) =&gt; &#123; <span class="comment">/* ... */</span> <span class="keyword">return</span> <span class="literal">true</span>; &#125;, <span class="comment">// å‡½æ•°ï¼Œé€šå¸¸éœ€è¦é«˜åº¦è‡ªå®šä¹‰æ—¶æ‰ä¼šä½¿ç”¨</span></span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">],</span><br></pre></td></tr></table></figure>
<h3 id="äºŒ-loaderé…ç½®"><a class="markdownIt-Anchor" href="#äºŒ-loaderé…ç½®"></a> äºŒã€loaderé…ç½®</h3>
<p>é€šè¿‡åŒ¹é…è§„åˆ™åŒ¹é…åˆ°å¯¹åº”çš„èµ„æºåæœ€é‡è¦çš„è¿˜æ˜¯é€šè¿‡useå­—æ®µæŒ‡å®šå…·ä½“loaderçš„åº”ç”¨ï¼Œuseå­—æ®µæˆ‘ä»¬å¯ä»¥ç®€å•æŒ‡å®š loader åç§°ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šå…·ä½“é…ç½®ï¼Œä¸¾ä¸ªğŸŒ°:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">rules: [</span><br><span class="line">  &#123;</span><br><span class="line">    test: <span class="regexp">/\.less/</span>,</span><br><span class="line">    use: [</span><br><span class="line">      <span class="string">&#x27;style-loader&#x27;</span>, <span class="comment">// ç›´æ¥ä½¿ç”¨å­—ç¬¦ä¸²è¡¨ç¤º loader</span></span><br><span class="line">      &#123;</span><br><span class="line">        loader: <span class="string">&#x27;css-loader&#x27;</span>,</span><br><span class="line">        options: &#123;</span><br><span class="line">          importLoaders: <span class="number">1</span></span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;, <span class="comment">// ç”¨å¯¹è±¡è¡¨ç¤º loaderï¼Œå¯ä»¥ä¼ é€’ loader é…ç½®ç­‰</span></span><br><span class="line">      &#123;</span><br><span class="line">        loader: <span class="string">&#x27;less-loader&#x27;</span>,</span><br><span class="line">        options: &#123;</span><br><span class="line">          noIeCompat: <span class="literal">true</span></span><br><span class="line">        &#125;, <span class="comment">// ä¼ é€’ loader é…ç½®</span></span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">],</span><br></pre></td></tr></table></figure>
<p>è¿™å„¿éœ€è¦æ³¨æ„çš„å°±æ˜¯æ•°ç»„çš„è§£æé¡ºåºæ˜¯ä»å³å¾€å·¦ã€‚</p>
<h3 id="ä¸‰-å®ç°ä¸€ä¸ªloader"><a class="markdownIt-Anchor" href="#ä¸‰-å®ç°ä¸€ä¸ªloader"></a> ä¸‰ã€å®ç°ä¸€ä¸ªloader</h3>
<p>å®ç°ä¸€ä¸ª loader å¿…é¡»éµå¾ªå¦‚ä¸‹å‡†åˆ™ï¼š</p>
<ul>
<li>ç®€å•ã€Simpleã€‘loaderåªåšå•ä¸€ä»»åŠ¡ï¼Œå¤šä¸ªå•åŠŸèƒ½loader &gt; ä¸€ä¸ªå¤šåŠŸèƒ½loader</li>
<li>é“¾å¼ã€Chainingã€‘éµå¾ªé“¾å¼è°ƒç”¨åŸåˆ™</li>
<li>æ— çŠ¶æ€ã€Statelessã€‘å³å‡½æ•°å¼é‡Œçš„Pure Functionï¼Œæ— å‰¯ä½œç”¨</li>
<li>ä½¿ç”¨å·¥å…·åº“ã€Loader Utilitiesã€‘å……åˆ†åˆ©ç”¨ loader-utils åŒ…</li>
</ul>
<p>æ¯ä¸ª Webpack çš„ Loader éƒ½éœ€è¦å¯¼å‡ºä¸€ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°å°±æ˜¯æˆ‘ä»¬è¿™ä¸ª Loader å¯¹èµ„æºçš„å¤„ç†è¿‡ç¨‹ï¼Œå®ƒçš„è¾“å…¥å°±æ˜¯åŠ è½½åˆ°çš„èµ„æºæ–‡ä»¶å†…å®¹ï¼Œè¾“å‡ºå°±æ˜¯æˆ‘ä»¬åŠ å·¥åçš„ç»“æœã€‚æˆ‘ä»¬é€šè¿‡ source å‚æ•°æ¥æ”¶è¾“å…¥ï¼Œé€šè¿‡è¿”å›å€¼è¾“å‡ºã€‚loader åˆ†ä¸ºåŒæ­¥ loader å’Œ å¼‚æ­¥ loaderï¼Œå› ä¸ºå…¶æœ¬è´¨æ˜¯ä¸€ä¸ªå‡½æ•°ã€‚æ‰€ä»¥è¿™ä¸¤ç§ loader çš„åŒºåˆ«ï¼Œå¯ä»¥ç†è§£ä¸ºåªæ˜¯è¿”å›å€¼ä¸åŒï¼ˆåªæ˜¯ä¸ºäº†æ–¹ä¾¿ç†è§£çš„ç±»æ¯”ï¼‰ã€‚</p>
<h4 id="1-åŒæ­¥loader"><a class="markdownIt-Anchor" href="#1-åŒæ­¥loader"></a> 1ã€åŒæ­¥loader</h4>
<p>åŒæ­¥ loader æ¯”è¾ƒç®€å•ï¼Œæ— è®ºæ˜¯ return è¿˜æ˜¯è°ƒç”¨ this.callback éƒ½å¯ä»¥åŒæ­¥åœ°è¿”å›è½¬æ¢åçš„ content å†…å®¹ï¼Œä¸è¿‡ this.callback çš„å‡½æ•°å‚æ•°ç±»å‹æ›´ä¸ºä¸°å¯Œï¼š</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">this</span>.callback(</span><br><span class="line">  err: <span class="built_in">Error</span> | <span class="literal">null</span>,</span><br><span class="line">  content: <span class="built_in">string</span> | Buffer,</span><br><span class="line">  sourceMap?: SourceMap,</span><br><span class="line">  meta?: <span class="built_in">any</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>ä¸¾ä¸ªğŸŒ°:</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** webpack.config.js */</span>  </span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);  </span><br><span class="line">  </span><br><span class="line"><span class="built_in">module</span>.exports = &#123;  </span><br><span class="line">  entry: &#123;  </span><br><span class="line">    index: path.resolve(__dirname, <span class="string">&quot;src/index.js&quot;</span>),  </span><br><span class="line">  &#125;,  </span><br><span class="line">  output: &#123;  </span><br><span class="line">    path: path.resolve(__dirname, <span class="string">&quot;dist&quot;</span>),  </span><br><span class="line">  &#125;,  </span><br><span class="line">  <span class="built_in">module</span>: &#123;  </span><br><span class="line">    rules: [  </span><br><span class="line">      &#123;  </span><br><span class="line">        test: <span class="regexp">/\.js$/</span>,  </span><br><span class="line">        use: [  </span><br><span class="line">          &#123;  </span><br><span class="line">            loader: path.resolve(<span class="string">&quot;lib/loader/loader1.js&quot;</span>),  </span><br><span class="line">            options: &#123;  </span><br><span class="line">              message: <span class="string">&quot;this is a message&quot;</span>,  </span><br><span class="line">            &#125;  </span><br><span class="line">          &#125;  </span><br><span class="line">        ],  </span><br><span class="line">      &#125;,  </span><br><span class="line">    ],  </span><br><span class="line">  &#125;,  </span><br><span class="line">&#125;; </span><br><span class="line"></span><br><span class="line"><span class="comment">/** lib/loader/loader1.js */</span>  </span><br><span class="line"><span class="keyword">const</span> loaderUtils = <span class="built_in">require</span>(<span class="string">&#x27;loader-utils&#x27;</span>);  </span><br><span class="line">  </span><br><span class="line"><span class="comment">/** è¿‡æ»¤console.logå’Œæ¢è¡Œç¬¦ */</span>  </span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> (<span class="params">source</span>) </span>&#123;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// è·å–loaderé…ç½®é¡¹  </span></span><br><span class="line">  <span class="keyword">const</span> options = loaderUtils.getOptions(<span class="built_in">this</span>);  <span class="comment">// æ­¤å¤„ä¹Ÿå¯é€šè¿‡this.queryè·å–optionsä¿¡æ¯</span></span><br><span class="line">  </span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;loaderé…ç½®é¡¹:&#x27;</span>, options);  </span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> result = source  </span><br><span class="line">    .replace(<span class="regexp">/console.log\(.*\);?/g</span>, <span class="string">&quot;&quot;</span>)  </span><br><span class="line">    .replace(<span class="regexp">/\n/g</span>, <span class="string">&quot;&quot;</span>)  </span><br><span class="line">    .concat(<span class="string">`console.log(&quot;<span class="subst">$&#123;options.message || <span class="string">&#x27;æ²¡æœ‰é…ç½®é¡¹&#x27;</span>&#125;</span>&quot;);`</span>);  </span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">  <span class="comment">// æˆ–this.callback(null, source);</span></span><br><span class="line">&#125;;  </span><br></pre></td></tr></table></figure>
<p>åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­æˆ‘ä»¬å®ç°äº†ä¸€ä¸ªç®€å•çš„ loader ï¼ŒåŠŸèƒ½æ˜¯æ›¿æ¢<code>console.log</code>ã€å»é™¤æ¢è¡Œç¬¦ã€åœ¨æ–‡ä»¶ç»“å°¾å¤„å¢åŠ ä¸€è¡Œè‡ªå®šä¹‰å†…å®¹ï¼Œåœ¨ç¤ºä¾‹ä¸­æˆ‘ä»¬é€šè¿‡ loader-utils åŒ…æ¥è·å–é…ç½®å‚æ•°ï¼Œå®é™…ä¸Šæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ Webpack æä¾›çš„ <code>this.query</code> å‚æ•°æ¥è·å– loader é…ç½®ä¸­çš„ options å‚æ•°ã€‚</p>
<h4 id="2-å¼‚æ­¥loader"><a class="markdownIt-Anchor" href="#2-å¼‚æ­¥loader"></a> 2ã€å¼‚æ­¥loader</h4>
<p>å¼‚æ­¥loaderåªæœ‰ä¸€ç§å¤„ç†æ–¹å¼ã€‚å¯¹äºå¼‚æ­¥ loaderï¼Œä½¿ç”¨ this.async æ¥è·å– callback å‡½æ•°ã€‚è¿™é‡Œçš„ callback å‡½æ•°ï¼Œå’ŒåŒæ­¥ loader é‡Œé¢ this.callback çš„å‚æ•°æ˜¯ä¸€æ ·çš„ï¼Œä¸¾ä¸ªğŸŒ°:</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> (<span class="params">source</span>) </span>&#123;  </span><br><span class="line">  </span><br><span class="line">  <span class="keyword">let</span> count = <span class="number">1</span>;  </span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 1.è°ƒç”¨this.async() å‘Šè¯‰webpackè¿™æ˜¯ä¸€ä¸ªå¼‚æ­¥loaderï¼Œéœ€è¦ç­‰å¾… callback å›è°ƒä¹‹åå†è¿›è¡Œä¸‹ä¸€ä¸ªloaderå¤„ç†  </span></span><br><span class="line">  <span class="comment">// 2.this.async è¿”å›å¼‚æ­¥å›è°ƒï¼Œè°ƒç”¨è¡¨ç¤ºå¼‚æ­¥loaderå¤„ç†ç»“æŸ  </span></span><br><span class="line">  <span class="keyword">const</span> callback = <span class="built_in">this</span>.async();  </span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> timer = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;  </span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`æ—¶é—´å·²ç»è¿‡å»<span class="subst">$&#123;count++&#125;</span>ç§’`</span>);  </span><br><span class="line">  &#125;, <span class="number">1000</span>);  </span><br><span class="line">  </span><br><span class="line">  <span class="comment">// å¼‚æ­¥æ“ä½œ  </span></span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;  </span><br><span class="line">    <span class="built_in">clearInterval</span>(timer);  </span><br><span class="line">    callback(<span class="literal">null</span>, source);  </span><br><span class="line">  &#125;, <span class="number">3200</span>);  </span><br><span class="line">  </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>æ­¤å¤„éœ€è¦æ³¨æ„çš„æ˜¯è™½ç„¶ Webpack åŠ è½½èµ„æºæ–‡ä»¶çš„è¿‡ç¨‹ç±»ä¼¼äºä¸€ä¸ªå·¥ä½œç®¡é“ï¼Œä½ å¯ä»¥åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ä¾æ¬¡ä½¿ç”¨å¤šä¸ª Loaderï¼Œä½†æ˜¯æœ€ç»ˆè¿™ä¸ªç®¡é“ç»“æŸè¿‡åçš„ç»“æœå¿…é¡»æ˜¯ä¸€æ®µæ ‡å‡†çš„ JS ä»£ç å­—ç¬¦ä¸²ï¼Œå¦‚æœå½“å‰ loader è¿”å›çš„ç»“æœä¸æ˜¯ JS ä»£ç å­—ç¬¦ä¸²ï¼Œæˆ‘ä»¬å¯ä»¥å†é€‰æ‹©åˆé€‚çš„åŠ è½½å™¨ï¼Œåœ¨åé¢æ¥ç€å¤„ç†æˆ‘ä»¬è¿™é‡Œå¾—åˆ°çš„ç»“æœï¼Œä¸¾ä¸ªğŸŒ°:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./markdown-loader.js</span></span><br><span class="line"><span class="keyword">const</span> marked = <span class="built_in">require</span>(<span class="string">&#x27;marked&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="params">source</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 1. å°† markdown è½¬æ¢ä¸º html å­—ç¬¦ä¸²</span></span><br><span class="line">  <span class="keyword">const</span> html = marked(source)</span><br><span class="line">  <span class="keyword">return</span> html</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ./webpack.config.js</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: <span class="string">&#x27;./src/main.js&#x27;</span>,</span><br><span class="line">  output: &#123;</span><br><span class="line">    filename: <span class="string">&#x27;bundle.js&#x27;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.md$/</span>,</span><br><span class="line">        use: [</span><br><span class="line">          <span class="string">&#x27;html-loader&#x27;</span>,</span><br><span class="line">          <span class="string">&#x27;./markdown-loader&#x27;</span></span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="pluginæœºåˆ¶"><a class="markdownIt-Anchor" href="#pluginæœºåˆ¶"></a> Pluginæœºåˆ¶</h2>
<p>Webpack æ’ä»¶æœºåˆ¶çš„ç›®çš„æ˜¯ä¸ºäº†å¢å¼º Webpack åœ¨é¡¹ç›®è‡ªåŠ¨åŒ–æ„å»ºæ–¹é¢çš„èƒ½åŠ›ï¼ŒLoader ä¸»è¦è´Ÿè´£å®Œæˆé¡¹ç›®ä¸­å„ç§å„æ ·èµ„æºæ¨¡å—çš„åŠ è½½ï¼Œä»è€Œå®ç°æ•´ä½“é¡¹ç›®çš„æ¨¡å—åŒ–ï¼Œè€Œ Plugin åˆ™æ˜¯ç”¨æ¥è§£å†³é¡¹ç›®ä¸­é™¤äº†èµ„æºæ¨¡å—æ‰“åŒ…ä»¥å¤–çš„å…¶ä»–è‡ªåŠ¨åŒ–å·¥ä½œï¼Œæ‰€ä»¥è¯´ Plugin çš„èƒ½åŠ›èŒƒå›´æ›´å¹¿ï¼Œç”¨é€”è‡ªç„¶ä¹Ÿå°±æ›´å¤šã€‚<br />
Webpack çš„æ’ä»¶å¼•å…¥æä¸ºç®€å•ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œå½“æˆ‘ä»¬æœ‰äº†æŸä¸ªè‡ªåŠ¨åŒ–çš„éœ€æ±‚è¿‡åï¼Œå¯ä»¥å…ˆå»æ‰¾åˆ°ä¸€ä¸ªåˆé€‚çš„æ’ä»¶ï¼Œç„¶åå®‰è£…è¿™ä¸ªæ’ä»¶ï¼Œæœ€åå°†å®ƒé…ç½®åˆ° Webpack é…ç½®å¯¹è±¡çš„ plugins æ•°ç»„ä¸­ï¼Œè¿™ä¸ªè¿‡ç¨‹å”¯ä¸€æœ‰å¯èƒ½ä¸ä¸€æ ·çš„åœ°æ–¹å°±æ˜¯ï¼Œæœ‰çš„æ’ä»¶å¯èƒ½éœ€è¦æœ‰ä¸€äº›é…ç½®å‚æ•°ã€‚</p>
<h3 id="ä¸€-å®ç°ä¸€ä¸ªplugin"><a class="markdownIt-Anchor" href="#ä¸€-å®ç°ä¸€ä¸ªplugin"></a> ä¸€ã€å®ç°ä¸€ä¸ªplugin</h3>
<p>é€šè¿‡å‰é¢çš„ä»‹ç»ï¼Œæˆ‘ä»¬çŸ¥é“ç›¸æ¯”äº Loaderï¼Œæ’ä»¶çš„èƒ½åŠ›èŒƒå›´æ›´å®½ï¼Œå› ä¸º Loader åªæ˜¯åœ¨æ¨¡å—çš„åŠ è½½ç¯èŠ‚å·¥ä½œï¼Œè€Œæ’ä»¶çš„ä½œç”¨èŒƒå›´å‡ ä¹å¯ä»¥è§¦åŠ Webpack å·¥ä½œçš„æ¯ä¸€ä¸ªç¯èŠ‚ã€‚<br />
é‚£ä¹ˆï¼Œè¿™ç§æ’ä»¶æœºåˆ¶æ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼Ÿå…¶å® Webpack çš„æ’ä»¶æœºåˆ¶å°±æ˜¯æˆ‘ä»¬åœ¨è½¯ä»¶å¼€å‘ä¸­æœ€å¸¸è§çš„é’©å­æœºåˆ¶ï¼ŒWebpack é’©å­æœºåˆ¶çš„å®ç°ä¸»è¦é€šè¿‡ç¬¬ä¸‰æ–¹åº“ï¼šTapableï¼ŒTapable æ˜¯ä¸€ä¸ªç±»ä¼¼äº Node.js çš„ EventEmitter çš„åº“ï¼Œä¸»è¦æ˜¯æ§åˆ¶é’©å­å‡½æ•°çš„å‘å¸ƒä¸è®¢é˜…ï¼ŒTapable åº“ä¸ºæ’ä»¶æä¾›äº†å¾ˆå¤š Hook ä»¥ä¾¿æŒ‚è½½ï¼š</p>
<ul>
<li>SyncHookï¼šåŒæ­¥é’©å­</li>
<li>SyncBailHookï¼šåŒæ­¥ç†”æ–­é’©å­</li>
<li>WaterfallHookï¼šåŒæ­¥æµæ°´é’©å­</li>
<li>LoopHookï¼šåŒæ­¥å¾ªç¯é’©å­</li>
<li>cParalleHookï¼šå¼‚æ­¥å¹¶å‘é’©å­</li>
<li>cRarallelBailHookï¼šå¼‚æ­¥å¹¶å‘ç†”æ–­é’©å­</li>
<li>cSeriesHookï¼šå¼‚æ­¥ä¸²è¡Œé’©å­</li>
<li>cSeriesBailHookï¼šå¼‚æ­¥ä¸²è¡Œç†”æ–­é’©å­</li>
<li>cSeriesWaterfallHookï¼šå¼‚æ­¥ä¸²è¡Œæµæ°´é’©å­</li>
</ul>
<p>å…³äº Tapable è¯¦ç»†ä¿¡æ¯è¯·æŸ¥çœ‹<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/79221553">è¿™ç¯‡æ–‡ç« </a>ã€‚</p>
<p>Webpack ä¸­ Compiler å’Œ Compilation å¯¹è±¡(Compiler å¯¹è±¡æ˜¯ Webpack å·¥ä½œè¿‡ç¨‹ä¸­æœ€æ ¸å¿ƒçš„å¯¹è±¡ï¼Œé‡Œé¢åŒ…å«äº†æ„å»ºè¿‡ç¨‹çš„æ‰€æœ‰é…ç½®ä¿¡æ¯ï¼ŒCompilation å¯¹è±¡å¯ä»¥ç†è§£ä¸ºæ­¤æ¬¡æ‰“åŒ…çš„ä¸Šä¸‹æ–‡)éƒ½ç»§æ‰¿äº Tapableï¼Œä¸ºäº†ä¾¿äºæ’ä»¶çš„æ‰©å±•ï¼ŒWebpack å‡ ä¹åœ¨æ¯ä¸€ä¸ªç¯èŠ‚éƒ½åŸ‹ä¸‹äº†ä¸€ä¸ªé’©å­ã€‚è¿™æ ·æˆ‘ä»¬åœ¨å¼€å‘æ’ä»¶çš„æ—¶å€™ï¼Œé€šè¿‡å¾€è¿™äº›ä¸åŒèŠ‚ç‚¹ä¸ŠæŒ‚è½½ä¸åŒçš„ä»»åŠ¡ï¼Œå°±å¯ä»¥è½»æ¾æ‰©å±• Webpack çš„èƒ½åŠ›ã€‚<br />
å…·ä½“æœ‰å“ªäº›é¢„å…ˆå®šä¹‰å¥½çš„é’©å­ï¼Œæˆ‘ä»¬å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£çš„ APIï¼š</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://webpack.js.org/api/compiler-hooks/">Compiler Hooks</a></li>
<li><a target="_blank" rel="noopener" href="https://webpack.js.org/api/compilation-hooks/">Compilation Hooks</a></li>
<li><a target="_blank" rel="noopener" href="https://webpack.js.org/api/parser/">JavascriptParser Hooks</a></li>
</ul>
<p>plugin çš„å®ç°è¦ç‚¹å¦‚ä¸‹ï¼š</p>
<ul>
<li>ä¸€ä¸ªå‘½åJSå‡½æ•°æˆ–è€…JSç±»</li>
<li>åœ¨ prototype ä¸Šå®šä¹‰ä¸€ä¸ª apply æ–¹æ³•ï¼ˆä¾›webpackè°ƒç”¨ï¼Œå¹¶ä¸”åœ¨è°ƒç”¨æ—¶æ³¨å…¥ compiler å¯¹è±¡ï¼‰</li>
<li>åœ¨ apply å‡½æ•°ä¸­éœ€è¦æœ‰é€šè¿‡ compiler å¯¹è±¡æŒ‚è½½çš„ webpack äº‹ä»¶é’©å­ï¼ˆé’©å­å‡½æ•°ä¸­èƒ½æ‹¿åˆ°å½“å‰ç¼–è¯‘çš„ compilation å¯¹è±¡ï¼‰</li>
<li>å¤„ç† webpack å†…éƒ¨å®ä¾‹çš„ç‰¹å®šæ•°æ®</li>
<li>åŠŸèƒ½å®Œæˆåè°ƒç”¨ webpack æä¾›çš„å›è°ƒ</li>
</ul>
<p>ä¸¾ä¸ªğŸŒ°:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ’ä»¶åŠŸèƒ½ï¼šç§»é™¤æ‰“åŒ…æ–‡ä»¶ä¸­çš„æ³¨é‡Šä¿¡æ¯</span></span><br><span class="line"><span class="comment">// ./remove-comments-plugin.js</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RemoveCommentsPlugin</span> </span>&#123;</span><br><span class="line">  apply (compiler) &#123;</span><br><span class="line">    compiler.hooks.emit.tap(<span class="string">&#x27;RemoveCommentsPlugin&#x27;</span>, <span class="function"><span class="params">compilation</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">const</span> name <span class="keyword">in</span> compilation.assets) &#123;</span><br><span class="line">        <span class="keyword">if</span> (name.endsWith(<span class="string">&#x27;.js&#x27;</span>)) &#123;</span><br><span class="line">          <span class="keyword">const</span> contents = compilation.assets[name].source()</span><br><span class="line">          <span class="keyword">const</span> noComments = contents.replace(<span class="regexp">/\/\*&#123;2,&#125;\/\s?/g</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">          compilation.assets[name] = &#123;</span><br><span class="line">            source: <span class="function">() =&gt;</span> noComments,</span><br><span class="line">            size: <span class="function">() =&gt;</span> noComments.length</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­æˆ‘ä»¬é€‰æ‹©äº†ä¸€ä¸ªå«ä½œ emit çš„é’©å­ï¼Œè¿™ä¸ªé’©å­ä¼šåœ¨ Webpack å³å°†å‘è¾“å‡ºç›®å½•è¾“å‡ºæ–‡ä»¶æ—¶æ‰§è¡Œï¼Œç„¶åé€šè¿‡ compiler å¯¹è±¡çš„ hooks å±æ€§è®¿é—®åˆ° emit é’©å­ï¼Œå†é€šè¿‡ tap æ–¹æ³•æ³¨å†Œä¸€ä¸ªé’©å­å‡½æ•°ï¼Œè¿™ä¸ªæ–¹æ³•æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼š</p>
<ul>
<li>ç¬¬ä¸€ä¸ªæ˜¯æ’ä»¶çš„åç§°ï¼Œæˆ‘ä»¬è¿™é‡Œçš„æ’ä»¶åç§°æ˜¯ RemoveCommentsPluginï¼›</li>
<li>ç¬¬äºŒä¸ªæ˜¯è¦æŒ‚è½½åˆ°è¿™ä¸ªé’©å­ä¸Šçš„å‡½æ•°ï¼›</li>
</ul>
<p>ç„¶åæˆ‘ä»¬åœ¨è¿™ä¸ªå‡½æ•°ä¸­æ¥æ”¶ä¸€ä¸ª compilation å¯¹è±¡å‚æ•°å¹¶ä½¿ç”¨å¯¹è±¡ä¸­çš„ assets å±æ€§è·å–å³å°†å†™å…¥è¾“å‡ºç›®å½•çš„èµ„æºæ–‡ä»¶ä¿¡æ¯ï¼Œå®ƒæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæˆ‘ä»¬è¿™é‡Œé€šè¿‡ for in å»éå†è¿™ä¸ªå¯¹è±¡ï¼Œå…¶ä¸­é”®å°±æ˜¯æ¯ä¸ªæ–‡ä»¶çš„åç§°ï¼Œç„¶åæˆ‘ä»¬åˆ¤æ–­æ–‡ä»¶åæ˜¯ä¸æ˜¯ä»¥<code>.js</code>ç»“å°¾ï¼Œå¦‚æœæ˜¯ JS æ–‡ä»¶ï¼Œæˆ‘ä»¬å°†æ–‡ä»¶å†…å®¹å¾—åˆ°ï¼Œå†é€šè¿‡æ­£åˆ™æ›¿æ¢çš„æ–¹å¼ç§»é™¤æ‰ä»£ç ä¸­çš„æ³¨é‡Šï¼Œæœ€åè¦†ç›–æ‰ compilation.assets ä¸­å¯¹åº”çš„å¯¹è±¡ï¼Œåœ¨è¦†ç›–çš„å¯¹è±¡ä¸­ï¼Œæˆ‘ä»¬åŒæ ·æš´éœ²ä¸€ä¸ª source æ–¹æ³•ç”¨æ¥è¿”å›æ–°çš„å†…å®¹ã€‚å¦å¤–è¿˜éœ€è¦å†æš´éœ²ä¸€ä¸ª size æ–¹æ³•ï¼Œç”¨æ¥è¿”å›å†…å®¹å¤§å°ï¼Œè¿™æ˜¯ Webpack å†…éƒ¨è¦æ±‚çš„æ ¼å¼ï¼Œ<br />
tap æ˜¯ Tapable æä¾›çš„åŒæ­¥é’©å­çš„æ³¨å†Œæ–¹æ³•ï¼Œå¦‚æœæ˜¯å¼‚æ­¥é’©å­åˆ™å¿…é¡»æ‰§è¡Œå¼‚æ­¥å›è°ƒï¼Œä¸¾ä¸ªğŸŒ°:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1ã€Pluginåç§°  </span></span><br><span class="line"><span class="keyword">const</span> MY_PLUGIN_NAME = <span class="string">&quot;MyBasicPlugin&quot;</span>;  </span><br><span class="line">  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyBasicPlugin</span> </span>&#123;  </span><br><span class="line">  <span class="comment">// 2ã€åœ¨æ„é€ å‡½æ•°ä¸­è·å–æ’ä»¶é…ç½®é¡¹  </span></span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">option</span>)</span> &#123;  </span><br><span class="line">    <span class="built_in">this</span>.option = option;  </span><br><span class="line">  &#125;  </span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 3ã€åœ¨åŸå‹å¯¹è±¡ä¸Šå®šä¹‰ä¸€ä¸ªapplyå‡½æ•°ä¾›webpackè°ƒç”¨  </span></span><br><span class="line">  <span class="function"><span class="title">apply</span>(<span class="params">compiler</span>)</span> &#123;  </span><br><span class="line">    <span class="comment">// 4ã€æ³¨å†Œwebpackäº‹ä»¶ç›‘å¬å‡½æ•°  </span></span><br><span class="line">    compiler.hooks.emit.tapAsync(  </span><br><span class="line">      MY_PLUGIN_NAME,  </span><br><span class="line">      (compilation, asyncCallback) =&gt; &#123; </span><br><span class="line"></span><br><span class="line">        <span class="comment">// 5ã€æ“ä½œOræ”¹å˜compilationå†…éƒ¨æ•°æ®  </span></span><br><span class="line">        <span class="built_in">console</span>.log(compilation);        </span><br><span class="line">  </span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;å½“å‰é˜¶æ®µ ======&gt; ç¼–è¯‘å®Œæˆï¼Œå³å°†è¾“å‡ºåˆ°outputç›®å½•&quot;</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="comment">// 6ã€å¦‚æœæ˜¯å¼‚æ­¥é’©å­ï¼Œç»“æŸåéœ€è¦æ‰§è¡Œå¼‚æ­¥å›è°ƒ  </span></span><br><span class="line">        asyncCallback();  </span><br><span class="line">      &#125;  </span><br><span class="line">    );  </span><br><span class="line">  &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="comment">// 7ã€æ¨¡å—å¯¼å‡º  </span></span><br><span class="line"><span class="built_in">module</span>.exports = MyBasicPlugin; </span><br></pre></td></tr></table></figure>
<h2 id="webpackæ‰“åŒ…æµç¨‹"><a class="markdownIt-Anchor" href="#webpackæ‰“åŒ…æµç¨‹"></a> Webpackæ‰“åŒ…æµç¨‹</h2>
<p>ï¼ˆæ³¨ï¼šæ–‡ç« ä¸­æºç éƒ¨åˆ†åˆ†åˆ«æ¥è‡ªäº v3.3.11 ç‰ˆæœ¬çš„ webpack-cli å’Œ v4.43.0 ç‰ˆæœ¬çš„ Webpackï¼‰</p>
<h3 id="ä¸€-åˆå§‹åŒ–å¯åŠ¨"><a class="markdownIt-Anchor" href="#ä¸€-åˆå§‹åŒ–å¯åŠ¨"></a> ä¸€ã€åˆå§‹åŒ–å¯åŠ¨</h3>
<p>å½“é€šè¿‡å‘½ä»¤è¡Œå¯åŠ¨ Webpack åï¼Œnpmä¼šè®©å‘½ä»¤è¡Œå·¥å…·è¿›å…¥node_modules.binç›®å½•ï¼Œç„¶åæ‰§è¡Œç›®å½•ä¸‹çš„ webpack.jsæ–‡ä»¶ï¼Œæ–‡ä»¶å†…çš„æ ¸å¿ƒå†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// node_modules/webpack/bin/webpack.js</span></span><br><span class="line"><span class="comment">// æ­£å¸¸æ‰§è¡Œè¿”å›</span></span><br><span class="line">process.exitCode = <span class="number">0</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é€šè¿‡ child_process å¿«é€Ÿçš„è¿è¡ŒæŸä¸ªå‘½ä»¤</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;string&#125;</span> </span>command process to run</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;string[]&#125;</span> </span>args commandline arguments</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns <span class="type">&#123;Promise&lt;void&gt;&#125;</span> <span class="variable">promise</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> runCommand = <span class="function">(<span class="params">command, args</span>) =&gt;</span> &#123;...&#125;;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é€šè¿‡require.resolveåˆ¤æ–­æŸä¸€ä¸ªåŒ…æ˜¯å¦å­˜åœ¨</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;string&#125;</span> </span>packageName name of the package</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns <span class="type">&#123;boolean&#125;</span> </span>is the package installed?</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> isInstalled = <span class="function"><span class="params">packageName</span> =&gt;</span> &#123;...&#125;;</span><br><span class="line"><span class="comment">// wecpackå¯ç”¨çš„CLIï¼šwebpaclk-cliå’Œwebpack-command</span></span><br><span class="line"><span class="keyword">const</span> CLIs = [</span><br><span class="line">  &#123;</span><br><span class="line">    name: <span class="string">&quot;webpack-cli&quot;</span>,</span><br><span class="line">    package: <span class="string">&quot;webpack-cli&quot;</span>,</span><br><span class="line">    binName: <span class="string">&quot;webpack-cli&quot;</span>,</span><br><span class="line">    alias: <span class="string">&quot;cli&quot;</span>,</span><br><span class="line">    installed: isInstalled(<span class="string">&quot;webpack-cli&quot;</span>),</span><br><span class="line">    recommended: <span class="literal">true</span>,</span><br><span class="line">    url: <span class="string">&quot;https://github.com/webpack/webpack-cli&quot;</span>,</span><br><span class="line">    description: <span class="string">&quot;The original webpack full-featured CLI.&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    name: <span class="string">&quot;webpack-command&quot;</span>,</span><br><span class="line">    package: <span class="string">&quot;webpack-command&quot;</span>,</span><br><span class="line">    binName: <span class="string">&quot;webpack-command&quot;</span>,</span><br><span class="line">    alias: <span class="string">&quot;command&quot;</span>,</span><br><span class="line">    installed: isInstalled(<span class="string">&quot;webpack-command&quot;</span>),</span><br><span class="line">    recommended: <span class="literal">false</span>,</span><br><span class="line">    url: <span class="string">&quot;https://github.com/webpack-contrib/webpack-command&quot;</span>,</span><br><span class="line">    description: <span class="string">&quot;A lightweight, opinionated webpack CLI.&quot;</span>,</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br><span class="line"><span class="comment">// åˆ¤æ–­æ˜¯å¦ä¸¤ä¸ªCLIæ˜¯å¦å®‰è£…äº†</span></span><br><span class="line"><span class="keyword">const</span> installedClis = CLIs.filter(<span class="function"><span class="params">cli</span>=&gt;</span>cli.installed);</span><br><span class="line"><span class="comment">// æ ¹æ®å®‰è£…æ•°é‡è¿›è¡Œå¤„ç†</span></span><br><span class="line"><span class="keyword">if</span> (installedClis.length === <span class="number">0</span>) &#123;</span><br><span class="line">  <span class="comment">// ç»ˆç«¯è¯¢é—®ç”¨æˆ·æ˜¯å¦å®‰è£… webpack-cli</span></span><br><span class="line">  ...</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (installedClis.length === <span class="number">1</span>) &#123;</span><br><span class="line">  <span class="comment">// ç›´æ¥é€šè¿‡requireæ–¹æ³•è°ƒç”¨å·²å®‰è£… CLI</span></span><br><span class="line">  ...</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="comment">// ç»ˆç«¯æç¤ºå®‰è£…äº†ä¸¤ä¸ªCLIï¼Œåªèƒ½ä½¿ç”¨ä¸€ä¸ªï¼Œè¯·ç§»é™¤å¦ä¸€ä¸ª</span></span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™å„¿çš„ node_modules/.bin/webpack.js å®é™…ä¸Šå°±æ˜¯ Webpack æ‰“åŒ…æµç¨‹çš„å…¥å£æ–‡ä»¶ï¼Œå¯åŠ¨å Webpack ä¼šåˆ¤æ–­æ˜¯å¦å®‰è£…äº†å¯ç”¨çš„CLI: webpack-cli æˆ– webpack-commandï¼ˆwebpack-cliåŠŸèƒ½æ›´åŠ ä¸°å¯Œï¼‰ï¼Œå¹¶æ ¹æ®å®‰è£…æ•°é‡è¿›è¡Œç›¸åº”çš„å¤„ç†ï¼Œæœ€ç»ˆ webpack ä¼šæ‰¾åˆ° webpack-cli(webpack-command) è¿™ä¸ª npm åŒ…å¹¶ä¸”æ‰§è¡Œ CLIã€‚</p>
<h3 id="äºŒ-webpack-cli"><a class="markdownIt-Anchor" href="#äºŒ-webpack-cli"></a> äºŒã€webpack-cli</h3>
<p>ä» Webpack 4 å¼€å§‹ Webpack çš„ CLI éƒ¨åˆ†å°±è¢«å•ç‹¬æŠ½åˆ°äº† webpack-cli æ¨¡å—ä¸­ï¼Œç›®çš„æ˜¯ä¸ºäº†å¢å¼º Webpack æœ¬èº«çš„çµæ´»æ€§ï¼ŒWebpack CLI çš„ä½œç”¨å°±æ˜¯å°† CLI å‚æ•°å’Œ Webpack é…ç½®æ–‡ä»¶ä¸­çš„é…ç½®æ•´åˆï¼Œå¾—åˆ°ä¸€ä¸ªå®Œæ•´çš„é…ç½®å¯¹è±¡ã€‚é‚£ä¹ˆ webpack-cli ä¸­åˆåšäº†å“ªäº›æ“ä½œå‘¢ï¼Ÿ</p>
<p>é¦–å…ˆï¼Œwebpack-cli ä¼šå¤„ç†ä¸éœ€è¦ç»è¿‡ç¼–è¯‘çš„å‘½ä»¤ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// node_modules/webpack-cli/bin/cli.js</span></span><br><span class="line"><span class="keyword">const</span> NON_COMPILATION_ARGS = [</span><br><span class="line">  <span class="string">&quot;init&quot;</span>,</span><br><span class="line">  <span class="string">&quot;migrate&quot;</span>,</span><br><span class="line">  <span class="string">&quot;add&quot;</span>,</span><br><span class="line">  <span class="string">&quot;remove&quot;</span>,</span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">  &quot;update&quot;,</span></span><br><span class="line"><span class="comment">  &quot;make&quot;,</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="string">&quot;serve&quot;</span>,</span><br><span class="line">  <span class="string">&quot;generate-loader&quot;</span>,</span><br><span class="line">  <span class="string">&quot;generate-plugin&quot;</span>,</span><br><span class="line">  <span class="string">&quot;info&quot;</span></span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> NON_COMPILATION_CMD = process.argv.find(<span class="function"><span class="params">arg</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (arg === <span class="string">&quot;serve&quot;</span>) &#123;</span><br><span class="line">    <span class="built_in">global</span>.process.argv = <span class="built_in">global</span>.process.argv.filter(<span class="function"><span class="params">a</span> =&gt;</span> a !== <span class="string">&quot;serve&quot;</span>);</span><br><span class="line">    process.argv = <span class="built_in">global</span>.process.argv;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> NON_COMPILATION_ARGS.find(<span class="function"><span class="params">a</span> =&gt;</span> a === arg);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (NON_COMPILATION_CMD) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">require</span>(<span class="string">&quot;./prompt-command&quot;</span>)(NON_COMPILATION_CMD, ...process.argv);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç„¶å Webpack CLI ä¼šé€šè¿‡ yargs æ¨¡å—è§£æ CLI å‚æ•°ï¼Œæ‰€è°“ CLI å‚æ•°æŒ‡çš„å°±æ˜¯æˆ‘ä»¬åœ¨è¿è¡Œ webpack å‘½ä»¤æ—¶é€šè¿‡å‘½ä»¤è¡Œä¼ å…¥çš„å‚æ•°ï¼Œä¾‹å¦‚ --mode=productionï¼Œå…·ä½“å®ç°ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// yargs will terminate the process early when the user uses help or version.</span></span><br><span class="line"><span class="comment">// This causes large help outputs to be cut short (https://github.com/nodejs/node/wiki/API-changes-between-v0.10-and-v4#process).</span></span><br><span class="line"><span class="comment">// To prevent this we use the yargs.parse API and exit the process normally</span></span><br><span class="line">yargs.parse(process.argv.slice(<span class="number">2</span>), <span class="function">(<span class="params">err, argv, output</span>) =&gt;</span> &#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="keyword">let</span> options;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="comment">// è½¬æ¢å‘½ä»¤è¡Œå‚æ•°</span></span><br><span class="line">      options = <span class="built_in">require</span>(<span class="string">&quot;./convert-argv&quot;</span>)(argv);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">      ...</span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å‘ç°åœ¨ yargs.parse çš„å›è°ƒå‡½æ•°ä¸­è¿˜è°ƒç”¨äº† bin/utils/convert-argv.js æ¨¡å—ï¼Œå°†å¾—åˆ°çš„å‘½ä»¤è¡Œå‚æ•°è½¬æ¢ä¸º Webpack çš„é…ç½®é€‰é¡¹å¯¹è±¡ï¼Œåœ¨ convert-argv.js å·¥ä½œè¿‡ç¨‹ä¸­ï¼Œé¦–å…ˆä¸ºä¼ é€’è¿‡æ¥çš„å‘½ä»¤è¡Œå‚æ•°è®¾ç½®äº†é»˜è®¤å€¼:</p>
<img src="/assets/webpack-runtime/04.png" />
<p>ç„¶ååˆ¤æ–­äº†å‘½ä»¤è¡Œå‚æ•°ä¸­æ˜¯å¦æŒ‡å®šäº†ä¸€ä¸ªå…·ä½“çš„é…ç½®æ–‡ä»¶è·¯å¾„ï¼Œå¦‚æœæŒ‡å®šäº†å°±åŠ è½½æŒ‡å®šé…ç½®æ–‡ä»¶ï¼Œåä¹‹åˆ™éœ€è¦æ ¹æ®é»˜è®¤é…ç½®æ–‡ä»¶åŠ è½½è§„åˆ™æ‰¾åˆ°é…ç½®æ–‡ä»¶ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p>
<img src="/assets/webpack-runtime/05.png" />
<p>æ‰¾åˆ°é…ç½®æ–‡ä»¶è¿‡åï¼Œwebpack-cli å°†é…ç½®æ–‡ä»¶ä¸­çš„é…ç½®å’Œ CLI å‚æ•°ä¸­çš„é…ç½®åˆå¹¶ï¼Œå¦‚æœå‡ºç°é‡å¤çš„æƒ…å†µï¼Œä¼šä¼˜å…ˆä½¿ç”¨ CLI å‚æ•°ï¼Œæœ€ç»ˆå¾—åˆ°ä¸€ä¸ªå®Œæ•´çš„é…ç½®é€‰é¡¹ã€‚<br />
æœ‰äº†é…ç½®é€‰é¡¹è¿‡åï¼Œå¼€å§‹è½½å…¥ Webpack æ ¸å¿ƒæ¨¡å—ï¼Œä¼ å…¥é…ç½®é€‰é¡¹ï¼Œåˆ›å»º Compiler å¯¹è±¡ï¼Œè¿™ä¸ª Compiler å¯¹è±¡å°±æ˜¯æ•´ä¸ª Webpack å·¥ä½œè¿‡ç¨‹ä¸­æœ€æ ¸å¿ƒçš„å¯¹è±¡äº†ï¼Œè´Ÿè´£å®Œæˆæ•´ä¸ªé¡¹ç›®çš„æ„å»ºå·¥ä½œã€‚</p>
<img src="/assets/webpack-runtime/06.png" />
<h3 id="ä¸‰-åˆ›å»º-compiler-å¯¹è±¡"><a class="markdownIt-Anchor" href="#ä¸‰-åˆ›å»º-compiler-å¯¹è±¡"></a> ä¸‰ã€åˆ›å»º Compiler å¯¹è±¡</h3>
<p>éšç€ Webpack CLI è½½å…¥ Webpack æ ¸å¿ƒæ¨¡å—ï¼Œæ•´ä¸ªæ‰§è¡Œè¿‡ç¨‹å°±åˆ°äº† Webpack æ¨¡å—ä¸­ï¼Œæ‰€ä»¥è¿™ä¸€éƒ¨åˆ†çš„ä»£ç éœ€è¦å›åˆ° Webpack æ¨¡å—ä¸­ï¼ŒåŒæ ·ï¼Œè¿™é‡Œæˆ‘ä»¬éœ€è¦æ‰¾åˆ°è¿™ä¸ªæ¨¡å—çš„å…¥å£æ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯ lib/webpack.js æ–‡ä»¶ã€‚è¿™ä¸ªæ–‡ä»¶å¯¼å‡ºçš„æ˜¯ä¸€ä¸ªç”¨äºåˆ›å»º Compiler çš„å‡½æ•°ï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> webpack = <span class="function">(<span class="params">options, callback</span>) =&gt;</span> &#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="keyword">let</span> compiler;</span><br><span class="line">  <span class="comment">// æ ¡éªŒå¤–éƒ¨ä¼ å…¥options</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">Array</span>.isArray(options)) &#123;</span><br><span class="line">    <span class="comment">// å¦‚æœoptionsä¸ºæ•°ç»„å¼€å¯å¤šè·¯æ‰“åŒ…</span></span><br><span class="line">    compiler = <span class="keyword">new</span> MultiCompiler(options.map(<span class="function"><span class="params">options</span> =&gt;</span> webpack(options)));</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> options === <span class="string">&quot;object&quot;</span>) &#123;</span><br><span class="line">    <span class="comment">// å¦‚æœoptionsä¸ºå¯¹è±¡å¼€å¯å•è·¯æ‰“åŒ…</span></span><br><span class="line">    options = <span class="keyword">new</span> WebpackOptionsDefaulter().process(options); <span class="comment">// 1.å¤„ç†options</span></span><br><span class="line">    compiler = <span class="keyword">new</span> Compiler(options.context); <span class="comment">// 2.åˆ›å»ºcompiler</span></span><br><span class="line">    compiler.options = options;</span><br><span class="line">    <span class="keyword">new</span> NodeEnvironmentPlugin().apply(compiler);</span><br><span class="line">    <span class="keyword">if</span> (options.plugins &amp;&amp; <span class="built_in">Array</span>.isArray(options.plugins)) &#123;</span><br><span class="line">      <span class="comment">// 3.æ³¨å†Œå·²é…ç½®çš„æ’ä»¶</span></span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">const</span> plugin <span class="keyword">of</span> options.plugins) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> plugin === <span class="string">&quot;function&quot;</span>) &#123;</span><br><span class="line">          plugin.call(compiler, compiler);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          plugin.apply(compiler);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 4.è§¦å‘ç‰¹å®šçš„Hook</span></span><br><span class="line">    compiler.hooks.environment.call();</span><br><span class="line">    compiler.hooks.afterEnvironment.call();</span><br><span class="line">    <span class="comment">// 5.å¤„ç†options</span></span><br><span class="line">    compiler.options = <span class="keyword">new</span> WebpackOptionsApply().process(options, compiler);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;Invalid argument: options&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (callback) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> callback !== <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;Invalid argument: callback&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (options.watch === <span class="literal">true</span> || (<span class="built_in">Array</span>.isArray(options)) &amp;&amp; options.some(<span class="function"><span class="params">o</span> =&gt;</span> o.watch)) &#123;</span><br><span class="line">      <span class="keyword">const</span> watchOptions = <span class="built_in">Array</span>.isArray(options) ? options.map(<span class="function"><span class="params">o</span> =&gt;</span> o.watchOptions || &#123;&#125;): options.watchOptions || &#123;&#125;;</span><br><span class="line">			<span class="keyword">return</span> compiler.watch(watchOptions, callback);</span><br><span class="line">    &#125;</span><br><span class="line">    compiler.run(callback);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> compiler;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>åœ¨è¿™ä¸ªå‡½æ•°ä¸­ï¼Œé¦–å…ˆæ ¡éªŒäº†å¤–éƒ¨ä¼ é€’è¿‡æ¥çš„ options å‚æ•°æ˜¯å¦ç¬¦åˆè¦æ±‚ï¼Œç´§æ¥ç€åˆ¤æ–­äº† options çš„ç±»å‹ã€‚å¦‚æœä¼ å…¥çš„æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œé‚£ä¹ˆ Webpack å†…éƒ¨åˆ›å»ºçš„å°±æ˜¯ä¸€ä¸ª MultiCompilerï¼Œä¹Ÿå°±æ˜¯åŒæ—¶å¼€å¯å¤šè·¯æ‰“åŒ…ï¼Œé…ç½®æ•°ç»„ä¸­çš„æ¯ä¸€ä¸ªæˆå‘˜å°±æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„é…ç½®é€‰é¡¹ã€‚è€Œå¦‚æœæˆ‘ä»¬ä¼ å…¥çš„æ˜¯æ™®é€šçš„å¯¹è±¡ï¼Œæµç¨‹ä¸»è¦åˆ†ä¸ºäº”æ­¥ï¼š</p>
<ol>
<li>å¤„ç†options</li>
<li>åˆ›å»ºcompiler</li>
<li>ç»‘å®šè‡ªå®šä¹‰æ’ä»¶</li>
<li>è§¦å‘ç‰¹å®šçš„Hook</li>
<li>å¤„ç†options.</li>
</ol>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç¬¬1å’Œç¬¬5æ­¥éƒ½æ˜¯å¤„ç†optionsã€‚é‚£åˆ°åº•æœ‰å•¥ä¸åŒå‘¢ï¼Ÿ</p>
<ul>
<li><code>new WebpackOptionsDefaulter().process(options)</code>ï¼šWebpackOptionsDefaulter é¡¾åæ€ä¹‰ï¼Œæ˜¯è®¾ç½® webpack çš„é»˜è®¤å‚æ•°çš„åœ°æ–¹ï¼Œæ¯”å¦‚è¯´é»˜è®¤å…¥å£è·¯å¾„ï¼Œé»˜è®¤ rule, é»˜è®¤ optimize ç­–ç•¥ã€‚è¿™è¡Œçš„ä½œç”¨å°±æ˜¯è®¾ç½®é»˜è®¤å‚æ•°ï¼Œå¹¶å°†ç”¨æˆ·è‡ªå®šä¹‰å‚æ•°è¦†ç›–ä¸Šå»ã€‚</li>
<li><code>new WebpackOptionsApply().process(options, compiler)</code>ï¼šWebpackOptionsApply çš„ä¸»è¦åŠŸèƒ½æ˜¯æ ¹æ® options ä¸­çš„é…ç½®ï¼Œæ³¨å†Œå„ç§å†…éƒ¨æ’ä»¶å¦‚ SingleEntryPluginï¼Œä»¥åŠè´Ÿè´£è§£æçš„å„ç±»é’©å­ï¼Œä»¥åŠè´Ÿè´£ä¼˜åŒ–çš„ SplitChunksPlugin ç­‰ç­‰ã€‚</li>
</ul>
<p>å¯ä»¥æ³¨æ„åˆ°åœ¨åˆ›å»ºäº† Compiler å¯¹è±¡è¿‡åï¼ŒWebpack å°±å¼€å§‹æ³¨å†Œæˆ‘ä»¬é…ç½®ä¸­çš„æ¯ä¸€ä¸ªæ’ä»¶äº†ï¼Œè¿™æ˜¯å› ä¸ºå†å¾€å Webpack å·¥ä½œè¿‡ç¨‹çš„ç”Ÿå‘½å‘¨æœŸå°±è¦å¼€å§‹äº†ï¼Œæ‰€ä»¥å¿…é¡»å…ˆæ³¨å†Œï¼Œè¿™æ ·æ‰èƒ½ç¡®ä¿æ’ä»¶ä¸­çš„æ¯ä¸€ä¸ªé’©å­éƒ½èƒ½è¢«å‘½ä¸­ã€‚</p>
<p>å®Œæˆ Compiler å¯¹è±¡çš„åˆ›å»ºè¿‡åï¼Œç´§æ¥ç€è¿™é‡Œçš„ä»£ç å¼€å§‹åˆ¤æ–­é…ç½®é€‰é¡¹ä¸­æ˜¯å¦å¯ç”¨äº†ç›‘è§†æ¨¡å¼ï¼Œå¦‚æœæ˜¯ç›‘è§†æ¨¡å¼å°±è°ƒç”¨ Compiler å¯¹è±¡çš„ watch æ–¹æ³•ï¼Œä»¥ç›‘è§†æ¨¡å¼å¯åŠ¨æ„å»ºï¼Œå¦‚æœä¸æ˜¯ç›‘è§†æ¨¡å¼å°±è°ƒç”¨ Compiler å¯¹è±¡çš„ run æ–¹æ³•ï¼Œå¼€å§‹æ„å»ºæ•´ä¸ªåº”ç”¨ã€‚</p>
<h3 id="å››-å¼€å§‹åˆ›å»º"><a class="markdownIt-Anchor" href="#å››-å¼€å§‹åˆ›å»º"></a> å››ã€å¼€å§‹åˆ›å»º</h3>
<p>è¿™ä¸ª run æ–¹æ³•å®šä¹‰åœ¨ Compiler ç±»å‹ä¸­ï¼Œå…·ä½“æ–‡ä»¶åœ¨ webpack æ¨¡å—ä¸‹çš„ lib/Compiler.js ä¸­ï¼Œæ–¹æ³•å†…éƒ¨å°±æ˜¯å…ˆè§¦å‘äº†beforeRun å’Œ run ä¸¤ä¸ªé’©å­ï¼Œç„¶åæœ€å…³é”®çš„æ˜¯è°ƒç”¨äº†å½“å‰å¯¹è±¡çš„ compile æ–¹æ³•ï¼ŒçœŸæ­£å¼€å§‹ç¼–è¯‘æ•´ä¸ªé¡¹ç›®ï¼Œå…·ä½“å®ç°å¦‚ä¸‹ï¼š</p>
<img src="/assets/webpack-runtime/08.png" />
<p>compile æ–¹æ³•å†…éƒ¨ä¸»è¦å°±æ˜¯åˆ›å»ºäº†ä¸€ä¸ª Compilation å¯¹è±¡ï¼ŒCompilation å­—é¢æ„æ€æ˜¯â€œåˆé›†â€ï¼Œå®é™…ä¸Šå¯ä»¥ç†è§£ä¸ºä¸€æ¬¡æ„å»ºè¿‡ç¨‹ä¸­çš„ä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œé‡Œé¢åŒ…å«äº†è¿™æ¬¡æ„å»ºä¸­å…¨éƒ¨çš„èµ„æºå’Œä¿¡æ¯ã€‚</p>
<img src="/assets/webpack-runtime/09.png" />
<p>åˆ›å»ºå®Œ Compilation å¯¹è±¡è¿‡åï¼Œç´§æ¥ç€è§¦å‘äº†ä¸€ä¸ªå«ä½œ make çš„é’©å­ï¼Œè¿›å…¥æ•´ä¸ªæ„å»ºè¿‡ç¨‹æœ€æ ¸å¿ƒçš„ make é˜¶æ®µã€‚<br />
è‡³æ­¤ Compiler ä½œä¸º Webpack äº‹ä»¶æ´¾å‘æ¨¡å¼ä¸­çš„å§”æ´¾è€…ï¼Œå…¶æ•´ä½“æµç¨‹çš„åˆ†æå·²ç»ç»“æŸï¼Œå…¶æµç¨‹å›¾ä»¥åŠå„ä¸ªé˜¶æ®µè§¦å‘çš„hookså¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<img src="/assets/webpack-runtime/10.png" />
<h3 id="äº”-makeæ„å»ºé˜¶æ®µ"><a class="markdownIt-Anchor" href="#äº”-makeæ„å»ºé˜¶æ®µ"></a> äº”ã€makeï¼ˆæ„å»ºï¼‰é˜¶æ®µ</h3>
<p>make é˜¶æ®µä¸»ä½“çš„ç›®æ ‡å°±æ˜¯ï¼šæ ¹æ® entry é…ç½®æ‰¾åˆ°å…¥å£æ¨¡å—ï¼Œå¼€å§‹ä¾æ¬¡é€’å½’å‡ºæ‰€æœ‰ä¾èµ–ï¼Œå½¢æˆä¾èµ–å…³ç³»æ ‘ï¼Œç„¶åå°†é€’å½’åˆ°çš„æ¯ä¸ªæ¨¡å—äº¤ç»™ä¸åŒçš„ Loader å¤„ç†ã€‚</p>
<img src="/assets/webpack-runtime/11.png" />
<p>è¿™ä¸ªé˜¶æ®µçš„è°ƒç”¨è¿‡ç¨‹å¹¶ä¸åƒä¹‹å‰ä¸€æ ·ï¼Œç›´æ¥è°ƒç”¨æŸä¸ªå¯¹è±¡çš„æŸä¸ªæ–¹æ³•ï¼Œè€Œæ˜¯é‡‡ç”¨äº‹ä»¶è§¦å‘æœºåˆ¶ï¼Œè®©å¤–éƒ¨ç›‘å¬è¿™ä¸ª make äº‹ä»¶çš„åœ°æ–¹å¼€å§‹æ‰§è¡Œï¼Œé¦–å…ˆæ‰§è¡Œçš„æ˜¯å…¥å£æ’ä»¶ï¼ŒWebpack ä¸­å…¥å£æ’ä»¶å®é™…æœ‰ä¸‰ä¸ªï¼š</p>
<ul>
<li>SingleEntryPlugin: å•å…¥å£æ‰“åŒ…ï¼Œå½“ options.entry çš„æ•°æ®ç±»å‹ä¸º String æˆ– Object æ—¶ä½¿ç”¨</li>
<li>MultiEntryPlugin: å¤šå…¥å£æ‰“åŒ…ï¼Œå½“ options.entry çš„æ•°æ®ç±»å‹ä¸º Array æ—¶ä½¿ç”¨</li>
<li>DynamicEntryPlugin: åŠ¨æ€æ‰“åŒ…ï¼Œå½“ options.entry çš„æ•°æ®ç±»å‹ä¸º Function æ—¶ä½¿ç”¨</li>
</ul>
<p>å› ä¸ºæˆ‘ä»¬é»˜è®¤ä½¿ç”¨çš„å°±æ˜¯å•ä¸€å…¥å£æ‰“åŒ…çš„æ–¹å¼ï¼Œæ‰€ä»¥è¿™é‡Œæ¥ä¸‹æ¥ä¼šæ‰§è¡Œå…¶ä¸­çš„ SingleEntryPluginï¼Œ</p>
<img src="/assets/webpack-runtime/12.png" />
<p>è¿™ä¸ªæ’ä»¶ä¸­è°ƒç”¨äº† Compilation å¯¹è±¡çš„ addEntry æ–¹æ³•ï¼Œå¼€å§‹è§£ææˆ‘ä»¬æºä»£ç ä¸­çš„å…¥å£æ–‡ä»¶:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">addEntry</span>(<span class="params">context, entry, name, callback</span>)</span> &#123;</span><br><span class="line">  <span class="comment">// å¤–éƒ¨ç›‘å¬ addEntry äº‹ä»¶çš„åœ°æ–¹å¼€å§‹æ‰§è¡Œ</span></span><br><span class="line">  <span class="built_in">this</span>.hooks.addEntry.call(entry, name);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å°†å…¥å£æ¨¡å—æ·»åŠ åˆ°æ¨¡å—ä¾èµ–åˆ—è¡¨ä¸­</span></span><br><span class="line">  <span class="keyword">const</span> slot = &#123;</span><br><span class="line">    name: name,</span><br><span class="line">    <span class="comment">// TODO webpack 5 remove `request`</span></span><br><span class="line">    request: <span class="literal">null</span>,</span><br><span class="line">    <span class="built_in">module</span>: <span class="literal">null</span></span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (entry <span class="keyword">instanceof</span> ModuleDependency) &#123;</span><br><span class="line">    slot.request = entry.request;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// TODO webpack 5: merge modules instead when multiple entry modules are supported</span></span><br><span class="line">  <span class="keyword">const</span> idx = <span class="built_in">this</span>._preparedEntrypoints.findIndex(<span class="function"><span class="params">slot</span> =&gt;</span> slot.name === name);</span><br><span class="line">  <span class="keyword">if</span> (idx &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="comment">// Overwrite existing entrypoint</span></span><br><span class="line">    <span class="built_in">this</span>._preparedEntrypoints[idx] = slot;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>._preparedEntrypoints.push(slot);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">this</span>._addModuleChain(</span><br><span class="line">    context,</span><br><span class="line">    entry,</span><br><span class="line">    <span class="built_in">module</span> =&gt; &#123;</span><br><span class="line">      <span class="built_in">this</span>.entries.push(<span class="built_in">module</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    (err, <span class="built_in">module</span>) =&gt; &#123;</span><br><span class="line">      ...</span><br><span class="line">    &#125;</span><br><span class="line">  )</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å‘ç° addEntry æ–¹æ³•çš„ä¸»è¦é€»è¾‘å°±æ˜¯å°†å½“å‰ entry æ·»åŠ åˆ°ç¼“å­˜å¹¶è°ƒç”¨äº† _addModuleChain æ–¹æ³•ï¼Œæˆ‘ä»¬æ¥æŸ¥çœ‹ _addModuleChain æ–¹æ³•çš„æºç ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">_addModuleChain</span>(<span class="params">context, dependency, onModule, callback</span>)</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> start = <span class="built_in">this</span>.profile &amp;&amp; <span class="built_in">Date</span>.now();</span><br><span class="line">  <span class="keyword">const</span> currentProfile = <span class="built_in">this</span>.profile &amp;&amp; &#123;&#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> errorAndCallback = <span class="built_in">this</span>.bail</span><br><span class="line">    ? <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">        callback(err);</span><br><span class="line">      &#125;</span><br><span class="line">    : <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">        err.dependencies = [dependency];</span><br><span class="line">        <span class="built_in">this</span>.errors.push(err);</span><br><span class="line">        callback();</span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (</span><br><span class="line">    <span class="keyword">typeof</span> dependency !== <span class="string">&quot;object&quot;</span> ||</span><br><span class="line">    dependency === <span class="literal">null</span> ||</span><br><span class="line">    !dependency.constructor</span><br><span class="line">  ) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;Parameter &#x27;dependency&#x27; must be a Dependency&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> Dep = <span class="comment">/** <span class="doctag">@type <span class="type">&#123;DepConstructor&#125;</span> </span>*/</span> (dependency.constructor);</span><br><span class="line">  <span class="keyword">const</span> moduleFactory = <span class="built_in">this</span>.dependencyFactories.get(Dep);</span><br><span class="line">  <span class="keyword">if</span> (!moduleFactory) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(</span><br><span class="line">      <span class="string">`No dependency factory available for this dependency type: <span class="subst">$&#123;dependency.constructor.name&#125;</span>`</span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">this</span>.semaphore.acquire(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    moduleFactory.create(</span><br><span class="line">      &#123;</span><br><span class="line">        contextInfo: &#123;</span><br><span class="line">          issuer: <span class="string">&quot;&quot;</span>,</span><br><span class="line">          compiler: <span class="built_in">this</span>.compiler.name</span><br><span class="line">        &#125;,</span><br><span class="line">        context: context,</span><br><span class="line">        dependencies: [dependency]</span><br><span class="line">      &#125;,</span><br><span class="line">      (err, <span class="built_in">module</span>) =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">          <span class="built_in">this</span>.semaphore.release();</span><br><span class="line">          <span class="keyword">return</span> errorAndCallback(<span class="keyword">new</span> EntryModuleNotFoundError(err));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> afterFactory;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (currentProfile) &#123;</span><br><span class="line">          afterFactory = <span class="built_in">Date</span>.now();</span><br><span class="line">          currentProfile.factory = afterFactory - start;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> addModuleResult = <span class="built_in">this</span>.addModule(<span class="built_in">module</span>);</span><br><span class="line">        <span class="built_in">module</span> = addModuleResult.module;</span><br><span class="line"></span><br><span class="line">        onModule(<span class="built_in">module</span>);</span><br><span class="line"></span><br><span class="line">        dependency.module = <span class="built_in">module</span>;</span><br><span class="line">        <span class="built_in">module</span>.addReason(<span class="literal">null</span>, dependency);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> afterBuild = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">if</span> (addModuleResult.dependencies) &#123;</span><br><span class="line">            <span class="built_in">this</span>.processModuleDependencies(<span class="built_in">module</span>, <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">              <span class="keyword">if</span> (err) <span class="keyword">return</span> callback(err);</span><br><span class="line">              callback(<span class="literal">null</span>, <span class="built_in">module</span>);</span><br><span class="line">            &#125;);</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> callback(<span class="literal">null</span>, <span class="built_in">module</span>);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (addModuleResult.issuer) &#123;</span><br><span class="line">          <span class="keyword">if</span> (currentProfile) &#123;</span><br><span class="line">            <span class="built_in">module</span>.profile = currentProfile;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (addModuleResult.build) &#123;</span><br><span class="line">          <span class="built_in">this</span>.buildModule(<span class="built_in">module</span>, <span class="literal">false</span>, <span class="literal">null</span>, <span class="literal">null</span>, <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (err) &#123;</span><br><span class="line">              <span class="built_in">this</span>.semaphore.release();</span><br><span class="line">              <span class="keyword">return</span> errorAndCallback(err);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (currentProfile) &#123;</span><br><span class="line">              <span class="keyword">const</span> afterBuilding = <span class="built_in">Date</span>.now();</span><br><span class="line">              currentProfile.building = afterBuilding - afterFactory;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="built_in">this</span>.semaphore.release();</span><br><span class="line">            afterBuild();</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="built_in">this</span>.semaphore.release();</span><br><span class="line">          <span class="built_in">this</span>.waitForBuildingFinished(<span class="built_in">module</span>, afterBuild);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    )</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>_addModuleChain æ–¹æ³•å…¥å‚ä¸­ context æ˜¯å½“å‰é¡¹ç›®çš„ç»å¯¹è·¯å¾„ï¼Œ dependency æ˜¯ entry å¯¹è±¡ï¼ŒonModule å’Œ callback éƒ½æ˜¯ addEntry æ–¹æ³•ä¼ å…¥çš„å›è°ƒï¼Œéƒ½æ¥æ”¶moduleå¯¹è±¡ã€‚æˆ‘ä»¬çŸ¥é“webpackçš„æ ¸å¿ƒåŠŸèƒ½å°±æ˜¯é€šè¿‡å…¥å£æ‰¾åˆ°æ‰€æœ‰ä¾èµ–çš„æ¨¡å—ï¼Œæœ€åç¼–è¯‘æˆä¸€ä¸ªæˆ–å¤šä¸ªbundleã€‚é‚£ä¹ˆ _addModuleChain å°±æ˜¯è¿™æ ·ä¸€ä¸ªéå†ä¾èµ–ï¼Œæ„å»º module ä¾èµ–å›¾çš„è¿‡ç¨‹ã€‚semaphone æ˜¯ Nodejs ä¸­æœ€å—æ¬¢è¿çš„ä¿¡å·é‡æ¨¡å—ï¼Œè§£å†³å¤šçº¿ç¨‹çš„é—®é¢˜ã€‚åœ¨compilation çš„æ„é€ å‡½æ•°ä¸­å¯ä»¥çœ‹åˆ°è¿™æ ·ä¸€è¡Œä»£ç </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">this</span>.semaphore = <span class="keyword">new</span> Semaphore(options.parallelism || <span class="number">100</span>);</span><br></pre></td></tr></table></figure>
<p>ç”±æ­¤æˆ‘ä»¬å¯ä»¥çŸ¥é“compilationå…è®¸å¹¶å‘è§£æå¤šå…¥å£ï¼Œå¦‚æœ opitons ä¸­æ²¡æœ‰è®¾ç½®ï¼Œé»˜è®¤ä¸ºå¹¶å‘100ã€‚<br />
é™¤æ­¤ä¹‹å¤–æˆ‘ä»¬è¿˜çœ‹åˆ°ä»£ç ä¸­æœ‰ä¸€ä¸ª moduleFactoryã€‚é‚£å®ƒæ˜¯å¹²å˜›çš„å‘¢ï¼Ÿå®é™…ä¸Š SingleEntryPlugin çš„ç¬¬äºŒä¸ªé‡è¦åŠŸèƒ½å°±æ˜¯æŠŠentryä¾èµ–å¯¹åº”çš„æ¨¡å—å·¥å‚ç±»å‹å­˜åˆ°äº† compilation.dependencyFactories è¿™ä¸ª map ä¸­ã€‚ moduleFactory å°±æ˜¯å½“å‰ä¾èµ–çš„å·¥å‚æ„é€ å‡½æ•°ã€‚é‚£ä¹ˆå‰©ä½™çš„é€»è¾‘ä»å­—é¢ä¸Šå°±å¾ˆå¥½ç†è§£äº†ã€‚</p>
<ol>
<li>è·å–å½“å‰ entry å¯¹åº”çš„æ¨¡å—å·¥å‚æ„é€ å™¨</li>
<li>è°ƒç”¨å·¥å‚å‡½æ•°çš„ create æ–¹æ³•åˆ›å»º module</li>
<li>æ„å»ºè§£æ this.buildModule(module)</li>
<li>afterBuild -&gt; processModuleDependencies, å¤„ç†å½“å‰ module ä¾èµ–</li>
</ol>
<p>åœ¨ buildModule å‰æ‰“ä¸Šæ–­ç‚¹ï¼ŒæŸ¥çœ‹å½“å‰moduleçš„å€¼:</p>
<img src="/assets/webpack-runtime/13.jpg" />
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°é‡Œé¢å¾ˆå¤šå±æ€§éƒ½æ˜¯ undefined/nullï¼Œå°¤å…¶æ˜¯ _sourceã€‚è¿™è¯´æ˜ï¼Œåœ¨ create ä¹‹åï¼Œå½“å‰åˆ›å»ºå‡ºçš„ module æ˜¯è¿˜æ²¡æœ‰åŠ è½½ç›¸åº”èµ„æºçš„ã€‚é‚£æˆ‘ä»¬å¯ä»¥æ¨æµ‹ï¼ŒbuildModule å°±æ˜¯åŠ è½½å¹¶è§£æèµ„æºçš„è¿‡ç¨‹ã€‚ç»§ç»­çœ‹ä»£ç ï¼Œå¯ä»¥å‘ç° buildModule ä¸­ç›´æ¥è°ƒç”¨äº† module.build:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">buildModule</span>(<span class="params"><span class="built_in">module</span>, optional, origin, dependencies, thisCallback</span>)</span> &#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="built_in">this</span>.hooks.buildModule.call(<span class="built_in">module</span>);</span><br><span class="line">  <span class="built_in">module</span>.build(</span><br><span class="line">    <span class="built_in">this</span>.options,</span><br><span class="line">    <span class="built_in">this</span>,</span><br><span class="line">    <span class="built_in">this</span>.resolverFactory.get(<span class="string">&quot;normal&quot;</span>, <span class="built_in">module</span>.resolveOptions),</span><br><span class="line">    <span class="built_in">this</span>.inputFileSystem,</span><br><span class="line">    error =&gt; &#123;</span><br><span class="line">      ...</span><br><span class="line">    &#125;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é‚£ä¹ˆå‰©ä¸‹çš„èµ„æºåŠ è½½ï¼Œè§£æè¿‡ç¨‹éƒ½æ˜¯äº¤ç»™äº† NormalModule.js å®Œæˆçš„ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// NormalModule.js</span></span><br><span class="line"><span class="function"><span class="title">build</span>(<span class="params">options, compilation, resolver, fs, callback</span>)</span> &#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">this</span>.doBuild(options, compilation, resolver, fs, <span class="function"><span class="params">err</span> =&gt;</span> &#123;...&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">doBuild</span>(<span class="params">options, compilation, resolver, fs, callback</span>)</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> loaderContext = <span class="built_in">this</span>.createLoaderContext(</span><br><span class="line">    resolver,</span><br><span class="line">    options,</span><br><span class="line">    compilation,</span><br><span class="line">    fs</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  runLoaders(</span><br><span class="line">    &#123;</span><br><span class="line">      resource: <span class="built_in">this</span>.resource,</span><br><span class="line">      loaders: <span class="built_in">this</span>.loaders,</span><br><span class="line">      context: loaderContext,</span><br><span class="line">      readResource: fs.readFile.bind(fs)</span><br><span class="line">    &#125;,</span><br><span class="line">    (err, result) =&gt; &#123;</span><br><span class="line">      ...</span><br><span class="line">      <span class="built_in">this</span>._source = <span class="built_in">this</span>.createSource(</span><br><span class="line">        <span class="built_in">this</span>.binary ? asBuffer(source) : asString(source),</span><br><span class="line">        resourceBuffer,</span><br><span class="line">        sourceMap</span><br><span class="line">      );</span><br><span class="line">      <span class="built_in">this</span>._ast =</span><br><span class="line">        <span class="keyword">typeof</span> extraInfo === <span class="string">&quot;object&quot;</span> &amp;&amp;</span><br><span class="line">        extraInfo !== <span class="literal">null</span> &amp;&amp;</span><br><span class="line">        extraInfo.webpackAST !== <span class="literal">undefined</span></span><br><span class="line">          ? extraInfo.webpackAST</span><br><span class="line">          : <span class="literal">null</span>;</span><br><span class="line">      <span class="keyword">return</span> callback();</span><br><span class="line">    &#125;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>doBuild æ–¹æ³•ä¸­åˆè°ƒç”¨äº† runLoaders æ–¹æ³•ï¼Œå¹¶åœ¨å‚æ•°ä¸­é€šè¿‡å°† fs.readFile.bind(fs) å°† loader èµ„æºæ–‡ä»¶ä¼ å…¥ã€‚åœ¨ runLoaders çš„å›è°ƒä¸­ï¼Œå¯ä»¥çœ‹åˆ°ç”¨ createSource ç»™this._source èµ‹å€¼ã€‚è¯æ˜æˆ‘ä»¬ä¹‹å‰çš„æ¨æµ‹æ˜¯æ­£ç¡®çš„ï¼ŒbuildModule æ–¹æ³•ä¸­æ‰§è¡Œå…·ä½“çš„ Loaderï¼Œå¤„ç†ç‰¹æ®Šèµ„æºåŠ è½½ã€‚</p>
<p>å½“ buildModule æ–¹æ³•æ‰§è¡Œå…·ä½“çš„ Loader ä¹‹åæˆ‘ä»¬å†çœ‹ build æ–¹æ³•ä¸­ç»™ doBuild æ–¹æ³•ä¼ å…¥çš„å›è°ƒå‡½æ•°ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">build</span>(<span class="params">options, compilation, resolver, fs, callback</span>)</span> &#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">this</span>.doBuild(options, compilation, resolver, fs, <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> result = <span class="built_in">this</span>.parser.parse(</span><br><span class="line">        <span class="built_in">this</span>._ast || <span class="built_in">this</span>._source.source(),</span><br><span class="line">        &#123;</span><br><span class="line">          current: <span class="built_in">this</span>,</span><br><span class="line">          <span class="built_in">module</span>: <span class="built_in">this</span>,</span><br><span class="line">          compilation: compilation,</span><br><span class="line">          options: options</span><br><span class="line">        &#125;,</span><br><span class="line">        (err, result) =&gt; &#123;</span><br><span class="line">          <span class="keyword">if</span> (err) &#123;</span><br><span class="line">            handleParseError(err);</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            handleParseResult(result);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      );</span><br><span class="line">      <span class="keyword">if</span> (result !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">        <span class="comment">// parse is sync</span></span><br><span class="line">        handleParseResult(result);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      handleParseError(e);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å‘ç°è¿™å„¿è°ƒç”¨äº† parser çš„ parse æ–¹æ³•ï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥æŸ¥çœ‹å…¶å…·ä½“å®ç°ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Parser.js</span></span><br><span class="line"><span class="keyword">static</span> <span class="function"><span class="title">parse</span>(<span class="params">code, options</span>)</span> &#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="keyword">const</span> parserOptions = <span class="built_in">Object</span>.assign(</span><br><span class="line">    <span class="built_in">Object</span>.create(<span class="literal">null</span>),</span><br><span class="line">    defaultParserOptions,</span><br><span class="line">    options</span><br><span class="line">  );</span><br><span class="line">  ...</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    ast = acorn.parse(code, parserOptions);</span><br><span class="line">    threw = <span class="literal">false</span>;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    threw = <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (threw) &#123;</span><br><span class="line">    <span class="keyword">throw</span> error;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> ast;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å‘ç°åœ¨ parse æ–¹æ³•ä¸­è°ƒç”¨ acorn åº“è§£æç» loader å¤„ç†åçš„æºæ–‡ä»¶ç”ŸæˆæŠ½è±¡è¯­æ³•æ ‘ AST è¯­æ³•æ ‘ã€‚<br />
å½“å½“å‰ä¾èµ– build å®Œæˆå _addModuleChain æ–¹æ³•ä¼šæ¥ç€æ‰§è¡Œ afterBuild æ–¹æ³•ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Compilation.js</span></span><br><span class="line"><span class="function"><span class="title">_addModuleChain</span>(<span class="params">context, dependency, onModule, callback</span>)</span> &#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="keyword">const</span> afterBuild = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">if</span> (addModuleResult.dependencies) &#123;</span><br><span class="line">      <span class="built_in">this</span>.processModuleDependencies(<span class="built_in">module</span>, <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) <span class="keyword">return</span> callback(err);</span><br><span class="line">        callback(<span class="literal">null</span>, <span class="built_in">module</span>);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> callback(<span class="literal">null</span>, <span class="built_in">module</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  ...</span><br><span class="line">  <span class="keyword">if</span> (addModuleResult.build) &#123;</span><br><span class="line">    <span class="built_in">this</span>.buildModule(<span class="built_in">module</span>, <span class="literal">false</span>, <span class="literal">null</span>, <span class="literal">null</span>, <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="built_in">this</span>.semaphore.release();</span><br><span class="line">        <span class="keyword">return</span> errorAndCallback(err);</span><br><span class="line">      &#125;</span><br><span class="line">      ...</span><br><span class="line">      <span class="built_in">this</span>.semaphore.release();</span><br><span class="line">      afterBuild();</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.semaphore.release();</span><br><span class="line">    <span class="built_in">this</span>.waitForBuildingFinished(<span class="built_in">module</span>, afterBuild);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">processModuleDependencies</span>(<span class="params"><span class="built_in">module</span>, callback</span>)</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> addDependency = <span class="function"><span class="params">dep</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> resourceIdent = dep.getResourceIdentifier();</span><br><span class="line">    <span class="keyword">if</span> (resourceIdent) &#123;</span><br><span class="line">      <span class="keyword">const</span> factory = <span class="built_in">this</span>.dependencyFactories.get(dep.constructor);</span><br><span class="line">      <span class="keyword">if</span> (factory === <span class="literal">undefined</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(</span><br><span class="line">          <span class="string">`No module factory available for dependency type: <span class="subst">$&#123;</span></span></span><br><span class="line"><span class="string"><span class="subst">            dep.constructor.name</span></span></span><br><span class="line"><span class="string"><span class="subst">          &#125;</span>`</span></span><br><span class="line">        );</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">let</span> innerMap = dependencies.get(factory);</span><br><span class="line">      <span class="keyword">if</span> (innerMap === <span class="literal">undefined</span>) &#123;</span><br><span class="line">        dependencies.set(factory, (innerMap = <span class="keyword">new</span> <span class="built_in">Map</span>()));</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">let</span> list = innerMap.get(resourceIdent);</span><br><span class="line">      <span class="keyword">if</span> (list === <span class="literal">undefined</span>) innerMap.set(resourceIdent, (list = []));</span><br><span class="line">      list.push(dep);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">const</span> addDependenciesBlock = <span class="function"><span class="params">block</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (block.dependencies) &#123;</span><br><span class="line">      iterationOfArrayCallback(block.dependencies, addDependency);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (block.blocks) &#123;</span><br><span class="line">      iterationOfArrayCallback(block.blocks, addDependenciesBlock);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (block.variables) &#123;</span><br><span class="line">      iterationBlockVariable(block.variables, addDependency);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    addDependenciesBlock(<span class="built_in">module</span>);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    callback(e);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> iterationOfArrayCallback = <span class="function">(<span class="params">arr, fn</span>) =&gt;</span> &#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">let</span> index = <span class="number">0</span>; index &lt; arr.length; index++) &#123;</span><br><span class="line">		fn(arr[index]);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>å¯¹äºå½“å‰æ¨¡å—ï¼Œæˆ–è®¸å­˜åœ¨ç€å¤šä¸ªä¾èµ–æ¨¡å—ã€‚å½“å‰æ¨¡å—ä¼šå¼€è¾Ÿä¸€ä¸ªä¾èµ–æ¨¡å—çš„æ•°ç»„ï¼Œåœ¨éå† AST æ—¶ï¼Œå°† require() ä¸­çš„æ¨¡å—é€šè¿‡ addDependency() æ·»åŠ åˆ°æ•°ç»„ä¸­ã€‚å½“å‰æ¨¡å—æ„å»ºå®Œæˆåï¼Œwebpack è°ƒç”¨ processModuleDependencies å¼€å§‹é€’å½’å¤„ç†ä¾èµ–çš„ moduleï¼Œæ¥ç€å°±ä¼šé‡å¤ä¹‹å‰çš„æ„å»ºæ­¥éª¤ã€‚</p>
<p><strong>è¡¥å……</strong><br />
Module æ˜¯ webpack æ„å»ºçš„æ ¸å¿ƒå®ä½“ï¼Œä¹Ÿæ˜¯æ‰€æœ‰ module çš„ çˆ¶ç±»ï¼Œå®ƒæœ‰å‡ ç§ä¸åŒå­ç±»ï¼šNormalModule , MultiModule , ContextModule , DelegatedModule ç­‰ã€‚ä½†è¿™äº›æ ¸å¿ƒå®ä½“éƒ½æ˜¯åœ¨æ„å»ºä¸­éƒ½ä¼šå»è°ƒç”¨å¯¹åº”çš„æ„å»ºæ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯ build() ã€‚å®ƒè¿˜åŒ…æ‹¬äº†ä»æ„å»ºåˆ°è¾“å‡ºçš„ä¸€ç³»åˆ—çš„æœ‰å…³ module ç”Ÿå‘½å‘¨æœŸçš„å‡½æ•°ï¼Œæˆ‘ä»¬é€šè¿‡ module çˆ¶ç±»ç±»å›¾å…¶å­ç±»ç±»å›¾(è¿™é‡Œä»¥ NormalModule ä¸ºä¾‹)æ¥è§‚å¯Ÿå…¶çœŸå®å½¢æ€ï¼š</p>
<img src="/assets/webpack-runtime/15.png" />
<p>å¯ä»¥çœ‹åˆ°æ— è®ºæ˜¯æ„å»ºæµç¨‹ï¼Œå¤„ç†ä¾èµ–æµç¨‹ï¼ŒåŒ…æ‹¬åé¢çš„å°è£…æµç¨‹éƒ½æ˜¯ä¸ module å¯†åˆ‡ç›¸å…³çš„ã€‚</p>
<h3 id="å…­-æ‰“åŒ…è¾“å‡º"><a class="markdownIt-Anchor" href="#å…­-æ‰“åŒ…è¾“å‡º"></a> å…­ã€æ‰“åŒ…è¾“å‡º</h3>
<p>åœ¨æ‰€æœ‰æ¨¡å—åŠå…¶ä¾èµ–æ¨¡å— build å®Œæˆåï¼Œwebpack ä¼šç›‘å¬ seal äº‹ä»¶è°ƒç”¨å„æ’ä»¶å¯¹æ„å»ºåçš„ç»“æœè¿›è¡Œå°è£…ï¼Œè¦é€æ¬¡å¯¹æ¯ä¸ª module å’Œ chunk è¿›è¡Œæ•´ç†ï¼Œç”Ÿæˆç¼–è¯‘åçš„æºç ï¼Œåˆå¹¶ï¼Œæ‹†åˆ†ï¼Œç”Ÿæˆ hash ã€‚ åŒæ—¶è¿™æ˜¯æˆ‘ä»¬åœ¨å¼€å‘æ—¶è¿›è¡Œä»£ç ä¼˜åŒ–å’ŒåŠŸèƒ½æ·»åŠ çš„å…³é”®ç¯èŠ‚ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">seal</span>(<span class="params">callback</span>)</span> &#123;</span><br><span class="line">  <span class="built_in">this</span>.hooks.seal.call();</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> preparedEntrypoint <span class="keyword">of</span> <span class="built_in">this</span>._preparedEntrypoints) &#123;</span><br><span class="line">    <span class="comment">// æ•´ç†æ¯ä¸ªModuleå’Œchunkï¼Œæ¯ä¸ªchunkå¯¹åº”ä¸€ä¸ªè¾“å‡ºæ–‡ä»¶ã€‚</span></span><br><span class="line">    <span class="keyword">const</span> <span class="built_in">module</span> = preparedEntrypoint.module;</span><br><span class="line">    <span class="keyword">const</span> name = preparedEntrypoint.name;</span><br><span class="line">    <span class="keyword">const</span> chunk = <span class="built_in">this</span>.addChunk(name);</span><br><span class="line">    <span class="keyword">const</span> entrypoint = <span class="keyword">new</span> Entrypoint(name);</span><br><span class="line">    entrypoint.setRuntimeChunk(chunk);</span><br><span class="line">    entrypoint.addOrigin(<span class="literal">null</span>, name, preparedEntrypoint.request);</span><br><span class="line">    <span class="built_in">this</span>.namedChunkGroups.set(name, entrypoint);</span><br><span class="line">    <span class="built_in">this</span>.entrypoints.set(name, entrypoint);</span><br><span class="line">    <span class="built_in">this</span>.chunkGroups.push(entrypoint);</span><br><span class="line"></span><br><span class="line">    GraphHelpers.connectChunkGroupAndChunk(entrypoint, chunk);</span><br><span class="line">    GraphHelpers.connectChunkAndModule(chunk, <span class="built_in">module</span>);</span><br><span class="line"></span><br><span class="line">    chunk.entryModule = <span class="built_in">module</span>;</span><br><span class="line">    chunk.name = name;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">this</span>.assignDepth(<span class="built_in">module</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">  <span class="built_in">this</span>.hooks.beforeModuleAssets.call();</span><br><span class="line">  <span class="built_in">this</span>.createModuleAssets();</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">this</span>.hooks.shouldGenerateChunkAssets.call() !== <span class="literal">false</span>) &#123;</span><br><span class="line">    <span class="built_in">this</span>.hooks.beforeChunkAssets.call();</span><br><span class="line">    <span class="comment">// ç”Ÿæˆæœ€ç»ˆçš„assets</span></span><br><span class="line">    <span class="built_in">this</span>.createChunkAssets();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨å°è£…è¿‡ç¨‹ä¸­ï¼Œwebpack ä¼šè°ƒç”¨ Compilation ä¸­çš„ createChunkAssets æ–¹æ³•è¿›è¡Œæ‰“åŒ…åä»£ç çš„ç”Ÿæˆã€‚ createChunkAssets æµç¨‹å¦‚ä¸‹ï¼š</p>
<img src="/assets/webpack-runtime/14.png" />
<p>ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºé€šè¿‡åˆ¤æ–­æ˜¯å…¥å£ js è¿˜æ˜¯éœ€è¦å¼‚æ­¥åŠ è½½çš„ js æ¥é€‰æ‹©ä¸åŒçš„æ¨¡æ¿å¯¹è±¡è¿›è¡Œå°è£…ï¼Œå…¥å£ js ä¼šé‡‡ç”¨ webpack äº‹ä»¶æµçš„ render äº‹ä»¶æ¥è§¦å‘ Templateç±» ä¸­çš„renderChunkModules() (å¼‚æ­¥åŠ è½½çš„ js ä¼šè°ƒç”¨ chunkTemplate ä¸­çš„ render æ–¹æ³•)ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> template = chunk.hasRuntime() ? <span class="built_in">this</span>.mainTemplate : <span class="built_in">this</span>.chunkTemplate;</span><br><span class="line"><span class="keyword">const</span> manifest = template.getRenderManifest(&#123;</span><br><span class="line">  chunk,</span><br><span class="line">  hash: <span class="built_in">this</span>.hash,</span><br><span class="line">  fullHash: <span class="built_in">this</span>.fullHash,</span><br><span class="line">  outputOptions,</span><br><span class="line">  moduleTemplates: <span class="built_in">this</span>.moduleTemplates,</span><br><span class="line">  dependencyTemplates: <span class="built_in">this</span>.dependencyTemplates</span><br><span class="line">&#125;); </span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> fileManifest <span class="keyword">of</span> manifest) &#123;</span><br><span class="line">  <span class="keyword">const</span> cacheName = fileManifest.identifier;</span><br><span class="line">  <span class="keyword">const</span> usedHash = fileManifest.hash;</span><br><span class="line">  filenameTemplate = fileManifest.filenameTemplate;</span><br><span class="line">  file = <span class="built_in">this</span>.getPath(filenameTemplate, fileManifest.pathOptions);</span><br><span class="line">  ...</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">this</span>.cache &amp;&amp; <span class="built_in">this</span>.cache[cacheName] &amp;&amp; <span class="built_in">this</span>.cache[cacheName].hash === usedHash) &#123;</span><br><span class="line">    source = <span class="built_in">this</span>.cache[cacheName].source;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">//  è°ƒç”¨ Template ç±»çš„ render æ–¹æ³•ç”Ÿæˆä»£ç </span></span><br><span class="line">    source = fileManifest.render();</span><br><span class="line">    <span class="comment">// Ensure that source is a cached source to avoid additional cost because of repeated access</span></span><br><span class="line">    <span class="keyword">if</span> (!(source <span class="keyword">instanceof</span> CachedSource)) &#123;</span><br><span class="line">      <span class="keyword">const</span> cacheEntry = cachedSourceMap.get(source);</span><br><span class="line">      <span class="keyword">if</span> (cacheEntry) &#123;</span><br><span class="line">        source = cacheEntry;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> cachedSource = <span class="keyword">new</span> CachedSource(source);</span><br><span class="line">        cachedSourceMap.set(source, cachedSource);</span><br><span class="line">        source = cachedSource;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.cache) &#123;</span><br><span class="line">      <span class="built_in">this</span>.cache[cacheName] = &#123;</span><br><span class="line">        hash: usedHash,</span><br><span class="line">        source</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// assetsæ–‡ä»¶ç”Ÿæˆ</span></span><br><span class="line">  <span class="built_in">this</span>.assets[file] = source;</span><br><span class="line">  chunk.files.push(file);</span><br><span class="line">  <span class="built_in">this</span>.hooks.chunkAsset.call(chunk, file);</span><br><span class="line">  alreadyWrittenFiles.set(file, &#123;</span><br><span class="line">    hash: usedHash,</span><br><span class="line">    source,</span><br><span class="line">    chunk</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æœ€åä¸€æ­¥ï¼Œwebpack è°ƒç”¨ Compiler ä¸­çš„ emitAssets() ï¼ŒæŒ‰ç…§ output ä¸­çš„é…ç½®é¡¹å°†æ–‡ä»¶è¾“å‡ºåˆ°äº†å¯¹åº”çš„ path ä¸­ï¼Œä»è€Œ webpack æ•´ä¸ªæ‰“åŒ…è¿‡ç¨‹ç»“æŸã€‚è¦æ³¨æ„çš„æ˜¯ï¼Œè‹¥æƒ³å¯¹ç»“æœè¿›è¡Œå¤„ç†ï¼Œåˆ™éœ€è¦åœ¨ emit è§¦å‘åå¯¹è‡ªå®šä¹‰æ’ä»¶è¿›è¡Œæ‰©å±•ã€‚</p>
<h3 id="ä¸ƒ-æ€»ç»“"><a class="markdownIt-Anchor" href="#ä¸ƒ-æ€»ç»“"></a> ä¸ƒã€æ€»ç»“</h3>
<p>webpack çš„æ•´ä½“æ‰“åŒ…æµç¨‹ä¸»è¦è¿˜æ˜¯ä¾èµ–äº compilation å’Œ module è¿™ä¸¤ä¸ªå¯¹è±¡ï¼Œcompiliation å¯¹è±¡è´Ÿè´£åè°ƒæ•´ä¸ªæ„å»ºè¿‡ç¨‹ï¼Œ module æ˜¯ webpack æ„å»ºçš„æ ¸å¿ƒå®ä½“ï¼Œç”±è¿™ä¸¤è€…åˆä½œå®Œæˆäº†æ•´ä½“é¡¹ç›®çš„æ‰“åŒ…ï¼Œç”± tapable æ§åˆ¶å„æ’ä»¶åœ¨ webpack äº‹ä»¶æµä¸Šè¿è¡Œï¼Œæœ€ç»ˆæˆå°±äº† Webpack è¿™ç›®å‰ä½¿ç”¨æœ€å¹¿æ³›çš„æ‰“åŒ…å·¥å…·ã€‚</p>
<p>æ•´ä¸ªæµç¨‹ä¸»è¦å®Œæˆäº†<strong>å†…å®¹è½¬æ¢ + èµ„æºåˆå¹¶</strong>ä¸¤ç§åŠŸèƒ½ï¼Œå®ç°ä¸ŠåŒ…å«ä¸‰ä¸ªé˜¶æ®µï¼š</p>
<h4 id="1-åˆå§‹åŒ–é˜¶æ®µ"><a class="markdownIt-Anchor" href="#1-åˆå§‹åŒ–é˜¶æ®µ"></a> 1ã€åˆå§‹åŒ–é˜¶æ®µ</h4>
<ul>
<li>åˆå§‹åŒ–å‚æ•°ï¼šä»é…ç½®æ–‡ä»¶ã€ é…ç½®å¯¹è±¡ã€Shell å‚æ•°ä¸­è¯»å–ï¼Œä¸é»˜è®¤é…ç½®ç»“åˆå¾—å‡ºæœ€ç»ˆçš„å‚æ•°</li>
<li>åˆ›å»ºç¼–è¯‘å™¨å¯¹è±¡ï¼šç”¨ä¸Šä¸€æ­¥å¾—åˆ°çš„å‚æ•°åˆ›å»º Compiler å¯¹è±¡</li>
<li>åˆå§‹åŒ–ç¼–è¯‘ç¯å¢ƒï¼šåŒ…æ‹¬æ³¨å…¥å†…ç½®æ’ä»¶ã€æ³¨å†Œå„ç§æ¨¡å—å·¥å‚ã€åˆå§‹åŒ– RuleSet é›†åˆã€åŠ è½½é…ç½®çš„æ’ä»¶ç­‰</li>
<li>å¼€å§‹ç¼–è¯‘ï¼šæ‰§è¡Œ compiler å¯¹è±¡çš„ run æ–¹æ³•</li>
<li>ç¡®å®šå…¥å£ï¼šæ ¹æ®é…ç½®ä¸­çš„ entry æ‰¾å‡ºæ‰€æœ‰çš„å…¥å£æ–‡ä»¶ï¼Œè°ƒç”¨ compilition.addEntry å°†å…¥å£æ–‡ä»¶è½¬æ¢ä¸º dependence å¯¹è±¡</li>
</ul>
<img src="/assets/webpack-runtime/16.jpg">
<h4 id="2-æ„å»ºé˜¶æ®µ"><a class="markdownIt-Anchor" href="#2-æ„å»ºé˜¶æ®µ"></a> 2ã€æ„å»ºé˜¶æ®µ</h4>
<ul>
<li>ç¼–è¯‘æ¨¡å—(make)ï¼šæ ¹æ® entry å¯¹åº”çš„ dependence åˆ›å»º module å¯¹è±¡ï¼Œè°ƒç”¨ loader å°†æ¨¡å—è½¬è¯‘ä¸ºæ ‡å‡† JS å†…å®¹ï¼Œè°ƒç”¨ JS è§£é‡Šå™¨å°†å†…å®¹è½¬æ¢ä¸º AST å¯¹è±¡ï¼Œä»ä¸­æ‰¾å‡ºè¯¥æ¨¡å—ä¾èµ–çš„æ¨¡å—ï¼Œå†é€’å½’æœ¬æ­¥éª¤ç›´åˆ°æ‰€æœ‰å…¥å£ä¾èµ–çš„æ–‡ä»¶éƒ½ç»è¿‡äº†æœ¬æ­¥éª¤çš„å¤„ç†</li>
<li>å®Œæˆæ¨¡å—ç¼–è¯‘ï¼šä¸Šä¸€æ­¥é€’å½’å¤„ç†æ‰€æœ‰èƒ½è§¦è¾¾åˆ°çš„æ¨¡å—åï¼Œå¾—åˆ°äº†æ¯ä¸ªæ¨¡å—è¢«ç¿»è¯‘åçš„å†…å®¹ä»¥åŠå®ƒä»¬ä¹‹é—´çš„ä¾èµ–å…³ç³»å›¾</li>
</ul>
<img src="/assets/webpack-runtime/17.jpg">
<ol>
<li>è°ƒç”¨ handleModuleCreate ï¼Œæ ¹æ®æ–‡ä»¶ç±»å‹æ„å»º module å­ç±»</li>
<li>è°ƒç”¨ loader-runner ä»“åº“çš„ runLoaders è½¬è¯‘ module å†…å®¹ï¼Œé€šå¸¸æ˜¯ä»å„ç±»èµ„æºç±»å‹è½¬è¯‘ä¸º JavaScript æ–‡æœ¬</li>
<li>è°ƒç”¨ acorn å°† JS æ–‡æœ¬è§£æä¸ºAST</li>
<li>éå† ASTï¼Œè§¦å‘å„ç§é’©å­ï¼šåœ¨ HarmonyExportDependencyParserPlugin æ’ä»¶ç›‘å¬ exportImportSpecifier é’©å­ï¼Œè§£è¯» JS æ–‡æœ¬å¯¹åº”çš„èµ„æºä¾èµ–ï¼›è°ƒç”¨ module å¯¹è±¡çš„ addDependency å°†ä¾èµ–å¯¹è±¡åŠ å…¥åˆ° module ä¾èµ–åˆ—è¡¨ä¸­</li>
<li>AST éå†å®Œæ¯•åï¼Œè°ƒç”¨ module.handleParseResult å¤„ç†æ¨¡å—ä¾èµ–</li>
<li>å¯¹äº module æ–°å¢çš„ä¾èµ–ï¼Œè°ƒç”¨ handleModuleCreate ï¼Œæ§åˆ¶æµå›åˆ°ç¬¬ä¸€æ­¥</li>
<li>æ‰€æœ‰ä¾èµ–éƒ½è§£æå®Œæ¯•åï¼Œæ„å»ºé˜¶æ®µç»“æŸ</li>
</ol>
<p>è¿™ä¸ªè¿‡ç¨‹ä¸­æ•°æ®æµ module =&gt; ast =&gt; dependences =&gt; module ï¼Œå…ˆè½¬ AST å†ä» AST æ‰¾ä¾èµ–ã€‚è¿™å°±è¦æ±‚ loaders å¤„ç†å®Œçš„æœ€åç»“æœå¿…é¡»æ˜¯å¯ä»¥è¢« acorn å¤„ç†çš„æ ‡å‡† JavaScript è¯­æ³•ï¼Œæ¯”å¦‚è¯´å¯¹äºå›¾ç‰‡ï¼Œéœ€è¦ä»å›¾åƒäºŒè¿›åˆ¶è½¬æ¢æˆç±»ä¼¼äº <code>export default &quot;data:image/png;base64,xxx&quot;</code> è¿™ç±» base64 æ ¼å¼æˆ–è€… <code>export default &quot;http://xxx&quot;</code> è¿™ç±» url æ ¼å¼ã€‚</p>
<p>compilation æŒ‰è¿™ä¸ªæµç¨‹é€’å½’å¤„ç†ï¼Œé€æ­¥è§£æå‡ºæ¯ä¸ªæ¨¡å—çš„å†…å®¹ä»¥åŠ module ä¾èµ–å…³ç³»ï¼Œåç»­å°±å¯ä»¥æ ¹æ®è¿™äº›å†…å®¹æ‰“åŒ…è¾“å‡ºã€‚</p>
<h4 id="3-ç”Ÿæˆé˜¶æ®µ"><a class="markdownIt-Anchor" href="#3-ç”Ÿæˆé˜¶æ®µ"></a> 3ã€ç”Ÿæˆé˜¶æ®µ</h4>
<ul>
<li>è¾“å‡ºèµ„æº(seal)ï¼šæ ¹æ®å…¥å£å’Œæ¨¡å—ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œç»„è£…æˆä¸€ä¸ªä¸ªåŒ…å«å¤šä¸ªæ¨¡å—çš„ Chunkï¼Œå†æŠŠæ¯ä¸ª Chunk è½¬æ¢æˆä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶åŠ å…¥åˆ°è¾“å‡ºåˆ—è¡¨ï¼Œè¿™æ­¥æ˜¯å¯ä»¥ä¿®æ”¹è¾“å‡ºå†…å®¹çš„æœ€åæœºä¼šï¼Œå› æ­¤æ‰“åŒ…çš„ä¼˜åŒ–ä¸»è¦å°±åœ¨è¿™ä¸ªé˜¶æ®µ</li>
<li>å†™å…¥æ–‡ä»¶ç³»ç»Ÿ(emitAssets)ï¼šåœ¨ç¡®å®šå¥½è¾“å‡ºå†…å®¹åï¼Œæ ¹æ®é…ç½®ç¡®å®šè¾“å‡ºçš„è·¯å¾„å’Œæ–‡ä»¶åï¼ŒæŠŠæ–‡ä»¶å†…å®¹å†™å…¥åˆ°æ–‡ä»¶ç³»ç»Ÿ</li>
</ul>
<img src="/assets/webpack-runtime/18.jpeg">
<ol>
<li>æ„å»ºæœ¬æ¬¡ç¼–è¯‘çš„ ChunkGraph å¯¹è±¡ï¼›</li>
<li>éå† compilation.modules é›†åˆï¼Œå°† module æŒ‰ entry/åŠ¨æ€å¼•å…¥ çš„è§„åˆ™åˆ†é…ç»™ä¸åŒçš„ Chunk å¯¹è±¡ï¼›</li>
<li>compilation.modules é›†åˆéå†å®Œæ¯•åï¼Œå¾—åˆ°å®Œæ•´çš„ chunks é›†åˆå¯¹è±¡ï¼Œè°ƒç”¨ createXxxAssets æ–¹æ³•</li>
<li>createXxxAssets éå† module/chunk ï¼Œè°ƒç”¨ compilation.emitAssets æ–¹æ³•å°† assets ä¿¡æ¯è®°å½•åˆ° compilation.assets å¯¹è±¡ä¸­</li>
<li>è§¦å‘ seal å›è°ƒï¼Œæ§åˆ¶æµå›åˆ° compiler å¯¹è±¡</li>
</ol>
<p>è¿™ä¸€æ­¥çš„å…³é”®é€»è¾‘æ˜¯å°† module æŒ‰è§„åˆ™ç»„ç»‡æˆ chunks ï¼Œwebpack å†…ç½®çš„ chunk å°è£…è§„åˆ™æ¯”è¾ƒç®€å•ï¼š</p>
<ul>
<li>entry åŠ entry è§¦è¾¾åˆ°çš„æ¨¡å—ï¼Œç»„åˆæˆä¸€ä¸ª chunk</li>
<li>ä½¿ç”¨åŠ¨æ€å¼•å…¥è¯­å¥å¼•å…¥çš„æ¨¡å—ï¼Œå„è‡ªç»„åˆæˆä¸€ä¸ª chunk</li>
</ul>
<h2 id="å‚è€ƒèµ„æ–™"><a class="markdownIt-Anchor" href="#å‚è€ƒèµ„æ–™"></a> å‚è€ƒèµ„æ–™</h2>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6844903861451227150">ç¼–å†™ä¸€ä¸ªwebpackçš„loaderï¼ˆ1ï¼‰</a></p>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6909459619324788750">webpack-loaderç®€ç®€å•å•é…ç½®å…¥é—¨</a></p>
<p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/xT12rUsYOkypXS8YFYQEzQ">Webpack æ ¸å¿ƒçŸ¥è¯†æœ‰å“ªäº›ï¼Ÿ</a></p>
<p><a target="_blank" rel="noopener" href="https://developer.aliyun.com/article/61047">ç»†è¯´ webpack ä¹‹æµç¨‹ç¯‡</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/363928061">[ä¸‡å­—æ€»ç»“] ä¸€æ–‡åƒé€ Webpack æ ¸å¿ƒåŸç†</a></p>

    </div>

    
    
    
        <div class="reward-container">
  <div></div>
  <button onclick="var qr = document.getElementById('qr'); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    æ‰“èµ
  </button>
  <div id="qr" style="display: none;">
      
      <div style="display: inline-block;">
        <img src="/assets/config/weixin.png" alt="kyleezhang å¾®ä¿¡æ”¯ä»˜">
        <p>å¾®ä¿¡æ”¯ä»˜</p>
      </div>
      
      <div style="display: inline-block;">
        <img src="/assets/config/alipay.png" alt="kyleezhang æ”¯ä»˜å®">
        <p>æ”¯ä»˜å®</p>
      </div>

  </div>
</div>

        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>æœ¬æ–‡ä½œè€…ï¼š </strong>kyleezhang
  </li>
  <li class="post-copyright-link">
    <strong>æœ¬æ–‡é“¾æ¥ï¼š</strong>
    <a href="http://kyleezhang.com/2020/12/16/webpack-runtime/" title="Webpackè¿è¡Œæœºåˆ¶">http://kyleezhang.com/2020/12/16/webpack-runtime/</a>
  </li>
  <li class="post-copyright-license">
    <strong>ç‰ˆæƒå£°æ˜ï¼š </strong>æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼
  </li>
</ul>
</div>

        

  <div class="followme">
    <p>æ¬¢è¿å…³æ³¨æˆ‘çš„å…¶å®ƒå‘å¸ƒæ¸ é“</p>

    <div class="social-list">

        <div class="social-item">
          <a target="_blank" class="social-link" href="/assets/config/wechat.png">
            <span class="icon">
              <i class="fab fa-weixin"></i>
            </span>

            <span class="label">WeChat</span>
          </a>
        </div>

        <div class="social-item">
          <a target="_blank" class="social-link" href="/atom.xml">
            <span class="icon">
              <i class="fa fa-rss"></i>
            </span>

            <span class="label">RSS</span>
          </a>
        </div>
    </div>
  </div>


      <footer class="post-footer">
          
          <div class="post-tags">
              <a href="/tags/webpack/" rel="tag"><i class="fa fa-tag"></i>webpack</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/11/28/typescript-07/" rel="prev" title="TypeScriptå­¦ä¹ ç¬”è®°ï¼ˆä¸ƒï¼‰â€”â€”é«˜çº§ç±»å‹">
      <i class="fa fa-chevron-left"></i> TypeScriptå­¦ä¹ ç¬”è®°ï¼ˆä¸ƒï¼‰â€”â€”é«˜çº§ç±»å‹
    </a></div>
      <div class="post-nav-item">
    <a href="/2021/01/03/webpack-codesplitting/" rel="next" title="Webpackä¸­çš„CodeSplitting">
      Webpackä¸­çš„CodeSplitting <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="gitalk-container"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#loader%E6%9C%BA%E5%88%B6"><span class="nav-text"> Loaderæœºåˆ¶</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%80-loader%E7%9A%84%E5%8C%B9%E9%85%8D%E8%A7%84%E5%88%99"><span class="nav-text"> ä¸€ã€loaderçš„åŒ¹é…è§„åˆ™</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%8C-loader%E9%85%8D%E7%BD%AE"><span class="nav-text"> äºŒã€loaderé…ç½®</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%89-%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AAloader"><span class="nav-text"> ä¸‰ã€å®ç°ä¸€ä¸ªloader</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E5%90%8C%E6%AD%A5loader"><span class="nav-text"> 1ã€åŒæ­¥loader</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E5%BC%82%E6%AD%A5loader"><span class="nav-text"> 2ã€å¼‚æ­¥loader</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#plugin%E6%9C%BA%E5%88%B6"><span class="nav-text"> Pluginæœºåˆ¶</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%80-%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AAplugin"><span class="nav-text"> ä¸€ã€å®ç°ä¸€ä¸ªplugin</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#webpack%E6%89%93%E5%8C%85%E6%B5%81%E7%A8%8B"><span class="nav-text"> Webpackæ‰“åŒ…æµç¨‹</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%80-%E5%88%9D%E5%A7%8B%E5%8C%96%E5%90%AF%E5%8A%A8"><span class="nav-text"> ä¸€ã€åˆå§‹åŒ–å¯åŠ¨</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%8C-webpack-cli"><span class="nav-text"> äºŒã€webpack-cli</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%89-%E5%88%9B%E5%BB%BA-compiler-%E5%AF%B9%E8%B1%A1"><span class="nav-text"> ä¸‰ã€åˆ›å»º Compiler å¯¹è±¡</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9B%9B-%E5%BC%80%E5%A7%8B%E5%88%9B%E5%BB%BA"><span class="nav-text"> å››ã€å¼€å§‹åˆ›å»º</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%94-make%E6%9E%84%E5%BB%BA%E9%98%B6%E6%AE%B5"><span class="nav-text"> äº”ã€makeï¼ˆæ„å»ºï¼‰é˜¶æ®µ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%AD-%E6%89%93%E5%8C%85%E8%BE%93%E5%87%BA"><span class="nav-text"> å…­ã€æ‰“åŒ…è¾“å‡º</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%83-%E6%80%BB%E7%BB%93"><span class="nav-text"> ä¸ƒã€æ€»ç»“</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E5%88%9D%E5%A7%8B%E5%8C%96%E9%98%B6%E6%AE%B5"><span class="nav-text"> 1ã€åˆå§‹åŒ–é˜¶æ®µ</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E6%9E%84%E5%BB%BA%E9%98%B6%E6%AE%B5"><span class="nav-text"> 2ã€æ„å»ºé˜¶æ®µ</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-%E7%94%9F%E6%88%90%E9%98%B6%E6%AE%B5"><span class="nav-text"> 3ã€ç”Ÿæˆé˜¶æ®µ</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="nav-text"> å‚è€ƒèµ„æ–™</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="kyleezhang"
      src="/assets/config/avatar.png">
  <p class="site-author-name" itemprop="name">kyleezhang</p>
  <div class="site-description" itemprop="description">å­¦æºäºæ€</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">40</span>
          <span class="site-state-item-name">æ–‡ç« </span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">13</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/kyleezhang" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;kyleezhang" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="/2942181559@qq.com" title="E-Mail â†’ 2942181559@qq.com"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/u/6998903195" title="Weibo â†’ https:&#x2F;&#x2F;weibo.com&#x2F;u&#x2F;6998903195" rel="noopener" target="_blank"><i class="fab fa-weibo fa-fw"></i>Weibo</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">kyleezhang</span>
</div>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="ç«™ç‚¹æ€»å­—æ•°">575k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="ç«™ç‚¹é˜…è¯»æ—¶é•¿">8:43</span>
</div>



        
<div class="busuanzi-count footer-inner">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="æ€»è®¿å®¢é‡">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="æ€»è®¿é—®é‡">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

  

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.css">

<script>
NexT.utils.loadComments(document.querySelector('#gitalk-container'), () => {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID    : '5cb74a324ff7b0f7b544',
      clientSecret: 'cd372db5bb46f07eda7fae4b615fd27371c80dc7',
      repo        : 'kyleezhang.github.io',
      owner       : 'kyleezhang',
      admin       : ['kyleezhang'],
      id          : '393e63bf6f32e5c55aff70b2f35be050',
        language: 'zh-CN',
      distractionFreeMode: true
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
});
</script>

  <!-- èƒŒæ™¯åŠ¨ç”» -->
<script src="/js/particle.js"></script>

</body>
</html>
